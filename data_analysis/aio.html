<!DOCTYPE html>
<!-- saved from url=(0062)https://datacarpentry.org/python-ecology-lesson/aio/index.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-06-23 13:47:10 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="http://pzindel.github.io/LanternPython">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.css">
    <link rel="stylesheet" type="text/css" href="../css/lesson.css">
    <link rel="stylesheet" type="text/css" href="../css/syntax.css">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Data Analysis and Visualization in Python for Ecologists
  </title>  

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="navbar-collapse collapse in" id="bs-example-navbar-collapse-1" aria-expanded="true" style="">
      <ul class="nav navbar-nav">

        
        <li class="dropdown">
          <a href="../unix/01-intro.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">The Unix Shell <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../unix/01-intro.html">Introducing the Shell</a></li>
            
            
            <li><a href="../unix/02-filedir.html">Navigating Files and Directories</a></li>
            
            
            <li><a href="../unix/03-create.html">Working With Files and Directories</a></li>
            
            
            <li><a href="../unix/04-pipefilter.html">Pipes and Filters</a></li>
            
            
            <li><a href="../unix/05-loop.html">Loops</a></li>
            
            
            <li><a href="../unix/06-script.html">Shell Scripts</a></li>
            
            
            <li><a href="../unix/07-find.html">Finding Things</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../unix/aio.html">All in one page</a></li>
          </ul>
        </li>
	        
		
		<li class="dropdown">
          <a href="../python/01-intro.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Programming with Python <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../python/01-intro.html">Python Fundamentals</a></li>
            
            
            <li><a href="../python/02-numpy.html">Analyzing Patient Data</a></li>
            
            
            <li><a href="../python/03-matplotlib.html">Visualizing Tabular Data</a></li>
            
            
            <li><a href="../python/04-loop.html">Repeating Actions with Loops</a></li>
            
            
            <li><a href="../python/05-lists.html">Storing Multiple Values in Lists</a></li>
            
            
            <li><a href="../python/06-files.html">Analyzing Data from Multiple Files</a></li>
            
            
            <li><a href="../python/07-cond.html">Making Choices</a></li>
            
            
            <li><a href="../python/08-func.html">Creating Functions</a></li>
            
            
            <li><a href="../python/09-errors.html">Errors and Exceptions</a></li>
            
            
            <li><a href="../python/10-defensive.html">Defensive Programming</a></li>
            
            
            <li><a href="../python/11-debugging.html">Debugging</a></li>
            
            
            <li><a href="../python/12-cmdline.html">Command-Line Programs</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../python/aio.html">All in one page</a></li>
          </ul>
        </li>
	

		<li class="dropdown">
          <a href="._analysis/01-intro-to-python.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Data Analysis <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="./00-before-we-start.html">Before we start</a></li>
            
            
            <li><a href="./01-intro-to-python.html">Short Introduction to Programming in Python</a></li>
            
            
            <li><a href="./02-starting-with-data.html">Starting With Data</a></li>
            
            
            <li><a href="./03-index-slice-subset.html">Indexing, Slicing and Subsetting DataFrames in Python</a></li>
            
            
            <li><a href="./04-data-types.html">Data Types and Formats</a></li>
            
            
            <li><a href="./05-merging-data.html">Combining DataFrames with Pandas</a></li>
            
            
            <li><a href="./06-loops-and-functions.html">Data Workflows and Automation</a></li>
            
            
            <li><a href="./07-visualization.html">Making Plots With plotnine</a></li>
            
            
            <li><a href="./08-all-together.html">Data Ingest and Visualization - Matplotlib and Pandas</a></li>
            
            
            <li><a href="./09-working-with-sql.html">Accessing SQLite Databases Using Python and Pandas</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="./aio.html">All in one page</a></li>
          </ul>
        </li>

        <li><a href="../licenses.html">License</a></li>
	
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>
















<h1 class="maintitle"><a href="../index.html#data">Data Analysis and Visualization in Python for Ecologists</a></h1>



<article>

<h1 id="before-we-start" class="maintitle">Before we start</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is Python and why should I learn it?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Present motivations for using Python.</p>
</li>
	
	<li><p>Organize files and directories for a set of analyses as a Python project, and understand the purpose of the working directory.</p>
</li>
	
	<li><p>How to work with Jupyter Notebook and Spyder.</p>
</li>
	
	<li><p>Know where to find help.</p>
</li>
	
	<li><p>Demonstrate how to provide sufficient information for troubleshooting with the Python user community.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p><br></p>
<h2 id="what-is-python">What is Python?</h2>
<p>Python is a general purpose programming language that supports rapid development of data analytics
applications.  The word “Python” is used to refer to both, the programming language and the tool
that executes the scripts written in Python language.</p>

<p>Its main advantages are:</p>

<ul>
  <li>Free</li>
  <li>Open-source</li>
  <li>Available on all major platforms (macOS, Linux, Windows)</li>
  <li>Supported by Python Software Foundation</li>
  <li>Supports multiple programming paradigms</li>
  <li>Has large community</li>
  <li>Rich ecosystem of third-party packages</li>
</ul>

<p><em>So, why do you need Python for data analysis?</em></p>

<ul>
  <li>
    <p><strong>Easy to learn:</strong>
Python is easier to learn than other programming languages. This is important because lower barriers
mean it is easier for new members of the community to get up to speed.</p>
  </li>
  <li>
    <p><strong>Reproducibility:</strong>
Reproducibility is the ability to obtain the same results using the same dataset(s) and analysis.</p>
  </li>
</ul>

<p>Data analysis written as a Python script can be reproduced on any platform.  Moreover, if you
collect more or correct existing data, you can quickly re-run your analysis!</p>

<p>An increasing number of journals and funding agencies expect analyses to be reproducible,
so knowing Python will give you an edge with these requirements.</p>

<ul>
  <li><strong>Versatility:</strong>
Python is a versatile language that integrates with many existing applications to enable something
completely amazing.  For example, one can use Python to generate manuscripts, so that if you need to
update your data, analysis procedure, or change something else, you can quickly regenerate all the
figures and your manuscript will be updated automatically.</li>
</ul>

<p>Python can read text files, connect to databases, and many other data formats, on your computer or
on the web.</p>

<ul>
  <li>
    <p><strong>Interdisciplinary and extensible:</strong>
Python provides a framework that allows anyone to combine approaches from different research
(but not only) disciplines to best suit your analysis needs.</p>
  </li>
  <li>
    <p><strong>Python has a large and welcoming community:</strong>
Thousands of people use Python daily. Many of them are willing to help you through mailing lists and
websites, such as <a href="https://stackoverflow.com/">Stack Overflow</a>  and <a href="https://www.anaconda.com/community">Anaconda community
portal</a>.</p>
  </li>
  <li>
    <p><strong>Free and Open-Source Software (FOSS)… and Cross-Platform:</strong>
We know we have already said that but it is worth repeating.</p>
  </li>
</ul>

<p><br></p>
<h2 id="knowing-your-way-around-anaconda">Knowing your way around Anaconda</h2>
<p><a href="https://www.anaconda.com/">Anaconda</a> distribution of Python includes a lot of its popular packages,
such as the IPython console, Jupyter Notebook, and Spyder IDE.
Have a quick look around the Anaconda Navigator. You can launch programs from the Navigator or use the command line.</p>

<p>The <a href="https://jupyter.org/">Jupyter Notebook</a> is an open-source web application that allows you to create
and share documents that allow one to create documents that combine code, graphs, and narrative text.
<a href="https://www.spyder-ide.org/">Spyder</a> is an <strong>Integrated Development Environment</strong> that
allows one to write Python scripts and interact with the Python software from within a single interface.</p>

<p>Anaconda also comes with a package manager called <a href="https://conda.io/docs/">conda</a>,
which makes it easy to install and update additional packages.</p>

<p><br></p>
<h2 id="research-project-best-practices">Research Project: Best Practices</h2>
<p>It is a good idea to keep a set of related data, analyses, and text in a single folder.
All scripts and text files within this folder can then use relative paths to the data files.
Working this way makes it a lot easier to move around your project and share it with others.</p>

<h3 id="organizing-your-working-directory">Organizing your working directory</h3>
<p>Using a consistent folder structure across your projects will help you keep things organized,
and will also make it easy to find/file things in the future. This can be especially helpful
when you have multiple projects. In general, you may wish to create separate directories for
your scripts, data, and documents.</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">data/</code></strong>: Use this folder to store your raw data. For the sake of transparency and provenance,
you should always keep a copy of your <strong>raw data</strong>. If you need to cleanup data, do it
programmatically (<em>i.e.</em> with scripts) and make sure to separate cleaned up data from the raw data.
For example, you can store raw data in files <code class="language-plaintext highlighter-rouge">./data/raw/</code> and clean data in <code class="language-plaintext highlighter-rouge">./data/clean/</code>.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">documents/</code></strong>: Use this folder to store outlines, drafts, and other text.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">scripts/</code></strong>: Use this folder to store your (Python) scripts for data cleaning, analysis, and
plotting that you use in this particular project.</p>
  </li>
</ul>

<p>You may need to create additional directories depending on your project needs, but these should form
the backbone of your project’s directory. For this workshop, we will need a <code class="language-plaintext highlighter-rouge">data/</code> folder to store
our raw data, and we will later create a <code class="language-plaintext highlighter-rouge">data_output/</code> folder when we learn how to export data as
CSV files.</p>

<h2 id="what-is-programming-and-coding">What is Programming and Coding?</h2>

<p>Programming is the process of writing <em>“programs”</em> that a computer can execute and produce some
(useful) output.
Programming is a multi-step process that involves the following steps:</p>

<ol>
  <li>Identifying the aspects of the real-world problem that can be solved computationally</li>
  <li>Identifying (the best) computational solution</li>
  <li>Implementing the solution in a specific computer language</li>
  <li>Testing, validating, and adjusting implemented solution.</li>
</ol>

<p>While <em>“Programming”</em> refers to all of the above steps,
<em>“Coding”</em> refers to step 3 only: <em>“Implementing the solution in a specific computer language”</em>.</p>

<h4 id="if-you-are-working-with-jupyter-notebook">If you are working with Jupyter notebook:</h4>

<p>You can type Python code into a code cell and then execute the code by pressing
<kbd>Shift</kbd>+<kbd>Return</kbd>.
Output will be printed directly under the input cell.
You can recognise a code cell by the <code class="language-plaintext highlighter-rouge">In[ ]:</code> at the beginning of the cell and output by <code class="language-plaintext highlighter-rouge">Out[ ]:</code>.
Pressing the <strong>+</strong> button in the menu bar will add a new cell.
All your commands as well as any output will be saved with the notebook.</p>

<h4 id="if-you-are-working-with-spyder">If you are working with Spyder:</h4>

<p>You can either use the console or use script files (plain text files that contain your code).  The
console pane (in Spyder, the bottom right panel) is the place where commands written in the Python
language can be typed and executed immediately by the computer. It is also where the results will be
shown.  You can execute commands directly in the console by pressing <kbd>Return</kbd>, but they
will be “lost” when you close the session.  Spyder uses the <a href="http://ipython.org/">IPython</a> console by
default.</p>

<p>Since we want our code and workflow to be reproducible, it is better to type the commands in
the script editor, and save them as a script. This way, there is a complete record of what we did,
and anyone (including our future selves!) has an easier time reproducing the results on their computer.</p>

<p>Spyder allows you to execute commands directly from the script editor by using the run buttons on
top.  To run the entire script click <em>Run file</em> or press <kbd>F5</kbd>, to run the current line
click <em>Run selection or current line</em> or press <kbd>F9</kbd>, other run buttons allow to run script
cells or go into debug mode. When using <kbd>F9</kbd>, the command on the current line in the script
(indicated by the cursor) or all of the commands in the currently selected text will be sent to the
console and executed.</p>

<p>At some point in your analysis you may want to check the content of a variable or the structure of
an object, without necessarily keeping a record of it in your script. You can type these commands
and execute them directly in the console. Spyder provides the
<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>E</kbd> and <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>I</kbd>
shortcuts to allow you to jump between the script and the console panes.</p>

<p>If Python is ready to accept commands, the IPython console shows an <code class="language-plaintext highlighter-rouge">In [..]:</code> prompt with the
current console line number in <code class="language-plaintext highlighter-rouge">[]</code>. If it receives a command (by typing, copy-pasting or sent from
the script editor), Python will execute it, display the results in the <code class="language-plaintext highlighter-rouge">Out [..]:</code> cell, and come
back with a new <code class="language-plaintext highlighter-rouge">In [..]:</code> prompt waiting for new commands.</p>

<p>If Python is still waiting for you to enter more data because it isn’t complete yet, the console
will show a <code class="language-plaintext highlighter-rouge">...:</code> prompt. It means that you haven’t finished entering a complete command.  This can
be because you have not typed a closing parenthesis (<code class="language-plaintext highlighter-rouge">)</code>, <code class="language-plaintext highlighter-rouge">]</code>, or <code class="language-plaintext highlighter-rouge">}</code>) or quotation mark.  When this
happens, and you thought you finished typing your command, click inside the console window and press
<kbd>Esc</kbd>; this will cancel the incomplete command and return you to the <code class="language-plaintext highlighter-rouge">In [..]:</code> prompt.</p>

<h2 id="how-to-learn-more-after-the-workshop">How to learn more after the workshop?</h2>

<p>The material we cover during this workshop will give you an initial taste of how you can use Python
to analyze data for your own research. However, you will need to learn more to do advanced
operations such as cleaning your dataset, using statistical methods, or creating beautiful graphics.
The best way to become proficient and efficient at python, as with any other tool, is to use it to
address your actual research questions. As a beginner, it can feel daunting to have to write a
script from scratch, and given that many people make their code available online, modifying existing
code to suit your purpose might make it easier for you to get started.</p>

<h2 id="seeking-help">Seeking help</h2>

<ul>
  <li>check under the <em>Help</em> menu</li>
  <li>type <code class="language-plaintext highlighter-rouge">help()</code></li>
  <li>type <code class="language-plaintext highlighter-rouge">?object</code> or <code class="language-plaintext highlighter-rouge">help(object)</code> to get information about an object</li>
  <li><a href="https://www.python.org/doc">Python documentation</a></li>
  <li><a href="https://pandas.pydata.org/pandas-docs/stable/">Pandas documentation</a></li>
</ul>

<p>Finally, a generic Google or internet search “Python task” will often either send you to the
appropriate module documentation or a helpful forum where someone else has already asked your
question.</p>

<p>I am stuck… I get an error message that I don’t understand.
Start by googling the error message. However, this doesn’t always work very well, because often,
package developers rely on the error catching provided by Python. You end up with general error
messages that might not be very helpful to diagnose a problem (e.g. “subscript out of bounds”). If
the message is very generic, you might also include the name of the function or package you’re using
in your query.</p>

<p>However, you should check Stack Overflow. Search using the <code class="language-plaintext highlighter-rouge">[python]</code> tag. Most questions have already
been answered, but the challenge is to use the right words in the search to find the answers:
<a href="https://stackoverflow.com/questions/tagged/python?tab=Votes">https://stackoverflow.com/questions/tagged/python?tab=Votes</a></p>

<h3 id="asking-for-help">Asking for help</h3>

<p>The key to receiving help from someone is for them to rapidly grasp your problem. You should make it
as easy as possible to pinpoint where the issue might be.</p>

<p>Try to use the correct words to describe your problem. For instance, a package is not the same thing
as a library. Most people will understand what you meant, but others have really strong feelings
about the difference in meaning. The key point is that it can make things confusing for people
trying to help you. Be as precise as possible when describing your problem.</p>

<p>If possible, try to reduce what doesn’t work to a simple reproducible example. If you can reproduce
the problem using a very small data frame instead of your 50,000 rows and 10,000 columns one,
provide the small one with the description of your problem. When appropriate, try to generalize what
you are doing so even people who are not in your field can understand the question. For instance,
instead of using a subset of your real dataset, create a small (3 columns, 5 rows) generic one.</p>

<h3 id="where-to-ask-for-help">Where to ask for help?</h3>

<ul>
  <li>The person sitting next to you during the workshop. Don’t hesitate to talk to your neighbor during
the workshop, compare your answers, and ask for help. You might also be interested in organizing
regular meetings following the workshop to keep learning from each other.</li>
  <li>Your friendly colleagues: if you know someone with more experience than you, they might be able and
willing to help you.</li>
  <li><a href="https://stackoverflow.com/questions/tagged/python?tab=Votes">Stack Overflow</a>: if your question hasn’t been answered before and is well crafted,
chances are you will get an answer in less than 5 min. Remember to follow their guidelines on how to
ask a good question.</li>
  <li><a href="https://www.python.org/community/lists">Python mailing lists</a></li>
</ul>

<h2 id="more-resources">More resources</h2>

<ul>
  <li>
    <p><a href="https://pypi.org/">PyPI - the Python Package Index</a></p>
  </li>
  <li>
    <p><a href="https://docs.python-guide.org/">The Hitchhiker’s Guide to Python</a></p>
  </li>
  <li>
    <p><a href="https://finderiko.com/python-book">Dive into Python 3</a></p>
  </li>
</ul>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Python is an open source and platform independent programming language.</p>
</li>
    
    <li><p>Jupyter Notebook and the Spyder IDE are great tools to code in and interact with Python. With the large Python community it is easy to find help on the internet.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="short-introduction-to-programming-in-python" class="maintitle">Short Introduction to Programming in Python</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is Python?</p>
</li>
	
	<li><p>Why should I learn Python?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the advantages of using programming vs. completing repetitive tasks by hand.</p>
</li>
	
	<li><p>Define the following data types in Python: strings, integers, and floats.</p>
</li>
	
	<li><p>Perform mathematical operations in Python using basic operators.</p>
</li>
	
	<li><p>Define the following as it relates to Python: lists, tuples, and dictionaries.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="interpreter">Interpreter</h2>

<p>Python is an interpreted language which can be used in two ways:</p>

<ul>
  <li>“Interactively”: when you use it as an “advanced calculator” executing
one command at a time. To start Python in this mode, execute <code class="language-plaintext highlighter-rouge">python</code>
on the command line:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Python 3.5.1 (default, Oct 23 2015, 18:05:06)
[GCC 4.8.3] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt;
</code></pre></div></div>

<p>Chevrons <code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code> indicate an interactive prompt in Python, meaning that it is waiting for your
input.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World
</code></pre></div></div>

<ul>
  <li>“Scripting” Mode: executing a series of “commands” saved in text file,
usually with a <code class="language-plaintext highlighter-rouge">.py</code> extension after the name of your file:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python my_script.py
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World
</code></pre></div></div>

<h2 id="introduction-to-python-built-in-data-types">Introduction to Python built-in data types</h2>

<h3 id="strings-integers-and-floats">Strings, integers, and floats</h3>

<p>One of the most basic things we can do in Python is assign values to variables:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span> <span class="o">=</span> <span class="s">"Data Carpentry"</span>  <span class="c1"># An example of a string
</span><span class="n">number</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1"># An example of an integer
</span><span class="n">pi_value</span> <span class="o">=</span> <span class="mf">3.1415</span>  <span class="c1"># An example of a float
</span></code></pre></div></div>

<p>Here we’ve assigned data to the variables <code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">number</code> and <code class="language-plaintext highlighter-rouge">pi_value</code>,
using the assignment operator <code class="language-plaintext highlighter-rouge">=</code>. To review the value of a variable, we
can type the name of the variable into the interpreter and press <kbd>Return</kbd>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"Data Carpentry"
</code></pre></div></div>

<p>Everything in Python has a type. To get the type of something, we can pass it
to the built-in function <code class="language-plaintext highlighter-rouge">type</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'str'&gt;
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'int'&gt;
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span><span class="p">(</span><span class="n">pi_value</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'float'&gt;
</code></pre></div></div>

<p>The variable <code class="language-plaintext highlighter-rouge">text</code> is of type <code class="language-plaintext highlighter-rouge">str</code>, short for “string”. Strings hold
sequences of characters, which can be letters, numbers, punctuation
or more exotic forms of text (even emoji!).</p>

<p>We can also see the value of something using another built-in function, <code class="language-plaintext highlighter-rouge">print</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Data Carpentry
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42
</code></pre></div></div>

<p>This may seem redundant, but in fact it’s the only way to display output in a script:</p>

<p><em>example.py</em></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># A Python script file
# Comments in Python start with #
# The next line assigns the string "Data Carpentry" to the variable "text".
</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Data Carpentry"</span>

<span class="c1"># The next line does nothing!
</span><span class="n">text</span>

<span class="c1"># The next line uses the print function to print out the value we assigned to "text"
</span><span class="k">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p><em>Running the script</em></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python example.py
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Data Carpentry
</code></pre></div></div>

<p>Notice that “Data Carpentry” is printed only once.</p>

<p><strong>Tip</strong>: <code class="language-plaintext highlighter-rouge">print</code> and <code class="language-plaintext highlighter-rouge">type</code> are built-in functions in Python. Later in this
lesson, we will introduce methods and user-defined functions. The Python
documentation is excellent for reference on the differences between them.</p>

<h3 id="operators">Operators</h3>

<p>We can perform mathematical calculations in Python using the basic operators
 <code class="language-plaintext highlighter-rouge">+, -, /, *, %</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># Addition
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">6</span> <span class="o">*</span> <span class="mi">7</span>  <span class="c1"># Multiplication
</span></code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span>  <span class="c1"># Power
</span></code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>65536
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">13</span> <span class="o">%</span> <span class="mi">5</span>  <span class="c1"># Modulo
</span></code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
</code></pre></div></div>

<p>We can also use comparison and logic operators:
<code class="language-plaintext highlighter-rouge">&lt;, &gt;, ==, !=, &lt;=, &gt;=</code> and statements of identity such as
<code class="language-plaintext highlighter-rouge">and, or, not</code>. The data type returned by this is
called a <em>boolean</em>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">4</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>False
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">True</span> <span class="ow">and</span> <span class="bp">True</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">True</span> <span class="ow">and</span> <span class="bp">False</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>False
</code></pre></div></div>

<h2 id="sequences-lists-and-tuples">Sequences: Lists and Tuples</h2>

<h3 id="lists">Lists</h3>

<p><strong>Lists</strong> are a common data structure to hold an ordered sequence of
elements. Each element can be accessed by an index.  Note that Python
indexes start with 0 instead of 1:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
</code></pre></div></div>

<p>A <code class="language-plaintext highlighter-rouge">for</code> loop can be used to access the elements in a list or other Python data
structure one at a time:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
2
3
</code></pre></div></div>

<p><strong>Indentation</strong> is very important in Python. Note that the second line in the
example above is indented. Just like three chevrons <code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code> indicate an
interactive prompt in Python, the three dots <code class="language-plaintext highlighter-rouge">...</code> are Python’s prompt for
multiple lines. This is Python’s way of marking a block of code. [Note: you
do not type <code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code> or <code class="language-plaintext highlighter-rouge">...</code>.]</p>

<p>To add elements to the end of a list, we can use the <code class="language-plaintext highlighter-rouge">append</code> method. Methods
are a way to interact with an object (a list, for example). We can invoke a
method using the dot <code class="language-plaintext highlighter-rouge">.</code> followed by the method name and a list of arguments
in parentheses. Let’s look at an example using <code class="language-plaintext highlighter-rouge">append</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numbers</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1, 2, 3, 4]
</code></pre></div></div>

<p>To find out what methods are available for an
object, we can use the built-in <code class="language-plaintext highlighter-rouge">help</code> command:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>help(numbers)

Help on list object:

class list(object)
 |  list() -&gt; new empty list
 |  list(iterable) -&gt; new list initialized from iterable's items
 ...
</code></pre></div></div>

<h3 id="tuples">Tuples</h3>

<p>A <strong>tuple</strong> is similar to a list in that it’s an ordered sequence of elements.
However, tuples can not be changed once created (they are “immutable”). Tuples
are created by placing comma-separated values inside parentheses <code class="language-plaintext highlighter-rouge">()</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Tuples use parentheses
</span><span class="n">a_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">another_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s">'blue'</span><span class="p">,</span> <span class="s">'green'</span><span class="p">,</span> <span class="s">'red'</span><span class="p">)</span>

<span class="c1"># Note: lists use square brackets
</span><span class="n">a_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="tuples-vs-lists">Tuples <em>vs.</em> Lists</h2>
  <ol>
    <li>What happens when you execute <code class="language-plaintext highlighter-rouge">a_list[1] = 5</code>?</li>
    <li>What happens when you execute <code class="language-plaintext highlighter-rouge">a_tuple[2] = 5</code>?</li>
    <li>What does <code class="language-plaintext highlighter-rouge">type(a_tuple)</code> tell you about <code class="language-plaintext highlighter-rouge">a_tuple</code>?</li>
  </ol>
</blockquote>

<h2 id="dictionaries">Dictionaries</h2>

<p>A <strong>dictionary</strong> is a container that holds pairs of objects - keys and values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">translation</span> <span class="o">=</span> <span class="p">{</span><span class="s">'one'</span><span class="p">:</span> <span class="s">'first'</span><span class="p">,</span> <span class="s">'two'</span><span class="p">:</span> <span class="s">'second'</span><span class="p">}</span>
<span class="n">translation</span><span class="p">[</span><span class="s">'one'</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'first'
</code></pre></div></div>

<p>Dictionaries work a lot like lists - except that you index them with <em>keys</em>.
You can think about a key as a name or unique identifier for the value it corresponds to.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rev</span> <span class="o">=</span> <span class="p">{</span><span class="s">'first'</span><span class="p">:</span> <span class="s">'one'</span><span class="p">,</span> <span class="s">'second'</span><span class="p">:</span> <span class="s">'two'</span><span class="p">}</span>
<span class="n">rev</span><span class="p">[</span><span class="s">'first'</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'one'
</code></pre></div></div>

<p>To add an item to the dictionary we assign a value to a new key:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rev</span> <span class="o">=</span> <span class="p">{</span><span class="s">'first'</span><span class="p">:</span> <span class="s">'one'</span><span class="p">,</span> <span class="s">'second'</span><span class="p">:</span> <span class="s">'two'</span><span class="p">}</span>
<span class="n">rev</span><span class="p">[</span><span class="s">'third'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'three'</span>
<span class="n">rev</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'first': 'one', 'second': 'two', 'third': 'three'}
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">for</code> loops with dictionaries is a little more complicated. We can do
this in two ways:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rev</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">'-&gt;'</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'first' -&gt; one
'second' -&gt; two
'third' -&gt; three
</code></pre></div></div>

<p>or</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rev</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">'-&gt;'</span><span class="p">,</span> <span class="n">rev</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'first' -&gt; one
'second' -&gt; two
'third' -&gt; three
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="changing-dictionaries">Changing dictionaries</h2>

  <ol>
    <li>First, print the value of the <code class="language-plaintext highlighter-rouge">rev</code> dictionary to the screen.</li>
    <li>Reassign the value that corresponds to the key <code class="language-plaintext highlighter-rouge">second</code> so that it no longer
reads “two” but instead <code class="language-plaintext highlighter-rouge">2</code>.</li>
    <li>Print the value of <code class="language-plaintext highlighter-rouge">rev</code> to the screen again to see if the value has changed.</li>
  </ol>
</blockquote>

<h2 id="functions">Functions</h2>

<p>Defining a section of code as a <strong>function</strong> in Python is done using the <code class="language-plaintext highlighter-rouge">def</code>
keyword. For example a function that takes two arguments and returns their sum
can be defined as:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">add_function</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42
</code></pre></div></div>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Python is an interpreted language which can be used interactively (executing one command at a time) or in scripting mode (executing a series of commands saved in file).</p>
</li>
    
    <li><p>One can assign a value to a variable in Python. Those variables can be of several types, such as string, integer, floating point and complex numbers.</p>
</li>
    
    <li><p>Lists and tuples are similar in that they are ordered lists of elements; they differ in that a tuple is immutable (cannot be changed).</p>
</li>
    
    <li><p>Dictionaries are data structures that provide mappings between keys and values.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="starting-with-data" class="maintitle">Starting With Data</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I import data in Python?</p>
</li>
	
	<li><p>What is Pandas?</p>
</li>
	
	<li><p>Why should I use Pandas to work with data?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Navigate the workshop directory and download a dataset.</p>
</li>
	
	<li><p>Explain what a library is and what libraries are used for.</p>
</li>
	
	<li><p>Describe what the Python Data Analysis Library (Pandas) is.</p>
</li>
	
	<li><p>Load the Python Data Analysis Library (Pandas).</p>
</li>
	
	<li><p>Use <code class="language-plaintext highlighter-rouge">read_csv</code> to read tabular data into Python.</p>
</li>
	
	<li><p>Describe what a DataFrame is in Python.</p>
</li>
	
	<li><p>Access and summarize data stored in a DataFrame.</p>
</li>
	
	<li><p>Define indexing as it relates to data structures.</p>
</li>
	
	<li><p>Perform basic mathematical operations and summary statistics on data in a Pandas DataFrame.</p>
</li>
	
	<li><p>Create simple plots.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h1 id="working-with-pandas-dataframes-in-python">Working With Pandas DataFrames in Python</h1>

<p>We can automate the process of performing data manipulations in Python. It’s efficient to spend time
building the code to perform these tasks because once it’s built, we can use it
over and over on different datasets that use a similar format. This makes our
methods easily reproducible. We can also easily share our code with colleagues
and they can replicate the same analysis.</p>

<h3 id="starting-in-the-same-spot">Starting in the same spot</h3>

<p>To help the lesson run smoothly, let’s ensure everyone is in the same directory.
This should help us avoid path and file name issues. At this time please
navigate to the workshop directory. If you are working in IPython Notebook be sure
that you start your notebook in the workshop directory.</p>

<p>A quick aside that there are Python libraries like <a href="https://docs.python.org/3/library/os.html">OS Library</a> that can work with our
directory structure, however, that is not our focus today.</p>

<h3 id="our-data">Our Data</h3>

<p>For this lesson, we will be using the Portal Teaching data, a subset of the data
from Ernst et al
<a href="http://www.esapubs.org/archive/ecol/E090/118/default.htm">Long-term monitoring and experimental manipulation of a Chihuahuan Desert ecosystem near Portal,
Arizona, USA</a>.</p>

<p>We will be using files from the <a href="https://figshare.com/articles/Portal_Project_Teaching_Database/1314459">Portal Project Teaching Database</a>.
This section will use the <code class="language-plaintext highlighter-rouge">surveys.csv</code> file that can be downloaded here:
<a href="https://ndownloader.figshare.com/files/2292172">https://ndownloader.figshare.com/files/2292172</a></p>

<p>We are studying the species and weight of animals caught in sites in our study
area. The dataset is stored as a <code class="language-plaintext highlighter-rouge">.csv</code> file: each row holds information for a
single animal, and the columns represent:</p>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Column</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>record_id</td>
      <td>Unique id for the observation</td>
    </tr>
    <tr>
      <td>month</td>
      <td>month of observation</td>
    </tr>
    <tr>
      <td>day</td>
      <td>day of observation</td>
    </tr>
    <tr>
      <td>year</td>
      <td>year of observation</td>
    </tr>
    <tr>
      <td>plot_id</td>
      <td>ID of a particular site</td>
    </tr>
    <tr>
      <td>species_id</td>
      <td>2-letter code</td>
    </tr>
    <tr>
      <td>sex</td>
      <td>sex of animal (“M”, “F”)</td>
    </tr>
    <tr>
      <td>hindfoot_length</td>
      <td>length of the hindfoot in mm</td>
    </tr>
    <tr>
      <td>weight</td>
      <td>weight of the animal in grams</td>
    </tr>
  </tbody>
</table>

<p>The first few rows of our first file look like this:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>record_id,month,day,year,plot_id,species_id,sex,hindfoot_length,weight
1,7,16,1977,2,NL,M,32,
2,7,16,1977,3,NL,M,33,
3,7,16,1977,2,DM,F,37,
4,7,16,1977,7,DM,M,36,
5,7,16,1977,3,DM,M,35,
6,7,16,1977,1,PF,M,14,
7,7,16,1977,2,PE,F,,
8,7,16,1977,1,DM,M,37,
9,7,16,1977,1,DM,F,34,
</code></pre></div></div>

<hr>

<h2 id="about-libraries">About Libraries</h2>
<p>A library in Python contains a set of tools (called functions) that perform
tasks on our data. Importing a library is like getting a piece of lab equipment
out of a storage locker and setting it up on the bench for use in a project.
Once a library is set up, it can be used or called to perform the task(s)
it was built to do.</p>

<h2 id="pandas-in-python">Pandas in Python</h2>
<p>One of the best options for working with tabular data in Python is to use the
<a href="https://pandas.pydata.org/">Python Data Analysis Library</a> (a.k.a. Pandas). The
Pandas library provides data structures, produces high quality plots with
<a href="https://matplotlib.org/">matplotlib</a> and integrates nicely with other libraries
that use <a href="https://www.numpy.org/">NumPy</a> (which is another Python library) arrays.</p>

<p>Python doesn’t load all of the libraries available to it by default. We have to
add an <code class="language-plaintext highlighter-rouge">import</code> statement to our code in order to use library functions. To import
a library, we use the syntax <code class="language-plaintext highlighter-rouge">import libraryName</code>. If we want to give the
library a nickname to shorten the command, we can add <code class="language-plaintext highlighter-rouge">as nickNameHere</code>.  An
example of importing the pandas library using the common nickname <code class="language-plaintext highlighter-rouge">pd</code> is below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<p>Each time we call a function that’s in a library, we use the syntax
<code class="language-plaintext highlighter-rouge">LibraryName.FunctionName</code>. Adding the library name with a <code class="language-plaintext highlighter-rouge">.</code> before the
function name tells Python where to find the function. In the example above, we
have imported Pandas as <code class="language-plaintext highlighter-rouge">pd</code>. This means we don’t have to type out <code class="language-plaintext highlighter-rouge">pandas</code> each
time we call a Pandas function.</p>

<h1 id="reading-csv-data-using-pandas">Reading CSV Data Using Pandas</h1>

<p>We will begin by locating and reading our survey data which are in CSV format. CSV stands for
Comma-Separated Values and is a common way to store formatted data. Other symbols may also be used, so
you might see tab-separated, colon-separated or space separated files. It is quite easy to replace
one separator with another, to match your application. The first line in the file often has headers
to explain what is in each column. CSV (and other separators) make it easy to share data, and can be
imported and exported from many applications, including Microsoft Excel. For more details on CSV
files, see the <a href="http://www.datacarpentry.org/spreadsheet-ecology-lesson/05-exporting-data">Data Organisation in Spreadsheets</a> lesson.
We can use Pandas’ <code class="language-plaintext highlighter-rouge">read_csv</code> function to pull the file directly into a <a href="https://pandas.pydata.org/pandas-docs/stable/getting_started/dsintro.html#dataframe">DataFrame</a>.</p>

<h2 id="so-whats-a-dataframe">So What’s a DataFrame?</h2>

<p>A DataFrame is a 2-dimensional data structure that can store data of different
types (including characters, integers, floating point values, factors and more)
in columns. It is similar to a spreadsheet or an SQL table or the <code class="language-plaintext highlighter-rouge">data.frame</code> in
R. A DataFrame always has an index (0-based). An index refers to the position of
an element in the data structure.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Note that pd.read_csv is used because we imported pandas as pd
</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
</code></pre></div></div>

<p>The above command yields the <strong>output</strong> below:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>record_id  month  day  year  plot_id species_id sex  hindfoot_length  weight
0          1      7   16  1977        2         NL   M               32   NaN
1          2      7   16  1977        3         NL   M               33   NaN
2          3      7   16  1977        2         DM   F               37   NaN
3          4      7   16  1977        7         DM   M               36   NaN
4          5      7   16  1977        3         DM   M               35   NaN
...
35544      35545     12   31  2002       15     AH  NaN              NaN  NaN
35545      35546     12   31  2002       15     AH  NaN              NaN  NaN
35546      35547     12   31  2002       10     RM    F               15   14
35547      35548     12   31  2002        7     DO    M               36   51
35548      35549     12   31  2002        5     NaN  NaN             NaN  NaN

[35549 rows x 9 columns]
</code></pre></div></div>

<p>We can see that there were 35,549 rows parsed. Each row has 9
columns. The first column is the index of the DataFrame. The index is used to
identify the position of the data, but it is not an actual column of the DataFrame.
It looks like  the <code class="language-plaintext highlighter-rouge">read_csv</code> function in Pandas  read our file properly. However,
we haven’t saved any data to memory so we can work with it. We need to assign the
DataFrame to a variable. Remember that a variable is a name for a value, such as <code class="language-plaintext highlighter-rouge">x</code>,
or  <code class="language-plaintext highlighter-rouge">data</code>. We can create a new  object with a variable name by assigning a value to it using <code class="language-plaintext highlighter-rouge">=</code>.</p>

<p>Let’s call the imported survey data <code class="language-plaintext highlighter-rouge">surveys_df</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
</code></pre></div></div>

<p>Notice when you assign the imported DataFrame to a variable, Python does not
produce any output on the screen. We can view the value of the <code class="language-plaintext highlighter-rouge">surveys_df</code>
object by typing its name into the Python command prompt.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span>
</code></pre></div></div>

<p>which prints contents like above.</p>

<p>Note: if the output is too wide to print on your narrow terminal window, you may see something
slightly different as the large set of data scrolls past. You may see simply the last column
of data:</p>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>17        NaN
18        NaN
19        NaN
20        NaN
21        NaN
22        NaN
23        NaN
24        NaN
25        NaN
26        NaN
27        NaN
28        NaN
29        NaN
...       ...
35519    36.0
35520    48.0
35521    45.0
35522    44.0
35523    27.0
35524    26.0
35525    24.0
35526    43.0
35527     NaN
35528    25.0
35529     NaN
35530     NaN
35531    43.0
35532    48.0
35533    56.0
35534    53.0
35535    42.0
35536    46.0
35537    31.0
35538    68.0
35539    23.0
35540    31.0
35541    29.0
35542    34.0
35543     NaN
35544     NaN
35545     NaN
35546    14.0
35547    51.0
35548     NaN

[35549 rows x 9 columns]
</code></pre></div></div>

<p>Never fear, all the data is there, if you scroll up. Selecting just a few rows, so it is
easier to fit on one window, you can see that pandas has neatly formatted the data to fit
our screen:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span> <span class="c1"># The head() method displays the first several lines of a file. It
</span>                  <span class="c1"># is discussed below.
</span></code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   record_id  month  day  year  plot_id species_id sex  hindfoot_length  \
5          6      7   16  1977        1         PF   M             14.0
6          7      7   16  1977        2         PE   F              NaN
7          8      7   16  1977        1         DM   M             37.0
8          9      7   16  1977        1         DM   F             34.0
9         10      7   16  1977        6         PF   F             20.0

   weight
5     NaN
6     NaN
7     NaN
8     NaN
9     NaN
</code></pre></div></div>

<h2 id="exploring-our-species-survey-data">Exploring Our Species Survey Data</h2>

<p>Again, we can use the <code class="language-plaintext highlighter-rouge">type</code> function to see what kind of thing <code class="language-plaintext highlighter-rouge">surveys_df</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
</code></pre></div></div>

<p>As expected, it’s a DataFrame (or, to use the full name that Python uses to refer
to it internally, a <code class="language-plaintext highlighter-rouge">pandas.core.frame.DataFrame</code>).</p>

<p>What kind of things does <code class="language-plaintext highlighter-rouge">surveys_df</code> contain? DataFrames have an attribute
called <code class="language-plaintext highlighter-rouge">dtypes</code> that answers this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">.</span><span class="n">dtypes</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>record_id            int64
month                int64
day                  int64
year                 int64
plot_id              int64
species_id          object
sex                 object
hindfoot_length    float64
weight             float64
dtype: object
</code></pre></div></div>

<p>All the values in a column have the same type. For example, months have type
<code class="language-plaintext highlighter-rouge">int64</code>, which is a kind of integer. Cells in the month column cannot have
fractional values, but the weight and hindfoot_length columns can, because they
have type <code class="language-plaintext highlighter-rouge">float64</code>. The <code class="language-plaintext highlighter-rouge">object</code> type doesn’t have a very helpful name, but in
this case it represents strings (such as ‘M’ and ‘F’ in the case of sex).</p>

<p>We’ll talk a bit more about what the different formats mean in a different lesson.</p>

<h3 id="useful-ways-to-view-dataframe-objects-in-python">Useful Ways to View DataFrame objects in Python</h3>

<p>There are many ways to summarize and access the data stored in DataFrames,
using attributes and methods provided by the DataFrame object.</p>

<p>To access an attribute, use the DataFrame object name followed by the attribute
name <code class="language-plaintext highlighter-rouge">df_object.attribute</code>. Using the DataFrame <code class="language-plaintext highlighter-rouge">surveys_df</code> and attribute
<code class="language-plaintext highlighter-rouge">columns</code>, an index of all the column names in the DataFrame can be accessed
with <code class="language-plaintext highlighter-rouge">surveys_df.columns</code>.</p>

<p>Methods are called in a similar fashion using the syntax <code class="language-plaintext highlighter-rouge">df_object.method()</code>.
As an example, <code class="language-plaintext highlighter-rouge">surveys_df.head()</code> gets the first few rows in the DataFrame
<code class="language-plaintext highlighter-rouge">surveys_df</code> using <strong>the <code class="language-plaintext highlighter-rouge">head()</code> method</strong>. With a method, we can supply extra
information in the parens to control behaviour.</p>

<p>Let’s look at the data using these.</p>

<blockquote class="challenge">
  <h2 id="challenge---dataframes">Challenge - DataFrames</h2>

  <p>Using our DataFrame <code class="language-plaintext highlighter-rouge">surveys_df</code>, try out the attributes &amp; methods below to see
what they return.</p>

  <ol>
    <li><code class="language-plaintext highlighter-rouge">surveys_df.columns</code></li>
    <li>
      <p><code class="language-plaintext highlighter-rouge">surveys_df.shape</code> Take note of the output of <code class="language-plaintext highlighter-rouge">shape</code> - what format does it
return the shape of the DataFrame in?</p>

      <p>HINT: <a href="https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences">More on tuples, here</a>.</p>
    </li>
    <li><code class="language-plaintext highlighter-rouge">surveys_df.head()</code> Also, what does <code class="language-plaintext highlighter-rouge">surveys_df.head(15)</code> do?</li>
    <li><code class="language-plaintext highlighter-rouge">surveys_df.tail()</code></li>
  </ol>
</blockquote>

<h2 id="calculating-statistics-from-data-in-a-pandas-dataframe">Calculating Statistics From Data In A Pandas DataFrame</h2>

<p>We’ve read our data into Python. Next, let’s perform some quick summary
statistics to learn more about the data that we’re working with. We might want
to know how many animals were collected in each site, or how many of each
species were caught. We can perform summary stats quickly using groups. But
first we need to figure out what we want to group by.</p>

<p>Let’s begin by exploring our data:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Look at the column names
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">columns</span>
</code></pre></div></div>

<p>which <strong>returns</strong>:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['record_id', 'month', 'day', 'year', 'plot_id', 'species_id', 'sex',
       'hindfoot_length', 'weight'],
      dtype='object')
</code></pre></div></div>

<p>Let’s get a list of all the species. The <code class="language-plaintext highlighter-rouge">pd.unique</code> function tells us all of
the unique values in the <code class="language-plaintext highlighter-rouge">species_id</code> column.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'species_id'</span><span class="p">])</span>
</code></pre></div></div>

<p>which <strong>returns</strong>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span><span class="p">([</span><span class="s">'NL'</span><span class="p">,</span> <span class="s">'DM'</span><span class="p">,</span> <span class="s">'PF'</span><span class="p">,</span> <span class="s">'PE'</span><span class="p">,</span> <span class="s">'DS'</span><span class="p">,</span> <span class="s">'PP'</span><span class="p">,</span> <span class="s">'SH'</span><span class="p">,</span> <span class="s">'OT'</span><span class="p">,</span> <span class="s">'DO'</span><span class="p">,</span> <span class="s">'OX'</span><span class="p">,</span> <span class="s">'SS'</span><span class="p">,</span>
       <span class="s">'OL'</span><span class="p">,</span> <span class="s">'RM'</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="s">'SA'</span><span class="p">,</span> <span class="s">'PM'</span><span class="p">,</span> <span class="s">'AH'</span><span class="p">,</span> <span class="s">'DX'</span><span class="p">,</span> <span class="s">'AB'</span><span class="p">,</span> <span class="s">'CB'</span><span class="p">,</span> <span class="s">'CM'</span><span class="p">,</span> <span class="s">'CQ'</span><span class="p">,</span>
       <span class="s">'RF'</span><span class="p">,</span> <span class="s">'PC'</span><span class="p">,</span> <span class="s">'PG'</span><span class="p">,</span> <span class="s">'PH'</span><span class="p">,</span> <span class="s">'PU'</span><span class="p">,</span> <span class="s">'CV'</span><span class="p">,</span> <span class="s">'UR'</span><span class="p">,</span> <span class="s">'UP'</span><span class="p">,</span> <span class="s">'ZL'</span><span class="p">,</span> <span class="s">'UL'</span><span class="p">,</span> <span class="s">'CS'</span><span class="p">,</span>
       <span class="s">'SC'</span><span class="p">,</span> <span class="s">'BA'</span><span class="p">,</span> <span class="s">'SF'</span><span class="p">,</span> <span class="s">'RO'</span><span class="p">,</span> <span class="s">'AS'</span><span class="p">,</span> <span class="s">'SO'</span><span class="p">,</span> <span class="s">'PI'</span><span class="p">,</span> <span class="s">'ST'</span><span class="p">,</span> <span class="s">'CU'</span><span class="p">,</span> <span class="s">'SU'</span><span class="p">,</span> <span class="s">'RX'</span><span class="p">,</span>
       <span class="s">'PB'</span><span class="p">,</span> <span class="s">'PL'</span><span class="p">,</span> <span class="s">'PX'</span><span class="p">,</span> <span class="s">'CT'</span><span class="p">,</span> <span class="s">'US'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---statistics">Challenge - Statistics</h2>

  <ol>
    <li>
      <p>Create a list of unique site ID’s (“plot_id”) found in the surveys data. Call it
  <code class="language-plaintext highlighter-rouge">site_names</code>. How many unique sites are there in the data? How many unique
  species are in the data?</p>
    </li>
    <li>
      <p>What is the difference between <code class="language-plaintext highlighter-rouge">len(site_names)</code> and <code class="language-plaintext highlighter-rouge">surveys_df['plot_id'].nunique()</code>?</p>
    </li>
  </ol>
</blockquote>

<h1 id="groups-in-pandas">Groups in Pandas</h1>

<p>We often want to calculate summary statistics grouped by subsets or attributes
within fields of our data. For example, we might want to calculate the average
weight of all individuals per site.</p>

<p>We can calculate basic statistics for all records in a single column using the
syntax below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>
<p>gives <strong>output</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">count</span>    <span class="mf">32283.000000</span>
<span class="n">mean</span>        <span class="mf">42.672428</span>
<span class="n">std</span>         <span class="mf">36.631259</span>
<span class="nb">min</span>          <span class="mf">4.000000</span>
<span class="mi">25</span><span class="o">%</span>         <span class="mf">20.000000</span>
<span class="mi">50</span><span class="o">%</span>         <span class="mf">37.000000</span>
<span class="mi">75</span><span class="o">%</span>         <span class="mf">48.000000</span>
<span class="nb">max</span>        <span class="mf">280.000000</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></div></div>

<p>We can also extract one specific metric if we wish:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="nb">min</span><span class="p">()</span>
<span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
<span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span>
<span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">std</span><span class="p">()</span>
<span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">count</span><span class="p">()</span>
</code></pre></div></div>

<p>But if we want to summarize by one or more variables, for example sex, we can
use <strong>Pandas’ <code class="language-plaintext highlighter-rouge">.groupby</code> method</strong>. Once we’ve created a groupby DataFrame, we
can quickly calculate summary statistics by a group of our choice.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Group data by sex
</span><span class="n">grouped_data</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'sex'</span><span class="p">)</span>
</code></pre></div></div>

<p>The <strong>pandas function <code class="language-plaintext highlighter-rouge">describe</code></strong> will return descriptive stats including: mean,
median, max, min, std and count for a particular column in the data. Pandas’
<code class="language-plaintext highlighter-rouge">describe</code> function will only return summary values for columns containing
numeric data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Summary statistics for all numeric columns by sex
</span><span class="n">grouped_data</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># Provide the mean for each numeric column by sex
</span><span class="n">grouped_data</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">grouped_data.mean()</code> <strong>OUTPUT:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">record_id</span>     <span class="n">month</span>        <span class="n">day</span>         <span class="n">year</span>    <span class="n">plot_id</span>  \
<span class="n">sex</span>
<span class="n">F</span>    <span class="mf">18036.412046</span>  <span class="mf">6.583047</span>  <span class="mf">16.007138</span>  <span class="mf">1990.644997</span>  <span class="mf">11.440854</span>
<span class="n">M</span>    <span class="mf">17754.835601</span>  <span class="mf">6.392668</span>  <span class="mf">16.184286</span>  <span class="mf">1990.480401</span>  <span class="mf">11.098282</span>

     <span class="n">hindfoot_length</span>     <span class="n">weight</span>
<span class="n">sex</span>
<span class="n">F</span>          <span class="mf">28.836780</span>  <span class="mf">42.170555</span>
<span class="n">M</span>          <span class="mf">29.709578</span>  <span class="mf">42.995379</span>

</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">groupby</code> command is powerful in that it allows us to quickly generate
summary stats.</p>

<blockquote class="challenge">
  <h2 id="challenge---summary-data">Challenge - Summary Data</h2>

  <ol>
    <li>How many recorded individuals are female <code class="language-plaintext highlighter-rouge">F</code> and how many male <code class="language-plaintext highlighter-rouge">M</code>?</li>
    <li>What happens when you group by two columns using the following syntax and
then calculate mean values?
      <ul>
        <li><code class="language-plaintext highlighter-rouge">grouped_data2 = surveys_df.groupby(['plot_id', 'sex'])</code></li>
        <li><code class="language-plaintext highlighter-rouge">grouped_data2.mean()</code></li>
      </ul>
    </li>
    <li>Summarize weight values for each site in your data. HINT: you can use the
  following syntax to only create summary statistics for one column in your data.
  <code class="language-plaintext highlighter-rouge">by_site['weight'].describe()</code></li>
  </ol>

  <blockquote class="solution">
    <h2 id="did-you-get-3-right">Did you get #3 right?<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>
    <p style="display: none;"><strong>A Snippet of the Output from challenge 3 looks like:</strong></p>

    <div class="language-plaintext output highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code> site
 1     count    1903.000000
       mean       51.822911
       std        38.176670
       min         4.000000
       25%        30.000000
       50%        44.000000
       75%        53.000000
       max       231.000000
         ...
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="quickly-creating-summary-counts-in-pandas">Quickly Creating Summary Counts in Pandas</h2>

<p>Let’s next count the number of samples for each species. We can do this in a few
ways, but we’ll use <code class="language-plaintext highlighter-rouge">groupby</code> combined with <strong>a <code class="language-plaintext highlighter-rouge">count()</code> method</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Count the number of samples by species
</span><span class="n">species_counts</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'species_id'</span><span class="p">)[</span><span class="s">'record_id'</span><span class="p">].</span><span class="n">count</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">species_counts</span><span class="p">)</span>
</code></pre></div></div>

<p>Or, we can also count just the rows that have the species “DO”:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'species_id'</span><span class="p">)[</span><span class="s">'record_id'</span><span class="p">].</span><span class="n">count</span><span class="p">()[</span><span class="s">'DO'</span><span class="p">]</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---make-a-list">Challenge - Make a list</h2>

  <p>What’s another way to create a list of species and associated <code class="language-plaintext highlighter-rouge">count</code> of the
 records in the data? Hint: you can perform <code class="language-plaintext highlighter-rouge">count</code>, <code class="language-plaintext highlighter-rouge">min</code>, etc. functions on
 groupby DataFrames in the same way you can perform them on regular DataFrames.</p>
</blockquote>

<h2 id="basic-math-functions">Basic Math Functions</h2>

<p>If we wanted to, we could perform math on an entire column of our data. For
example let’s multiply all weight values by 2. A more practical use of this might
be to normalize the data according to a mean, area, or some other value
calculated from our data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Multiply all weight values by 2
</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
</code></pre></div></div>

<h1 id="quick--easy-plotting-data-using-pandas">Quick &amp; Easy Plotting Data Using Pandas</h1>

<p>We can plot our summary stats using Pandas, too.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make sure figures appear inline in Ipython Notebook
</span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="c1"># Create a quick bar chart
</span><span class="n">species_counts</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="./aio_files/countPerSpecies.png" alt="Weight by Species Site">
Count per species site</p>

<p>We can also look at how many animals were captured in each site:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total_count</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'plot_id'</span><span class="p">)[</span><span class="s">'record_id'</span><span class="p">].</span><span class="n">nunique</span><span class="p">()</span>
<span class="c1"># Let's plot that too
</span><span class="n">total_count</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">);</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---plots">Challenge - Plots</h2>

  <ol>
    <li>Create a plot of average weight across all species per site.</li>
    <li>Create a plot of total males versus total females for the entire dataset.</li>
  </ol>
</blockquote>

<blockquote class="challenge">
  <h2 id="summary-plotting-challenge">Summary Plotting Challenge</h2>

  <p>Create a stacked bar plot, with weight on the Y axis, and the stacked variable
being sex. The plot should show total weight by sex for each site. Some
tips are below to help you solve this challenge:</p>

  <ul>
    <li>For more information on pandas plots, see <a href="http://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html#basic-plotting-plot">pandas’ documentation page on visualization</a>.</li>
    <li>You can use the code that follows to create a stacked bar plot but the data to stack
 need to be in individual columns.  Here’s a simple example with some data where
 ‘a’, ‘b’, and ‘c’ are the groups, and ‘one’ and ‘two’ are the subgroups.</li>
  </ul>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">'one'</span> <span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]),</span> <span class="s">'two'</span> <span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">,</span> <span class="s">'d'</span><span class="p">])}</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</code></pre></div>  </div>

  <p>shows the following data</p>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      one  two
  a    1    1
  b    2    2
  c    3    3
  d  NaN    4
</code></pre></div>  </div>

  <p>We can plot the above with</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot stacked data so columns 'one' and 'two' are stacked
</span><span class="n">my_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">my_df</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"The title of my graph"</span><span class="p">)</span>
</code></pre></div>  </div>

  <p><img src="./aio_files/stackedBar1.png" alt="Stacked Bar Plot"></p>

  <ul>
    <li>You can use the <code class="language-plaintext highlighter-rouge">.unstack()</code> method to transform grouped data into columns
for each plotting.  Try running <code class="language-plaintext highlighter-rouge">.unstack()</code> on some DataFrames above and see
what it yields.</li>
  </ul>

  <p>Start by transforming the grouped data (by site and sex) into an unstacked layout, then create
a stacked plot.</p>

  <blockquote class="solution">
    <h2 id="solution-to-summary-challenge">Solution to Summary Challenge<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <p style="display: none;">First we group data by site and by sex, and then calculate a total for each site.</p>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">by_site_sex</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'plot_id'</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">])</span>
<span class="n">site_sex_count</span> <span class="o">=</span> <span class="n">by_site_sex</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div>    </div>

    <p style="display: none;">This calculates the sums of weights for each sex within each site as a table</p>

    <div class="language-plaintext output highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code>site  sex
plot_id  sex
1        F      38253
         M      59979
2        F      50144
         M      57250
3        F      27251
         M      28253
4        F      39796
         M      49377
&lt;other sites removed for brevity&gt;
</code></pre></div>    </div>

    <p style="display: none;">Below we’ll use <code class="language-plaintext highlighter-rouge">.unstack()</code> on our grouped data to figure out the total weight that each sex contributed to each site.</p>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">by_site_sex</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'plot_id'</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">])</span>
<span class="n">site_sex_count</span> <span class="o">=</span> <span class="n">by_site_sex</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">site_sex_count</span><span class="p">.</span><span class="n">unstack</span><span class="p">()</span>
</code></pre></div>    </div>

    <p style="display: none;">The <code class="language-plaintext highlighter-rouge">unstack</code> method above will display the following output:</p>

    <div class="language-plaintext output highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code>sex          F      M
plot_id
1        38253  59979
2        50144  57250
3        27251  28253
4        39796  49377
&lt;other sites removed for brevity&gt;
</code></pre></div>    </div>

    <p style="display: none;">Now, create a stacked bar plot with that data where the weights for each sex are stacked by site.</p>

    <p style="display: none;">Rather than display it as a table, we can plot the above data by stacking the values of each sex as follows:</p>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">by_site_sex</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'plot_id'</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">])</span>
<span class="n">site_sex_count</span> <span class="o">=</span> <span class="n">by_site_sex</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">spc</span> <span class="o">=</span> <span class="n">site_sex_count</span><span class="p">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">s_plot</span> <span class="o">=</span> <span class="n">spc</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"Total weight by site and sex"</span><span class="p">)</span>
<span class="n">s_plot</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Weight"</span><span class="p">)</span>
<span class="n">s_plot</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Plot"</span><span class="p">)</span>
</code></pre></div>    </div>

    <p style="display: none;"><img src="./aio_files/stackedBar.png" alt="Stacked Bar Plot"></p>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Libraries enable us to extend the functionality of Python.</p>
</li>
    
    <li><p>Pandas is a popular library for working with data.</p>
</li>
    
    <li><p>A Dataframe is a Pandas data structure that allows one to access data by column (name or index) or row.</p>
</li>
    
    <li><p>Aggregating data using the <code class="language-plaintext highlighter-rouge">groupby()</code> function enables you to generate useful summaries of data quickly.</p>
</li>
    
    <li><p>Plots can be created from DataFrames or subsets of data that have been generated with <code class="language-plaintext highlighter-rouge">groupby()</code>.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="indexing-slicing-and-subsetting-dataframes-in-python" class="maintitle">Indexing, Slicing and Subsetting DataFrames in Python</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I access specific data within my data set?</p>
</li>
	
	<li><p>How can Python and Pandas help me to analyse my data?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe what 0-based indexing is.</p>
</li>
	
	<li><p>Manipulate and extract data using column headings and index locations.</p>
</li>
	
	<li><p>Employ slicing to select sets of data from a DataFrame.</p>
</li>
	
	<li><p>Employ label and integer-based indexing to select ranges of data in a dataframe.</p>
</li>
	
	<li><p>Reassign values within subsets of a DataFrame.</p>
</li>
	
	<li><p>Create a copy of a DataFrame.</p>
</li>
	
	<li><p>Query / select a subset of data using a set of criteria using the following operators: <code class="language-plaintext highlighter-rouge">==</code>, <code class="language-plaintext highlighter-rouge">!=</code>, <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">&gt;=</code>, <code class="language-plaintext highlighter-rouge">&lt;=</code>.</p>
</li>
	
	<li><p>Locate subsets of data using masks.</p>
</li>
	
	<li><p>Describe BOOLEAN objects in Python and manipulate data using BOOLEANs.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>In the first episode of this lesson, we read a CSV file into a pandas’ DataFrame. We learned how to:</p>

<ul>
  <li>save a DataFrame to a named object,</li>
  <li>perform basic math on data,</li>
  <li>calculate summary statistics, and</li>
  <li>create plots based on the data we loaded into pandas.</li>
</ul>

<p>In this lesson, we will explore ways to access different parts of the data using:</p>

<ul>
  <li>indexing,</li>
  <li>slicing, and</li>
  <li>subsetting.</li>
</ul>

<h2 id="loading-our-data">Loading our data</h2>

<p>We will continue to use the surveys dataset that we worked with in the last
episode. Let’s reopen and read in the data again:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make sure pandas is loaded
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Read in the survey CSV
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="indexing-and-slicing-in-python">Indexing and Slicing in Python</h2>

<p>We often want to work with subsets of a <strong>DataFrame</strong> object. There are
different ways to accomplish this including: using labels (column headings),
numeric ranges, or specific x,y index locations.</p>

<h2 id="selecting-data-using-labels-column-headings">Selecting data using Labels (Column Headings)</h2>

<p>We use square brackets <code class="language-plaintext highlighter-rouge">[]</code> to select a subset of a Python object. For example,
we can select all data from a column named <code class="language-plaintext highlighter-rouge">species_id</code> from the <code class="language-plaintext highlighter-rouge">surveys_df</code>
DataFrame by name. There are two ways to do this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># TIP: use the .head() method we saw earlier to make output shorter
# Method 1: select a 'subset' of the data using the column name
</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'species_id'</span><span class="p">]</span>

<span class="c1"># Method 2: use the column name as an 'attribute'; gives the same output
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">species_id</span>
</code></pre></div></div>

<p>We can also create a new object that contains only the data within the
<code class="language-plaintext highlighter-rouge">species_id</code> column as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Creates an object, surveys_species, that only contains the `species_id` column
</span><span class="n">surveys_species</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'species_id'</span><span class="p">]</span>
</code></pre></div></div>

<p>We can pass a list of column names too, as an index to select columns in that
order. This is useful when we need to reorganize our data.</p>

<p><strong>NOTE:</strong> If a column name is not contained in the DataFrame, an exception
(error) will be raised.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Select the species and plot columns from the DataFrame
</span><span class="n">surveys_df</span><span class="p">[[</span><span class="s">'species_id'</span><span class="p">,</span> <span class="s">'plot_id'</span><span class="p">]]</span>

<span class="c1"># What happens when you flip the order?
</span><span class="n">surveys_df</span><span class="p">[[</span><span class="s">'plot_id'</span><span class="p">,</span> <span class="s">'species_id'</span><span class="p">]]</span>

<span class="c1"># What happens if you ask for a column that doesn't exist?
</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'speciess'</span><span class="p">]</span>
</code></pre></div></div>

<p>Python tells us what type of error it is in the traceback, at the bottom it says
<code class="language-plaintext highlighter-rouge">KeyError: 'speciess'</code> which means that <code class="language-plaintext highlighter-rouge">speciess</code> is not a valid column name (nor a valid key in
the related Python data type dictionary).</p>

<blockquote class="callout">
  <h2 id="reminder">Reminder</h2>
  <p>The Python language and its modules (such as Pandas) define reserved
words that should not be used as identifiers when assigning objects
and variable names. Examples of reserved words in Python include Boolean values
<code class="language-plaintext highlighter-rouge">True</code> and <code class="language-plaintext highlighter-rouge">False</code>, operators <code class="language-plaintext highlighter-rouge">and</code>, <code class="language-plaintext highlighter-rouge">or</code>, and <code class="language-plaintext highlighter-rouge">not</code>, among others. The full list
of reserved words for Python version 3 is provided at
<a href="https://docs.python.org/3/reference/lexical_analysis.html#identifiers">https://docs.python.org/3/reference/lexical_analysis.html#identifiers</a>.</p>

  <p>When naming objects and variables, it’s also important to avoid using
the names of built-in data structures and methods. For example, a <em>list</em> is a built-in
data type. It is possible to use the word ‘list’ as an identifier for a new object,
for example <code class="language-plaintext highlighter-rouge">list = ['apples', 'oranges', 'bananas']</code>. However, you would then
be unable to create an empty list using <code class="language-plaintext highlighter-rouge">list()</code> or convert a tuple to a 
list using <code class="language-plaintext highlighter-rouge">list(sometuple)</code>.</p>
</blockquote>

<h2 id="extracting-range-based-subsets-slicing">Extracting Range based Subsets: Slicing</h2>

<blockquote class="callout">
  <h2 id="reminder-1">Reminder</h2>
  <p>Python uses 0-based indexing.</p>
</blockquote>

<p>Let’s remind ourselves that Python uses 0-based
indexing. This means that the first element in an object is located at position
<code class="language-plaintext highlighter-rouge">0</code>. This is different from other tools like R and Matlab that index elements
within objects starting at 1.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a list of numbers:
</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</code></pre></div></div>

<p><img src="./aio_files/slicing-indexing.png" alt="indexing diagram">
<img src="./aio_files/slicing-slicing.png" alt="slicing diagram"></p>

<blockquote class="challenge">
  <h2 id="challenge---extracting-data">Challenge - Extracting data</h2>

  <ol>
    <li>
      <p>What value does the code below return?</p>

      <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>How about this:</p>

      <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>In the example above, calling <code class="language-plaintext highlighter-rouge">a[5]</code> returns an error. Why is that?</p>
    </li>
    <li>
      <p>What about?</p>

      <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
</code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<h2 id="slicing-subsets-of-rows-in-python">Slicing Subsets of Rows in Python</h2>

<p>Slicing using the <code class="language-plaintext highlighter-rouge">[]</code> operator selects a set of rows and/or columns from a
DataFrame. To slice out a set of rows, you use the following syntax:
<code class="language-plaintext highlighter-rouge">data[start:stop]</code>. When slicing in pandas the start bound is included in the
output. The stop bound is one step BEYOND the row you want to select. So if you
want to select rows 0, 1 and 2 your code would look like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Select rows 0, 1, 2 (row 3 is not selected)
</span><span class="n">surveys_df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>The stop bound in Python is different from what you might be used to in
languages like Matlab and R.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Select the first 5 rows (rows 0, 1, 2, 3, 4)
</span><span class="n">surveys_df</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

<span class="c1"># Select the last element in the list
# (the slice starts at the last element, and ends at the end of the list)
</span><span class="n">surveys_df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div></div>

<p>We can also reassign values within subsets of our DataFrame.</p>

<p>But before we do that, let’s look at the difference between the concept of
copying objects and the concept of referencing objects in Python.</p>

<h2 id="copying-objects-vs-referencing-objects-in-python">Copying Objects vs Referencing Objects in Python</h2>

<p>Let’s start with an example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Using the 'copy() method'
</span><span class="n">true_copy_surveys_df</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Using the '=' operator
</span><span class="n">ref_surveys_df</span> <span class="o">=</span> <span class="n">surveys_df</span>
</code></pre></div></div>

<p>You might think that the code <code class="language-plaintext highlighter-rouge">ref_surveys_df = surveys_df</code> creates a fresh
distinct copy of the <code class="language-plaintext highlighter-rouge">surveys_df</code> DataFrame object. However, using the <code class="language-plaintext highlighter-rouge">=</code>
operator in the simple statement <code class="language-plaintext highlighter-rouge">y = x</code> does <strong>not</strong> create a copy of our
DataFrame. Instead, <code class="language-plaintext highlighter-rouge">y = x</code> creates a new variable <code class="language-plaintext highlighter-rouge">y</code> that references the
<strong>same</strong> object that <code class="language-plaintext highlighter-rouge">x</code> refers to. To state this another way, there is only
<strong>one</strong> object (the DataFrame), and both <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> refer to it.</p>

<p>In contrast, the <code class="language-plaintext highlighter-rouge">copy()</code> method for a DataFrame creates a true copy of the
DataFrame.</p>

<p>Let’s look at what happens when we reassign the values within a subset of the
DataFrame that references another DataFrame object:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Assign the value `0` to the first three rows of data in the DataFrame
</span><span class="n">ref_surveys_df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></div>

<p>Let’s try the following code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ref_surveys_df was created using the '=' operator
</span><span class="n">ref_surveys_df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># surveys_df is the original dataframe
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>What is the difference between these two dataframes?</p>

<p>When we assigned the first 3 columns the value of <code class="language-plaintext highlighter-rouge">0</code> using the
<code class="language-plaintext highlighter-rouge">ref_surveys_df</code> DataFrame, the <code class="language-plaintext highlighter-rouge">surveys_df</code> DataFrame is modified too.
Remember we created the reference <code class="language-plaintext highlighter-rouge">ref_survey_df</code> object above when we did
<code class="language-plaintext highlighter-rouge">ref_survey_df = surveys_df</code>. Remember <code class="language-plaintext highlighter-rouge">surveys_df</code> and <code class="language-plaintext highlighter-rouge">ref_surveys_df</code>
refer to the same exact DataFrame object. If either one changes the object,
the other will see the same changes to the reference object.</p>

<p><strong>To review and recap</strong>:</p>

<ul>
  <li>
    <p><strong>Copy</strong> uses the dataframe’s <code class="language-plaintext highlighter-rouge">copy()</code> method</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">true_copy_surveys_df</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>A <strong>Reference</strong> is created using the <code class="language-plaintext highlighter-rouge">=</code> operator</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ref_surveys_df</span> <span class="o">=</span> <span class="n">surveys_df</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>Okay, that’s enough of that. Let’s create a brand new clean dataframe from
the original data CSV file.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="slicing-subsets-of-rows-and-columns-in-python">Slicing Subsets of Rows and Columns in Python</h2>

<p>We can select specific ranges of our data in both the row and column directions
using either label or integer-based indexing.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">loc</code> is primarily <em>label</em> based indexing. <em>Integers</em> may be used but
they are interpreted as a <em>label</em>.</li>
  <li><code class="language-plaintext highlighter-rouge">iloc</code> is primarily <em>integer</em> based indexing</li>
</ul>

<p>To select a subset of rows <strong>and</strong> columns from our DataFrame, we can use the
<code class="language-plaintext highlighter-rouge">iloc</code> method. For example, we can select month, day and year (columns 2, 3
and 4 if we start counting at 1), like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># iloc[row slicing, column slicing]
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div></div>

<p>which gives the <strong>output</strong></p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   month  day  year
0      7   16  1977
1      7   16  1977
2      7   16  1977
</code></pre></div></div>

<p>Notice that we asked for a slice from 0:3. This yielded 3 rows of data. When you
ask for 0:3, you are actually telling Python to start at index 0 and select rows
0, 1, 2 <strong>up to but not including 3</strong>.</p>

<p>Let’s explore some other ways to index and select subsets of data:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Select all columns for rows of index values 0 and 10
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">:]</span>

<span class="c1"># What does this do?
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s">'species_id'</span><span class="p">,</span> <span class="s">'plot_id'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">]]</span>

<span class="c1"># What happens when you type the code below?
</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">35549</span><span class="p">],</span> <span class="p">:]</span>
</code></pre></div></div>

<p><strong>NOTE</strong>: Labels must be found in the DataFrame or you will get a <code class="language-plaintext highlighter-rouge">KeyError</code>.</p>

<p>Indexing by labels <code class="language-plaintext highlighter-rouge">loc</code> differs from indexing by integers <code class="language-plaintext highlighter-rouge">iloc</code>.
With <code class="language-plaintext highlighter-rouge">loc</code>, both the start bound and the stop bound are <strong>inclusive</strong>. When using
<code class="language-plaintext highlighter-rouge">loc</code>, integers <em>can</em> be used, but the integers refer to the
index label and not the position. For example, using <code class="language-plaintext highlighter-rouge">loc</code> and select 1:4
will get a different result than using <code class="language-plaintext highlighter-rouge">iloc</code> to select rows 1:4.</p>

<p>We can also select a specific data value using a row and
column location within the DataFrame and <code class="language-plaintext highlighter-rouge">iloc</code> indexing:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Syntax for iloc indexing to finding a specific data element
</span><span class="n">dat</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
</code></pre></div></div>

<p>In this <code class="language-plaintext highlighter-rouge">iloc</code> example,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</code></pre></div></div>

<p>gives the <strong>output</strong></p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'F'
</code></pre></div></div>

<p>Remember that Python indexing begins at 0. So, the index location [2, 6]
selects the element that is 3 rows down and 7 columns over in the DataFrame.</p>

<blockquote class="challenge">
  <h2 id="challenge---range">Challenge - Range</h2>

  <ol>
    <li>
      <p>What happens when you execute:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">surveys_df[0:1]</code></li>
        <li><code class="language-plaintext highlighter-rouge">surveys_df[:4]</code></li>
        <li><code class="language-plaintext highlighter-rouge">surveys_df[:-1]</code></li>
      </ul>
    </li>
    <li>
      <p>What happens when you call:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">surveys_df.iloc[0:4, 1:4]</code></li>
        <li><code class="language-plaintext highlighter-rouge">surveys_df.loc[0:4, 1:4]</code></li>
      </ul>
    </li>
  </ol>

  <ul>
    <li>How are the two commands different?</li>
  </ul>
</blockquote>

<h2 id="subsetting-data-using-criteria">Subsetting Data using Criteria</h2>

<p>We can also select a subset of our data using criteria. For example, we can
select all rows that have a year value of 2002:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2002</span><span class="p">]</span>
</code></pre></div></div>

<p>Which produces the following output:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">record_id</span>  <span class="n">month</span>  <span class="n">day</span>  <span class="n">year</span>  <span class="n">plot_id</span> <span class="n">species_id</span>  <span class="n">sex</span>  <span class="n">hindfoot_length</span>  <span class="n">weight</span>
<span class="mi">33320</span>      <span class="mi">33321</span>      <span class="mi">1</span>   <span class="mi">12</span>  <span class="mi">2002</span>        <span class="mi">1</span>         <span class="n">DM</span>    <span class="n">M</span>     <span class="mi">38</span>      <span class="mi">44</span>
<span class="mi">33321</span>      <span class="mi">33322</span>      <span class="mi">1</span>   <span class="mi">12</span>  <span class="mi">2002</span>        <span class="mi">1</span>         <span class="n">DO</span>    <span class="n">M</span>     <span class="mi">37</span>      <span class="mi">58</span>
<span class="mi">33322</span>      <span class="mi">33323</span>      <span class="mi">1</span>   <span class="mi">12</span>  <span class="mi">2002</span>        <span class="mi">1</span>         <span class="n">PB</span>    <span class="n">M</span>     <span class="mi">28</span>      <span class="mi">45</span>
<span class="mi">33323</span>      <span class="mi">33324</span>      <span class="mi">1</span>   <span class="mi">12</span>  <span class="mi">2002</span>        <span class="mi">1</span>         <span class="n">AB</span>  <span class="n">NaN</span>    <span class="n">NaN</span>     <span class="n">NaN</span>
<span class="mi">33324</span>      <span class="mi">33325</span>      <span class="mi">1</span>   <span class="mi">12</span>  <span class="mi">2002</span>        <span class="mi">1</span>         <span class="n">DO</span>    <span class="n">M</span>     <span class="mi">35</span>      <span class="mi">29</span>
<span class="p">...</span>
<span class="mi">35544</span>      <span class="mi">35545</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>       <span class="mi">15</span>         <span class="n">AH</span>  <span class="n">NaN</span>    <span class="n">NaN</span>     <span class="n">NaN</span>
<span class="mi">35545</span>      <span class="mi">35546</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>       <span class="mi">15</span>         <span class="n">AH</span>  <span class="n">NaN</span>    <span class="n">NaN</span>     <span class="n">NaN</span>
<span class="mi">35546</span>      <span class="mi">35547</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>       <span class="mi">10</span>         <span class="n">RM</span>    <span class="n">F</span>     <span class="mi">15</span>      <span class="mi">14</span>
<span class="mi">35547</span>      <span class="mi">35548</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>        <span class="mi">7</span>         <span class="n">DO</span>    <span class="n">M</span>     <span class="mi">36</span>      <span class="mi">51</span>
<span class="mi">35548</span>      <span class="mi">35549</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>        <span class="mi">5</span>        <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="n">NaN</span>     <span class="n">NaN</span>

<span class="p">[</span><span class="mi">2229</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">]</span>
</code></pre></div></div>

<p>Or we can select all rows that do not contain the year 2002:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">!=</span> <span class="mi">2002</span><span class="p">]</span>
</code></pre></div></div>

<p>We can define sets of criteria too:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[(</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1980</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">1985</span><span class="p">)]</span>
</code></pre></div></div>

<h3 id="python-syntax-cheat-sheet">Python Syntax Cheat Sheet</h3>

<p>We can use the syntax below when querying data by criteria from a DataFrame.
Experiment with selecting various subsets of the “surveys” data.</p>

<ul>
  <li>Equals: <code class="language-plaintext highlighter-rouge">==</code></li>
  <li>Not equals: <code class="language-plaintext highlighter-rouge">!=</code></li>
  <li>Greater than, less than: <code class="language-plaintext highlighter-rouge">&gt;</code> or <code class="language-plaintext highlighter-rouge">&lt;</code></li>
  <li>Greater than or equal to <code class="language-plaintext highlighter-rouge">&gt;=</code></li>
  <li>Less than or equal to <code class="language-plaintext highlighter-rouge">&lt;=</code></li>
</ul>

<blockquote class="challenge">
  <h2 id="challenge---queries">Challenge - Queries</h2>

  <ol>
    <li>
      <p>Select a subset of rows in the <code class="language-plaintext highlighter-rouge">surveys_df</code> DataFrame that contain data from
  the year 1999 and that contain weight values less than or equal to 8. How
  many rows did you end up with? What did your neighbor get?</p>
    </li>
    <li>
      <p>You can use the <code class="language-plaintext highlighter-rouge">isin</code> command in Python to query a DataFrame based upon a
  list of values as follows:</p>

      <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'species_id'</span><span class="p">].</span><span class="n">isin</span><span class="p">([</span><span class="n">listGoesHere</span><span class="p">])]</span>
</code></pre></div>      </div>
    </li>
  </ol>

  <p>Use the <code class="language-plaintext highlighter-rouge">isin</code> function to find all plots that contain particular species
  in the “surveys” DataFrame. How many records contain these values?</p>

  <ol>
    <li>
      <p>Experiment with other queries. Create a query that finds all rows with a
  weight value &gt; or equal to 0.</p>
    </li>
    <li>
      <p>The <code class="language-plaintext highlighter-rouge">~</code> symbol in Python can be used to return the OPPOSITE of the
  selection that you specify in Python. It is equivalent to <strong>is not in</strong>.
  Write a query that selects all rows with sex NOT equal to ‘M’ or ‘F’ in
  the “surveys” data.</p>
    </li>
  </ol>
</blockquote>

<h1 id="using-masks-to-identify-a-specific-condition">Using masks to identify a specific condition</h1>

<p>A <strong>mask</strong> can be useful to locate where a particular subset of values exist or
don’t exist - for example,  NaN, or “Not a Number” values. To understand masks,
we also need to understand <code class="language-plaintext highlighter-rouge">BOOLEAN</code> objects in Python.</p>

<p>Boolean values include <code class="language-plaintext highlighter-rouge">True</code> or <code class="language-plaintext highlighter-rouge">False</code>. For example,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set x to 5
</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># What does the code below return?
</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">5</span>

<span class="c1"># How about this?
</span><span class="n">x</span> <span class="o">==</span> <span class="mi">5</span>
</code></pre></div></div>

<p>When we ask Python whether <code class="language-plaintext highlighter-rouge">x</code> is greater than 5, it returns <code class="language-plaintext highlighter-rouge">False</code>.
This is Python’s way to say “No”. Indeed, the value of <code class="language-plaintext highlighter-rouge">x</code> is 5,
and 5 is not greater than 5.</p>

<p>To create a boolean mask:</p>

<ul>
  <li>Set the True / False criteria (e.g. <code class="language-plaintext highlighter-rouge">values &gt; 5 = True</code>)</li>
  <li>Python will then assess each value in the object to determine whether the
value meets the criteria (True) or not (False).</li>
  <li>Python creates an output object that is the same shape as the original
object, but with a <code class="language-plaintext highlighter-rouge">True</code> or <code class="language-plaintext highlighter-rouge">False</code> value for each index location.</li>
</ul>

<p>Let’s try this out. Let’s identify all locations in the survey data that have
null (missing or NaN) data values. We can use the <code class="language-plaintext highlighter-rouge">isnull</code> method to do this.
The <code class="language-plaintext highlighter-rouge">isnull</code> method will compare each cell with a null value. If an element
has a null value, it will be assigned a value of  <code class="language-plaintext highlighter-rouge">True</code> in the output object.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>

<p>A snippet of the output is below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="n">record_id</span>  <span class="n">month</span>    <span class="n">day</span>   <span class="n">year</span> <span class="n">plot_id</span> <span class="n">species_id</span>    <span class="n">sex</span>  <span class="n">hindfoot_length</span> <span class="n">weight</span>
<span class="mi">0</span>         <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">True</span>
<span class="mi">1</span>         <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">True</span>
<span class="mi">2</span>         <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">True</span>
<span class="mi">3</span>         <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">True</span>
<span class="mi">4</span>         <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">False</span>  <span class="bp">False</span>   <span class="bp">False</span>      <span class="bp">True</span>

<span class="p">[</span><span class="mi">35549</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">]</span>
</code></pre></div></div>

<p>To select the rows where there are null values, we can use
the mask as an index to subset our data as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To select just the rows with NaN values, we can use the 'any()' method
</span><span class="n">surveys_df</span><span class="p">[</span><span class="n">pd</span><span class="p">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">).</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div></div>

<p>Note that the <code class="language-plaintext highlighter-rouge">weight</code> column of our DataFrame contains many <code class="language-plaintext highlighter-rouge">null</code> or <code class="language-plaintext highlighter-rouge">NaN</code>
values. We will explore ways of dealing with this in Lesson 03.</p>

<p>We can run <code class="language-plaintext highlighter-rouge">isnull</code> on a particular column too. What does the code below do?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># What does this do?
</span><span class="n">empty_weights</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="n">pd</span><span class="p">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">])][</span><span class="s">'weight'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">empty_weights</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s take a minute to look at the statement above. We are using the Boolean
object <code class="language-plaintext highlighter-rouge">pd.isnull(surveys_df['weight'])</code> as an index to <code class="language-plaintext highlighter-rouge">surveys_df</code>. We are
asking Python to select rows that have a <code class="language-plaintext highlighter-rouge">NaN</code> value of weight.</p>

<blockquote class="challenge">
  <h2 id="challenge---putting-it-all-together">Challenge - Putting it all together</h2>

  <ol>
    <li>
      <p>Create a new DataFrame that only contains observations with sex values that
  are <strong>not</strong> female or male. Assign each sex value in the new DataFrame to a
  new value of ‘x’. Determine the number of null values in the subset.</p>
    </li>
    <li>
      <p>Create a new DataFrame that contains only observations that are of sex male
  or female and where weight values are greater than 0. Create a stacked bar
  plot of average weight by plot with male vs female values stacked for each
  plot.</p>
    </li>
  </ol>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>In Python, portions of data can be accessed using indices, slices, column headings, and condition-based subsetting.</p>
</li>
    
    <li><p>Python uses 0-based indexing, in which the first element in a list, tuple or any other data structure has an index of 0.</p>
</li>
    
    <li><p>Pandas enables common data exploration steps such as data indexing, slicing and conditional subsetting.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="data-types-and-formats" class="maintitle">Data Types and Formats</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br>
      <strong>Exercises:</strong> 25 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What types of data can be contained in a DataFrame?</p>
</li>
	
	<li><p>Why is the data type important?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe how information is stored in a Python DataFrame.</p>
</li>
	
	<li><p>Define the two main types of data in Python: text and numerics.</p>
</li>
	
	<li><p>Examine the structure of a DataFrame.</p>
</li>
	
	<li><p>Modify the format of values in a DataFrame.</p>
</li>
	
	<li><p>Describe how data types impact operations.</p>
</li>
	
	<li><p>Define, manipulate, and interconvert integers and floats in Python.</p>
</li>
	
	<li><p>Analyze datasets having missing/null values (NaN values).</p>
</li>
	
	<li><p>Write manipulated data to a file.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>The format of individual columns and rows will impact analysis performed on a
dataset read into Python. For example, you can’t perform mathematical
calculations on a string (text formatted data). This might seem obvious,
however sometimes numeric values are read into Python as strings. In this
situation, when you then try to perform calculations on the string-formatted
numeric data, you get an error.</p>

<p>In this lesson we will review ways to explore and better understand the
structure and format of our data.</p>

<h2 id="types-of-data">Types of Data</h2>

<p>How information is stored in a
DataFrame or a Python object affects what we can do with it and the outputs of
calculations as well. There are two main types of data that we will explore in
this lesson: numeric and text data types.</p>

<h2 id="numeric-data-types">Numeric Data Types</h2>

<p>Numeric data types include integers and floats. A <strong>floating point</strong> (known as a
float) number has decimal points even if that decimal point value is 0. For
example: 1.13, 2.0, 1234.345. If we have a column that contains both integers and
floating point numbers, Pandas will assign the entire column to the float data
type so the decimal points are not lost.</p>

<p>An <strong>integer</strong> will never have a decimal point. Thus if we wanted to store 1.13 as
an integer it would be stored as 1. Similarly, 1234.345 would be stored as 1234. You
will often see the data type <code class="language-plaintext highlighter-rouge">Int64</code> in Python which stands for 64 bit integer. The 64
refers to the memory allocated to store data in each cell which effectively
relates to how many digits it can store in each “cell”. Allocating space ahead of time
allows computers to optimize storage and processing efficiency.</p>

<h2 id="text-data-type">Text Data Type</h2>

<p>Text data type is known as Strings in Python, or Objects in Pandas. Strings can
contain numbers and / or characters. For example, a string might be a word, a
sentence, or several sentences. A Pandas object might also be a plot name like
‘plot1’. A string can also contain or consist of numbers. For instance, ‘1234’
could be stored as a string, as could ‘10.23’. However <strong>strings that contain
numbers can not be used for mathematical operations</strong>!</p>

<p>Pandas and base Python use slightly different names for data types. More on this
is in the table below:</p>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Pandas Type</th>
      <th>Native Python Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>object</td>
      <td>string</td>
      <td>The most general dtype. Will be assigned to your column if column has mixed types (numbers and strings).</td>
    </tr>
    <tr>
      <td>int64</td>
      <td>int</td>
      <td>Numeric characters. 64 refers to the memory allocated to hold this character.</td>
    </tr>
    <tr>
      <td>float64</td>
      <td>float</td>
      <td>Numeric characters with decimals. If a column contains numbers and NaNs (see below), pandas will default to float64, in case your missing value has a decimal.</td>
    </tr>
    <tr>
      <td>datetime64, timedelta[ns]</td>
      <td>N/A (but see the <a href="http://doc.python.org/2/library/datetime.html">datetime</a> module in Python’s standard library)</td>
      <td>Values meant to hold time data. Look into these for time series experiments.</td>
    </tr>
  </tbody>
</table>

<h2 id="checking-the-format-of-our-data">Checking the format of our data</h2>

<p>Now that we’re armed with a basic understanding of numeric and text data
types, let’s explore the format of our survey data. We’ll be working with the
same <code class="language-plaintext highlighter-rouge">surveys.csv</code> dataset that we’ve used in previous lessons.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make sure pandas is loaded
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Note that pd.read_csv is used because we imported pandas as pd
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
</code></pre></div></div>

<p>Remember that we can check the type of an object like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandas.core.frame.DataFrame
</code></pre></div></div>

<p>Next, let’s look at the structure of our surveys data. In pandas, we can check
the type of one column in a DataFrame using the syntax
<code class="language-plaintext highlighter-rouge">dataFrameName[column_name].dtype</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'sex'</span><span class="p">].</span><span class="n">dtype</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dtype('O')
</code></pre></div></div>

<p>A type ‘O’ just stands for “object” which in Pandas’ world is a string
(text).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'record_id'</span><span class="p">].</span><span class="n">dtype</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dtype('int64')
</code></pre></div></div>

<p>The type <code class="language-plaintext highlighter-rouge">int64</code> tells us that Python is storing each value within this column
as a 64 bit integer. We can use the <code class="language-plaintext highlighter-rouge">dat.dtypes</code> command to view the data type
for each column in a DataFrame (all at once).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">.</span><span class="n">dtypes</span>
</code></pre></div></div>

<p>which <strong>returns</strong>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">record_id</span>            <span class="n">int64</span>
<span class="n">month</span>                <span class="n">int64</span>
<span class="n">day</span>                  <span class="n">int64</span>
<span class="n">year</span>                 <span class="n">int64</span>
<span class="n">plot_id</span>              <span class="n">int64</span>
<span class="n">species_id</span>          <span class="nb">object</span>
<span class="n">sex</span>                 <span class="nb">object</span>
<span class="n">hindfoot_length</span>    <span class="n">float64</span>
<span class="n">weight</span>             <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</code></pre></div></div>

<p>Note that most of the columns in our Survey data are of type <code class="language-plaintext highlighter-rouge">int64</code>. This means
that they are 64 bit integers. But the weight column is a floating point value
which means it contains decimals. The <code class="language-plaintext highlighter-rouge">species_id</code> and <code class="language-plaintext highlighter-rouge">sex</code> columns are objects which
means they contain strings.</p>

<h2 id="working-with-integers-and-floats">Working With Integers and Floats</h2>

<p>So we’ve learned that computers store numbers in one of two ways: as integers or
as floating-point numbers (or floats). Integers are the numbers we usually count
with. Floats have fractional parts (decimal places).  Let’s next consider how
the data type can impact mathematical operations on our data. Addition,
subtraction, division and multiplication work on floats and integers as we’d expect.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20
</code></pre></div></div>

<p>If we divide one integer by another, we get a float.
The result on Python 3 is different than in Python 2, where the result is an
integer (integer division).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.5555555555555556
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="mi">10</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.3333333333333335
</code></pre></div></div>

<p>We can also convert a floating point number to an integer or an integer to
floating point number. Notice that Python by default rounds down when it
converts from floating point to integer.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert a to an integer
</span><span class="n">a</span> <span class="o">=</span> <span class="mf">7.83</span>
<span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert b to a float
</span><span class="n">b</span> <span class="o">=</span> <span class="mi">7</span>
<span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7.0
</code></pre></div></div>

<h2 id="working-with-our-survey-data">Working With Our Survey Data</h2>

<p>Getting back to our data, we can modify the format of values within our data, if
we want. For instance, we could convert the <code class="language-plaintext highlighter-rouge">record_id</code> field to floating point
values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert the record_id field from an integer to a float
</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'record_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'record_id'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'float64'</span><span class="p">)</span>
<span class="n">surveys_df</span><span class="p">[</span><span class="s">'record_id'</span><span class="p">].</span><span class="n">dtype</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dtype('float64')
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="changing-types">Changing Types</h2>

  <p>Try converting the column <code class="language-plaintext highlighter-rouge">plot_id</code> to floats using</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">.</span><span class="n">plot_id</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"float"</span><span class="p">)</span>
</code></pre></div>  </div>

  <p>Next try converting <code class="language-plaintext highlighter-rouge">weight</code> to an integer. What goes wrong here? What is Pandas telling you?
We will talk about some solutions to this later.</p>
</blockquote>

<h2 id="missing-data-values---nan">Missing Data Values - NaN</h2>

<p>What happened in the last challenge activity? Notice that this throws a value error:
<code class="language-plaintext highlighter-rouge">ValueError: Cannot convert NA to integer</code>. If we look at the <code class="language-plaintext highlighter-rouge">weight</code> column in the surveys
data we notice that there are NaN (<strong>N</strong>ot <strong>a</strong> <strong>N</strong>umber) values. <strong>NaN</strong> values are undefined
values that cannot be represented mathematically. Pandas, for example, will read
an empty cell in a CSV or Excel sheet as a NaN. NaNs have some desirable properties: if we
were to average the <code class="language-plaintext highlighter-rouge">weight</code> column without replacing our NaNs, Python would know to skip
over those cells.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42.672428212991356
</code></pre></div></div>

<p>Dealing with missing data values is always a challenge. It’s sometimes hard to
know why values are missing - was it because of a data entry error? Or data that
someone was unable to collect? Should the value be 0? We need to know how
missing values are represented in the dataset in order to make good decisions.
If we’re lucky, we have some metadata that will tell us more about how null
values were handled.</p>

<p>For instance, in some disciplines, like Remote Sensing, missing data values are
often defined as -9999. Having a bunch of -9999 values in your data could really
alter numeric calculations. Often in spreadsheets, cells are left empty where no
data are available. Pandas will, by default, replace those missing values with
NaN. However it is good practice to get in the habit of intentionally marking
cells that have no data, with a no data value! That way there are no questions
in the future when you (or someone else) explores your data.</p>

<h3 id="where-are-the-nans">Where Are the NaN’s?</h3>

<p>Let’s explore the NaN values in our data a bit further. Using the tools we
learned in lesson 02, we can figure out how many rows contain NaN values for
weight. We can also create a new subset from our data that only contains rows
with weight values &gt; 0 (i.e., select meaningful weight values):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">[</span><span class="n">pd</span><span class="p">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">weight</span><span class="p">)])</span>
<span class="c1"># How many rows have weight values?
</span><span class="nb">len</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>

<p>We can replace all NaN values with zeroes using the <code class="language-plaintext highlighter-rouge">.fillna()</code> method (after
making a copy of the data so we don’t lose our work):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Fill all NaN values with 0
</span><span class="n">df1</span><span class="p">[</span><span class="s">'weight'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>However NaN and 0 yield different analysis results. The mean value when NaN
values are replaced with 0 is different from when NaN values are simply thrown
out or ignored.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>38.751976145601844
</code></pre></div></div>

<p>We can fill NaN values with any value that we chose. The code below fills all
NaN values with a mean for all weight values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="p">[</span><span class="s">'weight'</span><span class="p">]</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">].</span><span class="n">mean</span><span class="p">())</span>
</code></pre></div></div>

<p>We could also chose to create a subset of our data, only keeping rows that do
not contain NaN values.</p>

<p>The point is to make conscious decisions about how to manage missing data. This
is where we think about how our data will be used and how these values will
impact the scientific conclusions made from the data.</p>

<p>Python gives us all of the tools that we need to account for these issues. We
just need to be cautious about how the decisions that we make impact scientific
results.</p>

<blockquote class="challenge">
  <h2 id="counting">Counting</h2>
  <p>Count the number of missing values per column.</p>

  <blockquote class="solution">
    <h2 id="hint">Hint<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>
    <p style="display: none;">The method <code class="language-plaintext highlighter-rouge">.count()</code> gives you the number of non-NA observations per column.
Try looking to the <code class="language-plaintext highlighter-rouge">.isnull()</code> method.</p>
  </blockquote>
</blockquote>

<h2 id="writing-out-data-to-csv">Writing Out Data to CSV</h2>

<p>We’ve learned about using manipulating data to get desired outputs. But we’ve also discussed
keeping data that has been manipulated separate from our raw data. Something we might be interested
in doing is working with only the columns that have full data. First, let’s reload the data so
we’re not mixing up all of our previous manipulations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
</code></pre></div></div>
<p>Next, let’s drop all the rows that contain missing values. We will use the command <code class="language-plaintext highlighter-rouge">dropna</code>.
By default, dropna removes rows that contain missing data for even just one column.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_na</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
</code></pre></div></div>

<p>If you now type <code class="language-plaintext highlighter-rouge">df_na</code>, you should observe that the resulting DataFrame has 30676 rows
and 9 columns, much smaller than the 35549 row original.</p>

<p>We can now use the <code class="language-plaintext highlighter-rouge">to_csv</code> command to export a DataFrame in CSV format. Note that the code
below will by default save the data into the current working directory. We can
save it to a different folder by adding the foldername and a slash before the filename:
<code class="language-plaintext highlighter-rouge">df.to_csv('foldername/out.csv')</code>. We use ‘index=False’ so that
pandas doesn’t include the index number for each line.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Write DataFrame to CSV
</span><span class="n">df_na</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data_output/surveys_complete.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>We will use this data file later in the workshop. Check out your working directory to make
sure the CSV wrote out properly, and that you can open it! If you want, try to bring it
back into Python to make sure it imports properly.</p>

<h2 id="recap">Recap</h2>

<p>What we’ve learned:</p>

<ul>
  <li>How to explore the data types of columns within a DataFrame</li>
  <li>How to change the data type</li>
  <li>What NaN values are, how they might be represented, and what this means for your work</li>
  <li>How to replace NaN values, if desired</li>
  <li>How to use <code class="language-plaintext highlighter-rouge">to_csv</code> to write manipulated data to a file.</li>
</ul>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Pandas uses other names for data types than Python, for example: <code class="language-plaintext highlighter-rouge">object</code> for textual data.</p>
</li>
    
    <li><p>A column in a DataFrame can only have one data type.</p>
</li>
    
    <li><p>The data type in a DataFrame’s single column can be checked using <code class="language-plaintext highlighter-rouge">dtype</code>.</p>
</li>
    
    <li><p>Make conscious decisions about how to manage missing data.</p>
</li>
    
    <li><p>A DataFrame can be saved to a CSV file using the <code class="language-plaintext highlighter-rouge">to_csv</code> function.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="combining-dataframes-with-pandas" class="maintitle">Combining DataFrames with Pandas</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br>
      <strong>Exercises:</strong> 25 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>Can I work with data from multiple sources?</p>
</li>
	
	<li><p>How can I combine data from different data sets?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Combine data from multiple files into a single DataFrame using merge and concat.</p>
</li>
	
	<li><p>Combine two DataFrames using a unique ID found in both DataFrames.</p>
</li>
	
	<li><p>Employ <code class="language-plaintext highlighter-rouge">to_csv</code> to export a DataFrame in CSV format.</p>
</li>
	
	<li><p>Join DataFrames using common fields (join keys).</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>In many “real world” situations, the data that we want to use come in multiple
files. We often need to combine these files into a single DataFrame to analyze
the data. The pandas package provides <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html">various methods for combining
DataFrames</a> including
<code class="language-plaintext highlighter-rouge">merge</code> and <code class="language-plaintext highlighter-rouge">concat</code>.</p>

<p>To work through the examples below, we first need to load the species and
surveys files into pandas DataFrames. In iPython:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">,</span>
                         <span class="n">keep_default_na</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s">""</span><span class="p">])</span>
<span class="n">surveys_df</span>

       <span class="n">record_id</span>  <span class="n">month</span>  <span class="n">day</span>  <span class="n">year</span>  <span class="n">plot</span> <span class="n">species</span>  <span class="n">sex</span>  <span class="n">hindfoot_length</span> <span class="n">weight</span>
<span class="mi">0</span>              <span class="mi">1</span>      <span class="mi">7</span>   <span class="mi">16</span>  <span class="mi">1977</span>     <span class="mi">2</span>      <span class="n">NA</span>    <span class="n">M</span>               <span class="mi">32</span>  <span class="n">NaN</span>
<span class="mi">1</span>              <span class="mi">2</span>      <span class="mi">7</span>   <span class="mi">16</span>  <span class="mi">1977</span>     <span class="mi">3</span>      <span class="n">NA</span>    <span class="n">M</span>               <span class="mi">33</span>  <span class="n">NaN</span>
<span class="mi">2</span>              <span class="mi">3</span>      <span class="mi">7</span>   <span class="mi">16</span>  <span class="mi">1977</span>     <span class="mi">2</span>      <span class="n">DM</span>    <span class="n">F</span>               <span class="mi">37</span>  <span class="n">NaN</span>
<span class="mi">3</span>              <span class="mi">4</span>      <span class="mi">7</span>   <span class="mi">16</span>  <span class="mi">1977</span>     <span class="mi">7</span>      <span class="n">DM</span>    <span class="n">M</span>               <span class="mi">36</span>  <span class="n">NaN</span>
<span class="mi">4</span>              <span class="mi">5</span>      <span class="mi">7</span>   <span class="mi">16</span>  <span class="mi">1977</span>     <span class="mi">3</span>      <span class="n">DM</span>    <span class="n">M</span>               <span class="mi">35</span>  <span class="n">NaN</span>
<span class="p">...</span>          <span class="p">...</span>    <span class="p">...</span>  <span class="p">...</span>   <span class="p">...</span>   <span class="p">...</span>     <span class="p">...</span>  <span class="p">...</span>              <span class="p">...</span>  <span class="p">...</span>
<span class="mi">35544</span>      <span class="mi">35545</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>    <span class="mi">15</span>      <span class="n">AH</span>  <span class="n">NaN</span>              <span class="n">NaN</span>  <span class="n">NaN</span>
<span class="mi">35545</span>      <span class="mi">35546</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>    <span class="mi">15</span>      <span class="n">AH</span>  <span class="n">NaN</span>              <span class="n">NaN</span>  <span class="n">NaN</span>
<span class="mi">35546</span>      <span class="mi">35547</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>    <span class="mi">10</span>      <span class="n">RM</span>    <span class="n">F</span>               <span class="mi">15</span>   <span class="mi">14</span>
<span class="mi">35547</span>      <span class="mi">35548</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>     <span class="mi">7</span>      <span class="n">DO</span>    <span class="n">M</span>               <span class="mi">36</span>   <span class="mi">51</span>
<span class="mi">35548</span>      <span class="mi">35549</span>     <span class="mi">12</span>   <span class="mi">31</span>  <span class="mi">2002</span>     <span class="mi">5</span>     <span class="n">NaN</span>  <span class="n">NaN</span>              <span class="n">NaN</span>  <span class="n">NaN</span>

<span class="p">[</span><span class="mi">35549</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">]</span>

<span class="n">species_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/species.csv"</span><span class="p">,</span>
                         <span class="n">keep_default_na</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s">""</span><span class="p">])</span>
<span class="n">species_df</span>
  <span class="n">species_id</span>             <span class="n">genus</span>          <span class="n">species</span>     <span class="n">taxa</span>
<span class="mi">0</span>          <span class="n">AB</span>        <span class="n">Amphispiza</span>        <span class="n">bilineata</span>     <span class="n">Bird</span>
<span class="mi">1</span>          <span class="n">AH</span>  <span class="n">Ammospermophilus</span>          <span class="n">harrisi</span>   <span class="n">Rodent</span>
<span class="mi">2</span>          <span class="n">AS</span>        <span class="n">Ammodramus</span>       <span class="n">savannarum</span>     <span class="n">Bird</span>
<span class="mi">3</span>          <span class="n">BA</span>           <span class="n">Baiomys</span>          <span class="n">taylori</span>   <span class="n">Rodent</span>
<span class="mi">4</span>          <span class="n">CB</span>   <span class="n">Campylorhynchus</span>  <span class="n">brunneicapillus</span>     <span class="n">Bird</span>
<span class="p">..</span>        <span class="p">...</span>               <span class="p">...</span>              <span class="p">...</span>      <span class="p">...</span>
<span class="mi">49</span>         <span class="n">UP</span>            <span class="n">Pipilo</span>              <span class="n">sp</span><span class="p">.</span>     <span class="n">Bird</span>
<span class="mi">50</span>         <span class="n">UR</span>            <span class="n">Rodent</span>              <span class="n">sp</span><span class="p">.</span>   <span class="n">Rodent</span>
<span class="mi">51</span>         <span class="n">US</span>           <span class="n">Sparrow</span>              <span class="n">sp</span><span class="p">.</span>     <span class="n">Bird</span>
<span class="mi">52</span>         <span class="n">ZL</span>       <span class="n">Zonotrichia</span>       <span class="n">leucophrys</span>     <span class="n">Bird</span>
<span class="mi">53</span>         <span class="n">ZM</span>           <span class="n">Zenaida</span>         <span class="n">macroura</span>     <span class="n">Bird</span>

<span class="p">[</span><span class="mi">54</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">]</span>
</code></pre></div></div>

<p>Take note that the <code class="language-plaintext highlighter-rouge">read_csv</code> method we used can take some additional options which
we didn’t use previously. Many functions in Python have a set of options that
can be set by the user if needed. In this case, we have told pandas to assign
empty values in our CSV to NaN <code class="language-plaintext highlighter-rouge">keep_default_na=False, na_values=[""]</code>.
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html#pandas.read_csv">More about all of the read_csv options here.</a></p>

<h1 id="concatenating-dataframes">Concatenating DataFrames</h1>

<p>We can use the <code class="language-plaintext highlighter-rouge">concat</code> function in pandas to append either columns or rows from
one DataFrame to another.  Let’s grab two subsets of our data to see how this
works.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read in first 10 lines of surveys table
</span><span class="n">survey_sub</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Grab the last 10 rows
</span><span class="n">survey_sub_last10</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Reset the index values to the second dataframe appends properly
</span><span class="n">survey_sub_last10</span> <span class="o">=</span> <span class="n">survey_sub_last10</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># drop=True option avoids adding new index column with old index values
</span></code></pre></div></div>

<p>When we concatenate DataFrames, we need to specify the axis. <code class="language-plaintext highlighter-rouge">axis=0</code> tells
pandas to stack the second DataFrame UNDER the first one. It will automatically
detect whether the column names are the same and will stack accordingly.
<code class="language-plaintext highlighter-rouge">axis=1</code> will stack the columns in the second DataFrame to the RIGHT of the
first DataFrame. To stack the data vertically, we need to make sure we have the
same columns and associated column format in both datasets. When we stack
horizontally, we want to make sure what we are doing makes sense (i.e. the data are
related in some way).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Stack the DataFrames on top of each other
</span><span class="n">vertical_stack</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">survey_sub</span><span class="p">,</span> <span class="n">survey_sub_last10</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Place the DataFrames side by side
</span><span class="n">horizontal_stack</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">survey_sub</span><span class="p">,</span> <span class="n">survey_sub_last10</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="row-index-values-and-concat">Row Index Values and Concat</h3>
<p>Have a look at the <code class="language-plaintext highlighter-rouge">vertical_stack</code> dataframe? Notice anything unusual?
The row indexes for the two data frames <code class="language-plaintext highlighter-rouge">survey_sub</code> and <code class="language-plaintext highlighter-rouge">survey_sub_last10</code>
have been repeated. We can reindex the new dataframe using the <code class="language-plaintext highlighter-rouge">reset_index()</code> method.</p>

<h2 id="writing-out-data-to-csv">Writing Out Data to CSV</h2>

<p>We can use the <code class="language-plaintext highlighter-rouge">to_csv</code> command to do export a DataFrame in CSV format. Note that the code
below will by default save the data into the current working directory. We can
save it to a different folder by adding the foldername and a slash to the file
<code class="language-plaintext highlighter-rouge">vertical_stack.to_csv('foldername/out.csv')</code>. We use the ‘index=False’ so that
pandas doesn’t include the index number for each line.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Write DataFrame to CSV
</span><span class="n">vertical_stack</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data_output/out.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>Check out your working directory to make sure the CSV wrote out properly, and
that you can open it! If you want, try to bring it back into Python to make sure
it imports properly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For kicks read our output back into Python and make sure all looks good
</span><span class="n">new_output</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data_output/out.csv'</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s">""</span><span class="p">])</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---combine-data">Challenge - Combine Data</h2>

  <p>In the data folder, there are two survey data files: <code class="language-plaintext highlighter-rouge">surveys2001.csv</code> and
<code class="language-plaintext highlighter-rouge">surveys2002.csv</code>. Read the data into Python and combine the files to make one
new data frame. Create a plot of average plot weight by year grouped by sex.
Export your results as a CSV and make sure it reads back into Python properly.</p>
</blockquote>

<h1 id="joining-dataframes">Joining DataFrames</h1>

<p>When we concatenated our DataFrames we simply added them to each other -
stacking them either vertically or side by side. Another way to combine
DataFrames is to use columns in each dataset that contain common values (a
common unique id). Combining DataFrames using a common field is called
“joining”. The columns containing the common values are called “join key(s)”.
Joining DataFrames in this way is often useful when one DataFrame is a “lookup
table” containing additional data that we want to include in the other.</p>

<p>NOTE: This process of joining tables is similar to what we do with tables in an
SQL database.</p>

<p>For example, the <code class="language-plaintext highlighter-rouge">species.csv</code> file that we’ve been working with is a lookup
table. This table contains the genus, species and taxa code for 55 species. The
species code is unique for each line. These species are identified in our survey
data as well using the unique species code. Rather than adding 3 more columns
for the genus, species and taxa to each of the 35,549 line Survey data table, we
can maintain the shorter table with the species information. When we want to
access that information, we can create a query that joins the additional columns
of information to the Survey data.</p>

<p>Storing data in this way has many benefits including:</p>

<ol>
  <li>It ensures consistency in the spelling of species attributes (genus, species
and taxa) given each species is only entered once. Imagine the possibilities
for spelling errors when entering the genus and species thousands of times!</li>
  <li>It also makes it easy for us to make changes to the species information once
without having to find each instance of it in the larger survey data.</li>
  <li>It optimizes the size of our data.</li>
</ol>

<h2 id="joining-two-dataframes">Joining Two DataFrames</h2>

<p>To better understand joins, let’s grab the first 10 lines of our data as a
subset to work with. We’ll use the <code class="language-plaintext highlighter-rouge">.head</code> method to do this. We’ll also read
in a subset of the species table.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read in first 10 lines of surveys table
</span><span class="n">survey_sub</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Import a small subset of the species data designed for this part of the lesson.
# It is stored in the data folder.
</span><span class="n">species_sub</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/speciesSubset.csv'</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s">""</span><span class="p">])</span>
</code></pre></div></div>

<p>In this example, <code class="language-plaintext highlighter-rouge">species_sub</code> is the lookup table containing genus, species, and
taxa names that we want to join with the data in <code class="language-plaintext highlighter-rouge">survey_sub</code> to produce a new
DataFrame that contains all of the columns from both <code class="language-plaintext highlighter-rouge">species_df</code> <em>and</em>
<code class="language-plaintext highlighter-rouge">survey_df</code>.</p>

<h2 id="identifying-join-keys">Identifying join keys</h2>

<p>To identify appropriate join keys we first need to know which field(s) are
shared between the files (DataFrames). We might inspect both DataFrames to
identify these columns. If we are lucky, both DataFrames will have columns with
the same name that also contain the same data. If we are less lucky, we need to
identify a (differently-named) column in each DataFrame that contains the same
information.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">species_sub</span><span class="p">.</span><span class="n">columns</span>

<span class="n">Index</span><span class="p">([</span><span class="s">u'species_id'</span><span class="p">,</span> <span class="s">u'genus'</span><span class="p">,</span> <span class="s">u'species'</span><span class="p">,</span> <span class="s">u'taxa'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'object'</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">survey_sub</span><span class="p">.</span><span class="n">columns</span>

<span class="n">Index</span><span class="p">([</span><span class="s">u'record_id'</span><span class="p">,</span> <span class="s">u'month'</span><span class="p">,</span> <span class="s">u'day'</span><span class="p">,</span> <span class="s">u'year'</span><span class="p">,</span> <span class="s">u'plot_id'</span><span class="p">,</span> <span class="s">u'species_id'</span><span class="p">,</span>
       <span class="s">u'sex'</span><span class="p">,</span> <span class="s">u'hindfoot_length'</span><span class="p">,</span> <span class="s">u'weight'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'object'</span><span class="p">)</span>
</code></pre></div></div>

<p>In our example, the join key is the column containing the two-letter species
identifier, which is called <code class="language-plaintext highlighter-rouge">species_id</code>.</p>

<p>Now that we know the fields with the common species ID attributes in each
DataFrame, we are almost ready to join our data. However, since there are
<a href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/">different types of joins</a>, we
also need to decide which type of join makes sense for our analysis.</p>

<h2 id="inner-joins">Inner joins</h2>

<p>The most common type of join is called an <em>inner join</em>. An inner join combines
two DataFrames based on a join key and returns a new DataFrame that contains
<strong>only</strong> those rows that have matching values in <em>both</em> of the original
DataFrames.</p>

<p>Inner joins yield a DataFrame that contains only rows where the value being
joined exists in BOTH tables. An example of an inner join, adapted from <a href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/">Jeff Atwood’s blogpost about SQL joins</a> is below:</p>

<p><img src="./aio_files/inner-join.png" alt="Inner join -- courtesy of codinghorror.com"></p>

<p>The pandas function for performing joins is called <code class="language-plaintext highlighter-rouge">merge</code> and an Inner join is
the default option:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">merged_inner</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">survey_sub</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">species_sub</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">)</span>
<span class="c1"># In this case `species_id` is the only column name in  both dataframes, so if we skipped `left_on`
# And `right_on` arguments we would still get the same result
</span>
<span class="c1"># What's the size of the output data?
</span><span class="n">merged_inner</span><span class="p">.</span><span class="n">shape</span>
<span class="n">merged_inner</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   record_id  month  day  year  plot_id species_id sex  hindfoot_length  \
0          1      7   16  1977        2         NL   M               32
1          2      7   16  1977        3         NL   M               33
2          3      7   16  1977        2         DM   F               37
3          4      7   16  1977        7         DM   M               36
4          5      7   16  1977        3         DM   M               35
5          8      7   16  1977        1         DM   M               37
6          9      7   16  1977        1         DM   F               34
7          7      7   16  1977        2         PE   F              NaN

   weight       genus   species    taxa
0     NaN     Neotoma  albigula  Rodent
1     NaN     Neotoma  albigula  Rodent
2     NaN   Dipodomys  merriami  Rodent
3     NaN   Dipodomys  merriami  Rodent
4     NaN   Dipodomys  merriami  Rodent
5     NaN   Dipodomys  merriami  Rodent
6     NaN   Dipodomys  merriami  Rodent
7     NaN  Peromyscus  eremicus  Rodent
</code></pre></div></div>

<p>The result of an inner join of <code class="language-plaintext highlighter-rouge">survey_sub</code> and <code class="language-plaintext highlighter-rouge">species_sub</code> is a new DataFrame
that contains the combined set of columns from <code class="language-plaintext highlighter-rouge">survey_sub</code> and <code class="language-plaintext highlighter-rouge">species_sub</code>. It
<em>only</em> contains rows that have two-letter species codes that are the same in
both the <code class="language-plaintext highlighter-rouge">survey_sub</code> and <code class="language-plaintext highlighter-rouge">species_sub</code> DataFrames. In other words, if a row in
<code class="language-plaintext highlighter-rouge">survey_sub</code> has a value of <code class="language-plaintext highlighter-rouge">species_id</code> that does <em>not</em> appear in the <code class="language-plaintext highlighter-rouge">species_id</code>
column of <code class="language-plaintext highlighter-rouge">species</code>, it will not be included in the DataFrame returned by an
inner join.  Similarly, if a row in <code class="language-plaintext highlighter-rouge">species_sub</code> has a value of <code class="language-plaintext highlighter-rouge">species_id</code>
that does <em>not</em> appear in the <code class="language-plaintext highlighter-rouge">species_id</code> column of <code class="language-plaintext highlighter-rouge">survey_sub</code>, that row will not
be included in the DataFrame returned by an inner join.</p>

<p>The two DataFrames that we want to join are passed to the <code class="language-plaintext highlighter-rouge">merge</code> function using
the <code class="language-plaintext highlighter-rouge">left</code> and <code class="language-plaintext highlighter-rouge">right</code> argument. The <code class="language-plaintext highlighter-rouge">left_on='species'</code> argument tells <code class="language-plaintext highlighter-rouge">merge</code>
to use the <code class="language-plaintext highlighter-rouge">species_id</code> column as the join key from <code class="language-plaintext highlighter-rouge">survey_sub</code> (the <code class="language-plaintext highlighter-rouge">left</code>
DataFrame). Similarly , the <code class="language-plaintext highlighter-rouge">right_on='species_id'</code> argument tells <code class="language-plaintext highlighter-rouge">merge</code> to
use the <code class="language-plaintext highlighter-rouge">species_id</code> column as the join key from <code class="language-plaintext highlighter-rouge">species_sub</code> (the <code class="language-plaintext highlighter-rouge">right</code>
DataFrame). For inner joins, the order of the <code class="language-plaintext highlighter-rouge">left</code> and <code class="language-plaintext highlighter-rouge">right</code> arguments does
not matter.</p>

<p>The result <code class="language-plaintext highlighter-rouge">merged_inner</code> DataFrame contains all of the columns from <code class="language-plaintext highlighter-rouge">survey_sub</code>
(record id, month, day, etc.) as well as all the columns from <code class="language-plaintext highlighter-rouge">species_sub</code>
(species_id, genus, species, and taxa).</p>

<p>Notice that <code class="language-plaintext highlighter-rouge">merged_inner</code> has fewer rows than <code class="language-plaintext highlighter-rouge">survey_sub</code>. This is an
indication that there were rows in <code class="language-plaintext highlighter-rouge">surveys_df</code> with value(s) for <code class="language-plaintext highlighter-rouge">species_id</code> that
do not exist as value(s) for <code class="language-plaintext highlighter-rouge">species_id</code> in <code class="language-plaintext highlighter-rouge">species_df</code>.</p>

<h2 id="left-joins">Left joins</h2>

<p>What if we want to add information from <code class="language-plaintext highlighter-rouge">species_sub</code> to <code class="language-plaintext highlighter-rouge">survey_sub</code> without
losing any of the information from <code class="language-plaintext highlighter-rouge">survey_sub</code>? In this case, we use a different
type of join called a “left outer join”, or a “left join”.</p>

<p>Like an inner join, a left join uses join keys to combine two DataFrames. Unlike
an inner join, a left join will return <em>all</em> of the rows from the <code class="language-plaintext highlighter-rouge">left</code>
DataFrame, even those rows whose join key(s) do not have values in the <code class="language-plaintext highlighter-rouge">right</code>
DataFrame.  Rows in the <code class="language-plaintext highlighter-rouge">left</code> DataFrame that are missing values for the join
key(s) in the <code class="language-plaintext highlighter-rouge">right</code> DataFrame will simply have null (i.e., NaN or None) values
for those columns in the resulting joined DataFrame.</p>

<p>Note: a left join will still discard rows from the <code class="language-plaintext highlighter-rouge">right</code> DataFrame that do not
have values for the join key(s) in the <code class="language-plaintext highlighter-rouge">left</code> DataFrame.</p>

<p><img src="./aio_files/left-join.png" alt="Left Join"></p>

<p>A left join is performed in pandas by calling the same <code class="language-plaintext highlighter-rouge">merge</code> function used for
inner join, but using the <code class="language-plaintext highlighter-rouge">how='left'</code> argument:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">merged_left</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">survey_sub</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">species_sub</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">)</span>
<span class="n">merged_left</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   record_id  month  day  year  plot_id species_id sex  hindfoot_length  \
0          1      7   16  1977        2         NL   M               32
1          2      7   16  1977        3         NL   M               33
2          3      7   16  1977        2         DM   F               37
3          4      7   16  1977        7         DM   M               36
4          5      7   16  1977        3         DM   M               35
5          6      7   16  1977        1         PF   M               14
6          7      7   16  1977        2         PE   F              NaN
7          8      7   16  1977        1         DM   M               37
8          9      7   16  1977        1         DM   F               34
9         10      7   16  1977        6         PF   F               20

   weight       genus   species    taxa
0     NaN     Neotoma  albigula  Rodent
1     NaN     Neotoma  albigula  Rodent
2     NaN   Dipodomys  merriami  Rodent
3     NaN   Dipodomys  merriami  Rodent
4     NaN   Dipodomys  merriami  Rodent
5     NaN         NaN       NaN     NaN
6     NaN  Peromyscus  eremicus  Rodent
7     NaN   Dipodomys  merriami  Rodent
8     NaN   Dipodomys  merriami  Rodent
9     NaN         NaN       NaN     NaN
</code></pre></div></div>

<p>The result DataFrame from a left join (<code class="language-plaintext highlighter-rouge">merged_left</code>) looks very much like the
result DataFrame from an inner join (<code class="language-plaintext highlighter-rouge">merged_inner</code>) in terms of the columns it
contains. However, unlike <code class="language-plaintext highlighter-rouge">merged_inner</code>, <code class="language-plaintext highlighter-rouge">merged_left</code> contains the <strong>same
number of rows</strong> as the original <code class="language-plaintext highlighter-rouge">survey_sub</code> DataFrame. When we inspect
<code class="language-plaintext highlighter-rouge">merged_left</code>, we find there are rows where the information that should have
come from <code class="language-plaintext highlighter-rouge">species_sub</code> (i.e., <code class="language-plaintext highlighter-rouge">species_id</code>, <code class="language-plaintext highlighter-rouge">genus</code>, and <code class="language-plaintext highlighter-rouge">taxa</code>) is
missing (they contain NaN values):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">merged_left</span><span class="p">[</span> <span class="n">pd</span><span class="p">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">merged_left</span><span class="p">.</span><span class="n">genus</span><span class="p">)</span> <span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   record_id  month  day  year  plot_id species_id sex  hindfoot_length  \
5          6      7   16  1977        1         PF   M               14
9         10      7   16  1977        6         PF   F               20

   weight genus species taxa
5     NaN   NaN     NaN  NaN
9     NaN   NaN     NaN  NaN
</code></pre></div></div>

<p>These rows are the ones where the value of <code class="language-plaintext highlighter-rouge">species_id</code> from <code class="language-plaintext highlighter-rouge">survey_sub</code> (in this
case, <code class="language-plaintext highlighter-rouge">PF</code>) does not occur in <code class="language-plaintext highlighter-rouge">species_sub</code>.</p>

<h2 id="other-join-types">Other join types</h2>

<p>The pandas <code class="language-plaintext highlighter-rouge">merge</code> function supports two other join types:</p>

<ul>
  <li>Right (outer) join: Invoked by passing <code class="language-plaintext highlighter-rouge">how='right'</code> as an argument. Similar
to a left join, except <em>all</em> rows from the <code class="language-plaintext highlighter-rouge">right</code> DataFrame are kept, while
rows from the <code class="language-plaintext highlighter-rouge">left</code> DataFrame without matching join key(s) values are
discarded.</li>
  <li>Full (outer) join: Invoked by passing <code class="language-plaintext highlighter-rouge">how='outer'</code> as an argument. This join
type returns the all pairwise combinations of rows from both DataFrames; i.e.,
the result DataFrame will <code class="language-plaintext highlighter-rouge">NaN</code> where data is missing in one of the dataframes. This join type is
very rarely used.</li>
</ul>

<h1 id="final-challenges">Final Challenges</h1>

<blockquote class="challenge">
  <h2 id="challenge---distributions">Challenge - Distributions</h2>
  <p>Create a new DataFrame by joining the contents of the <code class="language-plaintext highlighter-rouge">surveys.csv</code> and
<code class="language-plaintext highlighter-rouge">species.csv</code> tables. Then calculate and plot the distribution of:</p>

  <ol>
    <li>taxa by plot</li>
    <li>taxa by sex by plot</li>
  </ol>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge---diversity-index">Challenge - Diversity Index</h2>

  <ol>
    <li>In the data folder, there is a <code class="language-plaintext highlighter-rouge">plots.csv</code> file that contains information about the
type associated with each plot. Use that data to summarize the number of
plots by plot type.</li>
    <li>
      <p>Calculate a diversity index of your choice for control vs rodent exclosure
plots. The index should consider both species abundance and number of
species. You might choose to use the simple <a href="http://www.amnh.org/explore/curriculum-collections/biodiversity-counts/plant-ecology/how-to-calculate-a-biodiversity-index">biodiversity index described
here</a>
which calculates diversity as:</p>

      <p>the number of species in the plot / the total number of individuals in the plot = Biodiversity index.</p>
    </li>
  </ol>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Pandas’ <code class="language-plaintext highlighter-rouge">merge</code> and <code class="language-plaintext highlighter-rouge">concat</code> can be used to combine subsets of a DataFrame, or even data from different files.</p>
</li>
    
    <li><p><code class="language-plaintext highlighter-rouge">join</code> function combines DataFrames based on index or column.</p>
</li>
    
    <li><p>Joining two DataFrames can be done in multiple ways (left, right, and inner) depending on what data must be in the final DataFrame.</p>
</li>
    
    <li><p><code class="language-plaintext highlighter-rouge">to_csv</code> can be used to write out DataFrames in CSV format.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="data-workflows-and-automation" class="maintitle">Data Workflows and Automation</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br>
      <strong>Exercises:</strong> 50 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>Can I automate operations in Python?</p>
</li>
	
	<li><p>What are functions and why should I use them?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe why for loops are used in Python.</p>
</li>
	
	<li><p>Employ for loops to automate data analysis.</p>
</li>
	
	<li><p>Write unique filenames in Python.</p>
</li>
	
	<li><p>Build reusable code in Python.</p>
</li>
	
	<li><p>Write functions using conditional statements (if, then, else).</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>So far, we’ve used Python and the pandas library to explore and manipulate
individual datasets by hand, much like we would do in a spreadsheet. The beauty
of using a programming language like Python, though, comes from the ability to
automate data processing through the use of loops and functions.</p>

<h2 id="for-loops">For loops</h2>

<p>Loops allow us to repeat a workflow (or series of actions) a given number of
times or while some condition is true. We would use a loop to automatically
process data that’s stored in multiple files (daily values with one file per
year, for example). Loops lighten our work load by performing repeated tasks
without our direct involvement and make it less likely that we’ll introduce
errors by making mistakes while processing each file by hand.</p>

<p>Let’s write a simple for loop that simulates what a kid might see during a
visit to the zoo:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">animals</span> <span class="o">=</span> <span class="p">[</span><span class="s">'lion'</span><span class="p">,</span> <span class="s">'tiger'</span><span class="p">,</span> <span class="s">'crocodile'</span><span class="p">,</span> <span class="s">'vulture'</span><span class="p">,</span> <span class="s">'hippo'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['lion', 'tiger', 'crocodile', 'vulture', 'hippo']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">creature</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lion
tiger
crocodile
vulture
hippo
</code></pre></div></div>

<p>The line defining the loop must start with <code class="language-plaintext highlighter-rouge">for</code> and end with a colon, and the
body of the loop must be indented.</p>

<p>In this example, <code class="language-plaintext highlighter-rouge">creature</code> is the loop variable that takes the value of the next
entry in <code class="language-plaintext highlighter-rouge">animals</code> every time the loop goes around. We can call the loop variable
anything we like. After the loop finishes, the loop variable will still exist
and will have the value of the last entry in the collection:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">animals</span> <span class="o">=</span> <span class="p">[</span><span class="s">'lion'</span><span class="p">,</span> <span class="s">'tiger'</span><span class="p">,</span> <span class="s">'crocodile'</span><span class="p">,</span> <span class="s">'vulture'</span><span class="p">,</span> <span class="s">'hippo'</span><span class="p">]</span>
<span class="k">for</span> <span class="n">creature</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'The loop variable is now: '</span> <span class="o">+</span> <span class="n">creature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The loop variable is now: hippo
</code></pre></div></div>

<p>We are not asking Python to print the value of the loop variable anymore, but
the for loop still runs and the value of <code class="language-plaintext highlighter-rouge">creature</code> changes on each pass through
the loop. The statement <code class="language-plaintext highlighter-rouge">pass</code> in the body of the loop means “do nothing”.</p>

<blockquote class="challenge">
  <h2 id="challenge---loops">Challenge - Loops</h2>

  <ol>
    <li>
      <p>What happens if we don’t include the <code class="language-plaintext highlighter-rouge">pass</code> statement?</p>
    </li>
    <li>
      <p>Rewrite the loop so that the animals are separated by commas, not new lines
(Hint: You can concatenate strings using a plus sign. For example,
<code class="language-plaintext highlighter-rouge">print(string1 + string2)</code> outputs ‘string1string2’).</p>
    </li>
  </ol>
</blockquote>

<h2 id="automating-data-processing-using-for-loops">Automating data processing using For Loops</h2>

<p>The file we’ve been using so far, <code class="language-plaintext highlighter-rouge">surveys.csv</code>, contains 25 years of data and is
very large. We would like to separate the data for each year into a separate
file.</p>

<p>Let’s start by making a new directory inside the folder <code class="language-plaintext highlighter-rouge">data</code> to store all of
these files using the module <code class="language-plaintext highlighter-rouge">os</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">'data/yearly_files'</span><span class="p">)</span>
</code></pre></div></div>

<p>The command <code class="language-plaintext highlighter-rouge">os.mkdir</code> is equivalent to <code class="language-plaintext highlighter-rouge">mkdir</code> in the shell. Just so we are
sure, we can check that the new directory was created within the <code class="language-plaintext highlighter-rouge">data</code> folder:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'data'</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['plots.csv',
 'portal_mammals.sqlite',
 'species.csv',
 'survey2001.csv',
 'survey2002.csv',
 'surveys.csv',
 'surveys2002_temp.csv',
 'yearly_files']
</code></pre></div></div>

<p>The command <code class="language-plaintext highlighter-rouge">os.listdir</code> is equivalent to <code class="language-plaintext highlighter-rouge">ls</code> in the shell.</p>

<p>In previous lessons, we saw how to use the library pandas to load the species
data into memory as a DataFrame, how to select a subset of the data using some
criteria, and how to write the DataFrame into a CSV file. Let’s write a script
that performs those three steps in sequence for the year 2002:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>

<span class="c1"># Select only data for the year 2002
</span><span class="n">surveys2002</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2002</span><span class="p">]</span>

<span class="c1"># Write the new DataFrame to a CSV file
</span><span class="n">surveys2002</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data/yearly_files/surveys2002.csv'</span><span class="p">)</span>
</code></pre></div></div>

<p>To create yearly data files, we could repeat the last two commands over and
over, once for each year of data. Repeating code is neither elegant nor
practical, and is very likely to introduce errors into your code. We want to
turn what we’ve just written into a loop that repeats the last two commands for
every year in the dataset.</p>

<p>Let’s start by writing a loop that prints the names of the files we want
to create - the dataset we are using covers 1977 through 2002, and we’ll create
a separate file for each of those years. Listing the filenames is a good way to
confirm that the loop is behaving as we expect.</p>

<p>We have seen that we can loop over a list of items, so we need a list of years
to loop over. We can get the years in our DataFrame with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0        1977
1        1977
2        1977
3        1977
         ...
35545    2002
35546    2002
35547    2002
35548    2002
</code></pre></div></div>

<p>but we want only unique years, which we can get using the <code class="language-plaintext highlighter-rouge">unique</code> method
which we have already seen.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987,
       1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
       1999, 2000, 2001, 2002], dtype=int64)
</code></pre></div></div>

<p>Putting this into our for loop we get</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">unique</span><span class="p">():</span>
   <span class="n">filename</span><span class="o">=</span><span class="s">'data/yearly_files/surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
   <span class="k">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data/yearly_files/surveys1977.csv
data/yearly_files/surveys1978.csv
data/yearly_files/surveys1979.csv
data/yearly_files/surveys1980.csv
data/yearly_files/surveys1981.csv
data/yearly_files/surveys1982.csv
data/yearly_files/surveys1983.csv
data/yearly_files/surveys1984.csv
data/yearly_files/surveys1985.csv
data/yearly_files/surveys1986.csv
data/yearly_files/surveys1987.csv
data/yearly_files/surveys1988.csv
data/yearly_files/surveys1989.csv
data/yearly_files/surveys1990.csv
data/yearly_files/surveys1991.csv
data/yearly_files/surveys1992.csv
data/yearly_files/surveys1993.csv
data/yearly_files/surveys1994.csv
data/yearly_files/surveys1995.csv
data/yearly_files/surveys1996.csv
data/yearly_files/surveys1997.csv
data/yearly_files/surveys1998.csv
data/yearly_files/surveys1999.csv
data/yearly_files/surveys2000.csv
data/yearly_files/surveys2001.csv
data/yearly_files/surveys2002.csv
</code></pre></div></div>

<p>We can now add the rest of the steps we need to create separate text files:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">unique</span><span class="p">():</span>

    <span class="c1"># Select data for the year
</span>    <span class="n">surveys_year</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>

    <span class="c1"># Write the new DataFrame to a CSV file
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="s">'data/yearly_files/surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
    <span class="n">surveys_year</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>

<p>Look inside the <code class="language-plaintext highlighter-rouge">yearly_files</code> directory and check a couple of the files you
just created to confirm that everything worked as expected.</p>

<h2 id="writing-unique-file-names">Writing Unique File Names</h2>

<p>Notice that the code above created a unique filename for each year.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="s">'data/yearly_files/surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
</code></pre></div></div>

<p>Let’s break down the parts of this name:</p>

<ul>
  <li>The first part is some text that specifies the directory to store our
data file in (data/yearly_files/) and the first part of the file name
(surveys): <code class="language-plaintext highlighter-rouge">'data/yearly_files/surveys'</code></li>
  <li>We can concatenate this with the value of a variable, in this case <code class="language-plaintext highlighter-rouge">year</code> by
using the plus <code class="language-plaintext highlighter-rouge">+</code> sign and the variable we want to add to the file name: <code class="language-plaintext highlighter-rouge">+
str(year)</code></li>
  <li>Then we add the file extension as another text string: <code class="language-plaintext highlighter-rouge">+ '.csv'</code></li>
</ul>

<p>Notice that we use single quotes to add text strings. The variable is not
surrounded by quotes. This code produces the string
<code class="language-plaintext highlighter-rouge">data/yearly_files/surveys2002.csv</code> which contains the path to the new filename
AND the file name itself.</p>

<blockquote class="challenge">
  <h2 id="challenge---modifying-loops">Challenge - Modifying loops</h2>

  <ol>
    <li>
      <p>Some of the surveys you saved are missing data (they have null values that
show up as NaN - Not A Number - in the DataFrames and do not show up in the text
files). Modify the for loop so that the entries with null values are not
included in the yearly files.</p>
    </li>
    <li>
      <p>Let’s say you only want to look at data from a given multiple of years. How would you modify your loop in order to generate a data file for only every 5th year, starting from 1977?</p>
    </li>
    <li>
      <p>Instead of splitting out the data by years, a colleague wants to do analyses each species separately. How would you write a unique CSV file for each species?</p>
    </li>
  </ol>
</blockquote>

<h2 id="building-reusable-and-modular-code-with-functions">Building reusable and modular code with functions</h2>

<p>Suppose that separating large data files into individual yearly files is a task
that we frequently have to perform. We could write a <strong>for loop</strong> like the one above
every time we needed to do it but that would be time consuming and error prone.
A more elegant solution would be to create a reusable tool that performs this
task with minimum input from the user. To do this, we are going to turn the code
we’ve already written into a function.</p>

<p>Functions are reusable, self-contained pieces of code that are called with a
single command. They can be designed to accept arguments as input and return
values, but they don’t need to do either. Variables declared inside functions
only exist while the function is running and if a variable within the function
(a local variable) has the same name as a variable somewhere else in the code,
the local variable hides but doesn’t overwrite the other.</p>

<p>Every method used in Python (for example, <code class="language-plaintext highlighter-rouge">print</code>) is a function, and the
libraries we import (say, <code class="language-plaintext highlighter-rouge">pandas</code>) are a collection of functions. We will only
use functions that are housed within the same code that uses them, but
we can also write functions that can be used by different programs.</p>

<p>Functions are declared following this general structure:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">this_is_the_function_name</span><span class="p">(</span><span class="n">input_argument1</span><span class="p">,</span> <span class="n">input_argument2</span><span class="p">):</span>

    <span class="c1"># The body of the function is indented
</span>    <span class="c1"># This function prints the two arguments to screen
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'The function arguments are:'</span><span class="p">,</span> <span class="n">input_argument1</span><span class="p">,</span> <span class="n">input_argument2</span><span class="p">,</span> <span class="s">'(this is done inside the function!)'</span><span class="p">)</span>

    <span class="c1"># And returns their product
</span>    <span class="k">return</span> <span class="n">input_argument1</span> <span class="o">*</span> <span class="n">input_argument2</span>
</code></pre></div></div>

<p>The function declaration starts with the word <code class="language-plaintext highlighter-rouge">def</code>, followed by the function
name and any arguments in parenthesis, and ends in a colon. The body of the
function is indented just like loops are. If the function returns something when
it is called, it includes a return statement at the end.</p>

<p>This is how we call the function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">product_of_inputs</span> <span class="o">=</span> <span class="n">this_is_the_function_name</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The function arguments are: 2 5 (this is done inside the function!)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'Their product is:'</span><span class="p">,</span> <span class="n">product_of_inputs</span><span class="p">,</span> <span class="s">'(this is done outside the function!)'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Their product is: 10 (this is done outside the function!)
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---functions">Challenge - Functions</h2>

  <ol>
    <li>Change the values of the arguments in the function and check its output</li>
    <li>Try calling the function by giving it the wrong number of arguments (not 2)
  or not assigning the function call to a variable (no <code class="language-plaintext highlighter-rouge">product_of_inputs =</code>)</li>
    <li>Declare a variable inside the function and test to see where it exists (Hint:
  can you print it from outside the function?)</li>
    <li>Explore what happens when a variable both inside and outside the function
  have the same name. What happens to the global variable when you change the
  value of the local variable?</li>
  </ol>
</blockquote>

<p>We can now turn our code for saving yearly data files into a function. There are
many different “chunks” of this code that we can turn into functions, and we can
even create functions that call other functions inside them. Let’s first write a
function that separates data for just one year and saves that data to a file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">one_year_csv_writer</span><span class="p">(</span><span class="n">this_year</span><span class="p">,</span> <span class="n">all_data</span><span class="p">):</span>
    <span class="s">"""
    Writes a csv file for data from a given year.

    this_year -- year for which data is extracted
    all_data -- DataFrame with multi-year data
    """</span>

    <span class="c1"># Select data for the year
</span>    <span class="n">surveys_year</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">all_data</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">this_year</span><span class="p">]</span>

    <span class="c1"># Write the new DataFrame to a csv file
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="s">'data/yearly_files/function_surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">this_year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
    <span class="n">surveys_year</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>

<p>The text between the two sets of triple double quotes is called a docstring and
contains the documentation for the function. It does nothing when the function
is running and is therefore not necessary, but it is good practice to include
docstrings as a reminder of what the code does. Docstrings in functions also
become part of their ‘official’ documentation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">one_year_csv_writer</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">one_year_csv_writer</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>

<p>We changed the root of the name of the CSV file so we can distinguish it from
the one we wrote before. Check the <code class="language-plaintext highlighter-rouge">yearly_files</code> directory for the file. Did it
do what you expect?</p>

<p>What we really want to do, though, is create files for multiple years without
having to request them one by one. Let’s write another function that replaces
the entire <code class="language-plaintext highlighter-rouge">for</code> loop by looping through a sequence of years and repeatedly
calling the function we just wrote, <code class="language-plaintext highlighter-rouge">one_year_csv_writer</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">yearly_data_csv_writer</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">all_data</span><span class="p">):</span>
    <span class="s">"""
    Writes separate CSV files for each year of data.

    start_year -- the first year of data we want
    end_year -- the last year of data we want
    all_data -- DataFrame with multi-year data
    """</span>

    <span class="c1"># "end_year" is the last year of data we want to pull, so we loop to end_year+1
</span>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">one_year_csv_writer</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">all_data</span><span class="p">)</span>
</code></pre></div></div>

<p>Because people will naturally expect that the end year for the files is the last
year with data, the for loop inside the function ends at <code class="language-plaintext highlighter-rouge">end_year + 1</code>. By
writing the entire loop into a function, we’ve made a reusable tool for whenever
we need to break a large data file into yearly files. Because we can specify the
first and last year for which we want files, we can even use this function to
create files for a subset of the years available. This is how we call this
function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>

<span class="c1"># Create CSV files
</span><span class="n">yearly_data_csv_writer</span><span class="p">(</span><span class="mi">1977</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>

<p>BEWARE! If you are using IPython Notebooks and you modify a function, you MUST
re-run that cell in order for the changed function to be available to the rest
of the code. Nothing will visibly happen when you do this, though, because
defining a function without <em>calling</em> it doesn’t produce an output. Any
cells that use the now-changed functions will also have to be re-run for their
output to change.</p>

<blockquote class="challenge">
  <h2 id="challenge-more-functions">Challenge: More functions</h2>

  <ol>
    <li>Add two arguments to the functions we wrote that take the path of the
directory where the files will be written and the root of the file name.
Create a new set of files with a different name in a different directory.</li>
    <li>How could you use the function <code class="language-plaintext highlighter-rouge">yearly_data_csv_writer</code> to create a CSV file
for only one year? (Hint: think about the syntax for <code class="language-plaintext highlighter-rouge">range</code>)</li>
    <li>Make the functions return a list of the files they have written. There are
many ways you can do this (and you should try them all!): either of the
functions can print to screen, either can use a return statement to give back
numbers or strings to their function call, or you can use some combination of
the two. You could also try using the <code class="language-plaintext highlighter-rouge">os</code> library to list the contents of
directories.</li>
    <li>Explore what happens when variables are declared inside each of the functions
versus in the main (non-indented) body of your code. What is the scope of the
variables (where are they visible)? What happens when they have the same name
  but are given different values?</li>
  </ol>
</blockquote>

<p>The functions we wrote demand that we give them a value for every argument.
Ideally, we would like these functions to be as flexible and independent as
possible. Let’s modify the function <code class="language-plaintext highlighter-rouge">yearly_data_csv_writer</code> so that the
<code class="language-plaintext highlighter-rouge">start_year</code> and <code class="language-plaintext highlighter-rouge">end_year</code> default to the full range of the data if they are
not supplied by the user. Arguments can be given default values with an equal
sign in the function declaration. Any arguments in the function without default
values (here, <code class="language-plaintext highlighter-rouge">all_data</code>) is a required argument and MUST come before the
argument with default values (which are optional in the function call).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">yearly_data_arg_test</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1977</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">2002</span><span class="p">):</span>
    <span class="s">"""
    Modified from yearly_data_csv_writer to test default argument values!

    start_year -- the first year of data we want (default 1977)
    end_year -- the last year of data we want (default 2002)
    all_data -- DataFrame with multi-year data
    """</span>

    <span class="k">return</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>


<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both optional arguments:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Default values:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Both optional arguments:	1988 1993
Default values:		1977 2002
</code></pre></div></div>

<p>The “\t” in the <code class="language-plaintext highlighter-rouge">print</code> statements are tabs, used to make the text align and be
easier to read.</p>

<p>But what if our dataset doesn’t start in 1977 and end in 2002? We can modify the
function so that it looks for the start and end years in the dataset if those
dates are not provided:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">yearly_data_arg_test</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""
    Modified from yearly_data_csv_writer to test default argument values!

    all_data -- DataFrame with multi-year data
    start_year -- the first year of data we want, Check all_data! (default None)
    end_year -- the last year of data we want; Check all_data! (default None)
    """</span>

    <span class="k">if</span> <span class="n">start_year</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_data</span><span class="p">.</span><span class="n">year</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end_year</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_data</span><span class="p">.</span><span class="n">year</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>


<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both optional arguments:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Default values:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Both optional arguments:	1988 1993
Default values:		1977 2002
</code></pre></div></div>

<p>The default values of the <code class="language-plaintext highlighter-rouge">start_year</code> and <code class="language-plaintext highlighter-rouge">end_year</code> arguments in the function
<code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> are now <code class="language-plaintext highlighter-rouge">None</code>. This is a built-in constant in Python
that indicates the absence of a value - essentially, that the variable exists in
the namespace of the function (the directory of variable names) but that it
doesn’t correspond to any existing object.</p>

<blockquote class="challenge">
  <h2 id="challenge---variables">Challenge - Variables</h2>

  <ol>
    <li>
      <p>What type of object corresponds to a variable declared as <code class="language-plaintext highlighter-rouge">None</code>? (Hint:
create a variable set to <code class="language-plaintext highlighter-rouge">None</code> and use the function <code class="language-plaintext highlighter-rouge">type()</code>)</p>
    </li>
    <li>
      <p>Compare the behavior of the function <code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> when the
arguments have <code class="language-plaintext highlighter-rouge">None</code> as a default and when they do not have default values.</p>
    </li>
    <li>
      <p>What happens if you only include a value for <code class="language-plaintext highlighter-rouge">start_year</code> in the function
call? Can you write the function call with only a value for <code class="language-plaintext highlighter-rouge">end_year</code>? (Hint:
think about how the function must be assigning values to each of the arguments -
this is related to the need to put the arguments without default values before
those with default values in the function definition!)</p>
    </li>
  </ol>
</blockquote>

<h2 id="if-statements">If Statements</h2>

<p>The body of the test function now has two conditionals (if statements) that
check the values of <code class="language-plaintext highlighter-rouge">start_year</code> and <code class="language-plaintext highlighter-rouge">end_year</code>. If statements execute a segment
of code when some condition is met. They commonly look something like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">if</span> <span class="n">a</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>  <span class="c1"># Meets first condition?
</span>
    <span class="c1"># if a IS less than zero
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'a is a negative number'</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">a</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>  <span class="c1"># Did not meet first condition. meets second condition?
</span>
    <span class="c1"># if a ISN'T less than zero and IS more than zero
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'a is a positive number'</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>  <span class="c1"># Met neither condition
</span>
    <span class="c1"># if a ISN'T less than zero and ISN'T more than zero
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'a must be zero!'</span><span class="p">)</span>
</code></pre></div></div>

<p>Which would return:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a is a positive number
</code></pre></div></div>

<p>Change the value of <code class="language-plaintext highlighter-rouge">a</code> to see how this function works. The statement <code class="language-plaintext highlighter-rouge">elif</code>
means “else if”, and all of the conditional statements must end in a colon.</p>

<p>The if statements in the function <code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> check whether there is an
object associated with the variable names <code class="language-plaintext highlighter-rouge">start_year</code> and <code class="language-plaintext highlighter-rouge">end_year</code>. If those
variables are <code class="language-plaintext highlighter-rouge">None</code>, the if statements return the boolean <code class="language-plaintext highlighter-rouge">True</code> and execute whatever
is in their body. On the other hand, if the variable names are associated with
some value (they got a number in the function call), the if statements return <code class="language-plaintext highlighter-rouge">False</code>
and do not execute. The opposite conditional statements, which would return
<code class="language-plaintext highlighter-rouge">True</code> if the variables were associated with objects (if they had received value
in the function call), would be <code class="language-plaintext highlighter-rouge">if start_year</code> and <code class="language-plaintext highlighter-rouge">if end_year</code>.</p>

<p>As we’ve written it so far, the function <code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> associates
values in the function call with arguments in the function definition just based
on their order. If the function gets only two values in the function call, the
first one will be associated with <code class="language-plaintext highlighter-rouge">all_data</code> and the second with <code class="language-plaintext highlighter-rouge">start_year</code>,
regardless of what we intended them to be. We can get around this problem by
calling the function using keyword arguments, where each of the arguments in the
function definition is associated with a keyword and the function call passes
values to the function using these keywords:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Default values:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'No keywords:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1988</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both keywords, in order:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">1993</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1988</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both keywords, flipped:</span><span class="se">\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1988</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'One keyword, default end:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'One keyword, default start:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Default values:		1977 2002
No keywords:		1988 1993
Both keywords, in order:	1988 1993
Both keywords, flipped:	1988 1993
One keyword, default end:	1988 2002
One keyword, default start:	1977 1993
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---modifying-functions">Challenge - Modifying functions</h2>

  <ol>
    <li>
      <p>Rewrite the <code class="language-plaintext highlighter-rouge">one_year_csv_writer</code> and <code class="language-plaintext highlighter-rouge">yearly_data_csv_writer</code> functions to
have keyword arguments with default values</p>
    </li>
    <li>
      <p>Modify the functions so that they don’t create yearly files if there is no
data for a given year and display an alert to the user (Hint: use conditional
statements to do this. For an extra challenge, use <code class="language-plaintext highlighter-rouge">try</code>
statements!)</p>
    </li>
    <li>
      <p>The code below checks to see whether a directory exists and creates one if it
doesn’t. Add some code to your function that writes out the CSV files, to check
for a directory to write to.</p>
    </li>
  </ol>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="s">'dir_name_here'</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">):</span>
   <span class="k">print</span><span class="p">(</span><span class="s">'Processed directory exists'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">'dir_name_here'</span><span class="p">)</span>
   <span class="k">print</span><span class="p">(</span><span class="s">'Processed directory created'</span><span class="p">)</span>
</code></pre></div>  </div>

  <ol>
    <li>The code that you have written so far to loop through the years is good,
however it is not necessarily reproducible with different datasets.
For instance, what happens to the code if we have additional years of data
in our CSV files? Using the tools that you learned in the previous activities,
make a list of all years represented in the data. Then create a loop to process
your data, that begins at the earliest year and ends at the latest year using
that list.</li>
  </ol>

  <p>HINT: you can create a loop with a list as follows: <code class="language-plaintext highlighter-rouge">for years in year_list:</code></p>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Loops help automate repetitive tasks over sets of items.</p>
</li>
    
    <li><p>Loops combined with functions provide a way to process data more efficiently than we could by hand.</p>
</li>
    
    <li><p>Conditional statements enable execution of different operations on different data.</p>
</li>
    
    <li><p>Functions enable code reuse.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="making-plots-with-plotnine" class="maintitle">Making Plots With plotnine</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br>
      <strong>Exercises:</strong> 50 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I visualize data in Python?</p>
</li>
	
	<li><p>What is ‘grammar of graphics’?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Create a <code class="language-plaintext highlighter-rouge">plotnine</code> object.</p>
</li>
	
	<li><p>Set universal plot settings.</p>
</li>
	
	<li><p>Modify an existing plotnine object.</p>
</li>
	
	<li><p>Change the aesthetics of a plot such as color.</p>
</li>
	
	<li><p>Edit the axis labels.</p>
</li>
	
	<li><p>Build complex plots using a step-by-step approach.</p>
</li>
	
	<li><p>Create scatter plots, box plots, and time series plots.</p>
</li>
	
	<li><p>Use the facet_wrap and facet_grid commands to create a collection of plots splitting the data by a factor variable.</p>
</li>
	
	<li><p>Create customized plot styles to meet their needs.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="disclaimer">Disclaimer</h2>

<p>Python has powerful built-in plotting capabilities such as <code class="language-plaintext highlighter-rouge">matplotlib</code>, but for
this episode, we will be using the <a href="https://plotnine.readthedocs.io/en/stable"><code class="language-plaintext highlighter-rouge">plotnine</code></a>
package, which facilitates the creation of highly-informative plots of
structured data based on the R implementation of <a href="https://ggplot2.tidyverse.org/"><code class="language-plaintext highlighter-rouge">ggplot2</code></a>
and <a href="http://link.springer.com/book/10.1007%2F0-387-28695-0">The Grammar of Graphics</a>
by Leland Wilkinson. The <code class="language-plaintext highlighter-rouge">plotnine</code>
package is built on top of Matplotlib and interacts well with Pandas.</p>

<blockquote class="callout">
  <h2 id="reminder">Reminder</h2>
  <p><code class="language-plaintext highlighter-rouge">plotnine</code> is not included in the standard Anaconda installation and needs
to be installed separately. If you haven’t done so already, you can find installation
instructions on the <a href="https://datacarpentry.org/python-ecology-lesson/setup.html#download-plotting-package">Setup page</a>.</p>
</blockquote>

<p>Just as with the other packages, <code class="language-plaintext highlighter-rouge">plotnine</code> needs to be imported. It is good
practice to not just load an entire package such as <code class="language-plaintext highlighter-rouge">from plotnine import *</code>,
but to use an abbreviation as we used <code class="language-plaintext highlighter-rouge">pd</code> for Pandas:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">plotnine</span> <span class="k">as</span> <span class="n">p9</span>
</code></pre></div></div>

<p>From now on, the functions of <code class="language-plaintext highlighter-rouge">plotnine</code> are available using <code class="language-plaintext highlighter-rouge">p9.</code>. For the
exercise, we will use the <code class="language-plaintext highlighter-rouge">surveys.csv</code> data set, with the <code class="language-plaintext highlighter-rouge">NA</code> values removed</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">surveys_complete</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>
<span class="n">surveys_complete</span> <span class="o">=</span> <span class="n">surveys_complete</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="plotting-with-plotnine">Plotting with plotnine</h2>

<p>The <code class="language-plaintext highlighter-rouge">plotnine</code> package (cfr. other packages conform The Grammar of Graphics) supports the creation of complex plots from data in a
dataframe. It uses default settings, which help creating publication quality
plots with a minimal amount of settings and tweaking.</p>

<p><code class="language-plaintext highlighter-rouge">plotnine</code> graphics are built step by step by adding new elements adding
different elements on top of each other using the <code class="language-plaintext highlighter-rouge">+</code> operator. Putting the
individual steps together in brackets <code class="language-plaintext highlighter-rouge">()</code> provides Python-compatible syntax.</p>

<p>To build a <code class="language-plaintext highlighter-rouge">plotnine</code> graphic we need to:</p>

<ul>
  <li>Bind the plot to a specific data frame using the <code class="language-plaintext highlighter-rouge">data</code> argument:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">))</span>
</code></pre></div></div>
<p>As we have not defined anything else, just an empty figure is available and
presented.</p>

<p>As we have not defined anything else, just an empty figure is available and
presented.</p>

<ul>
  <li>Define aesthetics (<code class="language-plaintext highlighter-rouge">aes</code>), by <strong>selecting variables</strong> used in the plot and
<code class="language-plaintext highlighter-rouge">mapping</code> them to a presentation such as plotting size, shape, color, etc. You
can interpret this as: <strong>which</strong> of the variables will influence the plotted
objects/geometries:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">)))</span>
</code></pre></div></div>

<p>The most important aes mappings are: <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">y</code>, <code class="language-plaintext highlighter-rouge">alpha</code>, <code class="language-plaintext highlighter-rouge">color</code>, <code class="language-plaintext highlighter-rouge">colour</code>,
<code class="language-plaintext highlighter-rouge">fill</code>, <code class="language-plaintext highlighter-rouge">linetype</code>, <code class="language-plaintext highlighter-rouge">shape</code>, <code class="language-plaintext highlighter-rouge">size</code> and <code class="language-plaintext highlighter-rouge">stroke</code>.</p>

<ul>
  <li>Still no specific data is plotted, as we have to define what kind of geometry
will be used for the plot. The most straightforward is probably using points.
Points is one of the <code class="language-plaintext highlighter-rouge">geoms</code> options, the graphical representation of the data
in the plot. Others are lines, bars,… To add a geom to the plot use <code class="language-plaintext highlighter-rouge">+</code>
operator:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">+</code> in the <code class="language-plaintext highlighter-rouge">plotnine</code> package is particularly useful because it allows you
to modify existing <code class="language-plaintext highlighter-rouge">plotnine</code> objects. This means you can easily set up plot
<em>templates</em> and conveniently explore different types of plots, so the above
plot can also be generated with code like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create
</span><span class="n">surveys_plot</span> <span class="o">=</span> <span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
                         <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">))</span>

<span class="c1"># Draw the plot
</span><span class="n">surveys_plot</span> <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="./aio_files/06_first_plot.png" alt="png"></p>

<blockquote class="challenge">
  <h2 id="challenge---bar-chart">Challenge - bar chart</h2>
  <p>Working on the <code class="language-plaintext highlighter-rouge">surveys_complete</code> data set, use the <code class="language-plaintext highlighter-rouge">plot-id</code> column to
create a <code class="language-plaintext highlighter-rouge">bar</code>-plot that counts the number of records for each plot. (Check
the documentation of the bar geometry to handle the counts)</p>

  <blockquote class="solution">
    <h2 id="answers">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'plot_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_bar</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>    </div>

    <p style="display: none;"><img src="./aio_files/06_challenge_bar.png" alt="png"></p>
  </blockquote>
</blockquote>

<p>Notes:</p>

<ul>
  <li>Anything you put in the <code class="language-plaintext highlighter-rouge">ggplot()</code> function can be seen by any geom layers
that you add (i.e., these are universal plot settings). This includes the <code class="language-plaintext highlighter-rouge">x</code>
and <code class="language-plaintext highlighter-rouge">y</code> axis you set up in <code class="language-plaintext highlighter-rouge">aes()</code>.</li>
  <li>You can also specify aesthetics for a given <code class="language-plaintext highlighter-rouge">geom</code> independently of the
aesthetics defined globally in the <code class="language-plaintext highlighter-rouge">ggplot()</code> function.</li>
</ul>

<h2 id="building-your-plots-iteratively">Building your plots iteratively</h2>

<p>Building plots with <code class="language-plaintext highlighter-rouge">plotnine</code> is typically an iterative process. We start by
defining the dataset we’ll use, lay the axes, and choose a geom. Hence, the
<code class="language-plaintext highlighter-rouge">data</code>, <code class="language-plaintext highlighter-rouge">aes</code> and <code class="language-plaintext highlighter-rouge">geom-*</code> are the elementary elements of any graph:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Then, we start modifying this plot to extract more information from it. For
instance, we can add transparency (alpha) to avoid overplotting:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_alpha_plot.png" alt="png"></p>

<p>We can also add colors for all the points</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_blue_plot.png" alt="png"></p>

<p>Or to color each species in the plot differently, map the <code class="language-plaintext highlighter-rouge">species_id</code> column
to the color aesthetic:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_color_plot.png" alt="png"></p>

<p>Apart from the adaptations of the arguments and settings of the <code class="language-plaintext highlighter-rouge">data</code>, <code class="language-plaintext highlighter-rouge">aes</code>
and <code class="language-plaintext highlighter-rouge">geom-*</code> elements, additional elements can be added as well, using the <code class="language-plaintext highlighter-rouge">+</code>
operator:</p>

<ul>
  <li>Changing the labels:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">xlab</span><span class="p">(</span><span class="s">"Weight (g)"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_color_label_plot.png" alt="png"></p>

<ul>
  <li>Defining scale for colors, axes,… For example, a log-version of the x-axis
could support the interpretation of the lower numbers:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">xlab</span><span class="p">(</span><span class="s">"Weight (g)"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">scale_x_log10</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_log_plot.png" alt="png"></p>

<ul>
  <li>Changing the theme (<code class="language-plaintext highlighter-rouge">theme_*</code>) or some specific theming (<code class="language-plaintext highlighter-rouge">theme</code>) elements.
Usually plots with white background look more readable when printed.  We can
set the background to white using the function <code class="language-plaintext highlighter-rouge">theme_bw()</code>.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">xlab</span><span class="p">(</span><span class="s">"Weight (g)"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">scale_x_log10</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">theme_bw</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_white_plot.png" alt="png"></p>

<blockquote class="challenge">
  <h2 id="challenge---bar-plot-adaptations">Challenge - Bar plot adaptations</h2>
  <p>Adapt the bar plot of the previous exercise by mapping the <code class="language-plaintext highlighter-rouge">sex</code> variable to
the color fill of the bar chart. Change the <code class="language-plaintext highlighter-rouge">scale</code> of the color fill by
providing the colors <code class="language-plaintext highlighter-rouge">blue</code> and <code class="language-plaintext highlighter-rouge">orange</code> manually
(see <a href="https://plotnine.readthedocs.io/en/stable/api.html#color-and-fill-scales">API reference</a> to find the appropriate function).</p>

  <blockquote class="solution">
    <h2 id="answers-1">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'plot_id'</span><span class="p">,</span>
                          <span class="n">fill</span><span class="o">=</span><span class="s">'sex'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_bar</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">scale_fill_manual</span><span class="p">([</span><span class="s">"blue"</span><span class="p">,</span> <span class="s">"orange"</span><span class="p">])</span>
<span class="p">)</span>
</code></pre></div>    </div>
    <p style="display: none;"><img src="./aio_files/06_challenge_color_bar.png" alt="png"></p>
  </blockquote>
</blockquote>

<h2 id="plotting-distributions">Plotting distributions</h2>

<p>Visualizing distributions is a common task during data exploration and
analysis. To visualize the distribution of <code class="language-plaintext highlighter-rouge">weight</code> within each <code class="language-plaintext highlighter-rouge">species_id</code>
group, a boxplot can be used:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'weight'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_boxplot</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_boxplot.png" alt="png"></p>

<p>By adding points of the individual observations to the boxplot, we can have a
better idea of the number of measurements and of their distribution:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'weight'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_point_boxplot.png" alt="png"></p>

<blockquote class="challenge">
  <h2 id="challenge---distributions">Challenge - distributions</h2>

  <p>Boxplots are useful summaries, but hide the <em>shape</em> of the distribution.
For example, if there is a bimodal distribution, this would not be observed
with a boxplot. An alternative to the boxplot is the violin plot (sometimes
known as a beanplot), where the shape (of the density of points) is drawn.</p>

  <p>In many types of data, it is important to consider the <em>scale</em> of the
observations.  For example, it may be worth changing the scale of the axis
to better distribute the observations in the space of the plot.</p>

  <ul>
    <li>Replace the box plot with a violin plot, see <code class="language-plaintext highlighter-rouge">geom_violin()</code></li>
    <li>Represent weight on the log10 scale, see <code class="language-plaintext highlighter-rouge">scale_y_log10()</code></li>
    <li>Add color to the datapoints on your boxplot according to the plot from which
the sample was taken (<code class="language-plaintext highlighter-rouge">plot_id</code>)</li>
  </ul>

  <p>Hint: Check the class for <code class="language-plaintext highlighter-rouge">plot_id</code>. By using <code class="language-plaintext highlighter-rouge">factor()</code> within the <code class="language-plaintext highlighter-rouge">aes</code>
mapping of a variable, <code class="language-plaintext highlighter-rouge">plotnine</code> will handle the values as category values.</p>

  <blockquote class="solution">
    <h2 id="answers-2">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'factor(plot_id)'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_violin</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"0.7"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">scale_y_log10</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>    </div>
    <p style="display: none;"><img src="./aio_files/06_challenge_boxplot.png" alt="png"></p>
  </blockquote>
</blockquote>

<h2 id="plotting-time-series-data">Plotting time series data</h2>

<p>Let’s calculate number of counts per year for each species. To do that we need
to group data first and count the species (<code class="language-plaintext highlighter-rouge">species_id</code>) within each group.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yearly_counts</span> <span class="o">=</span> <span class="n">surveys_complete</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'species_id'</span><span class="p">])[</span><span class="s">'species_id'</span><span class="p">].</span><span class="n">count</span><span class="p">()</span>
<span class="n">yearly_counts</span>
</code></pre></div></div>

<p>When checking the result of the previous calculation, we actually have both the
<code class="language-plaintext highlighter-rouge">year</code> and the <code class="language-plaintext highlighter-rouge">species_id</code> as a row index. We can reset this index to use both
as column variable:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yearly_counts</span> <span class="o">=</span> <span class="n">yearly_counts</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'counts'</span><span class="p">)</span>
<span class="n">yearly_counts</span>
</code></pre></div></div>

<p>Timelapse data can be visualised as a line plot (<code class="language-plaintext highlighter-rouge">geom_line</code>) with years on <code class="language-plaintext highlighter-rouge">x</code>
axis and counts on the <code class="language-plaintext highlighter-rouge">y</code> axis.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">yearly_counts</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'counts'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_line</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Unfortunately this does not work, because we plot data for all the species
together. We need to tell <code class="language-plaintext highlighter-rouge">plotnine</code> to draw a line for each species by
modifying the aesthetic function and map the species_id to the color:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">yearly_counts</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'counts'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_line</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_time_plot.png" alt="png"></p>

<h2 id="faceting">Faceting</h2>

<p>As any other library supporting the Grammar of Graphics, <code class="language-plaintext highlighter-rouge">plotnine</code> has a
special technique called <em>faceting</em> that allows to split one plot into multiple
plots based on a factor variable included in the dataset.</p>

<p>Consider our scatter plot of the <code class="language-plaintext highlighter-rouge">weight</code> versus the <code class="language-plaintext highlighter-rouge">hindfoot_length</code> from the
previous sections:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>We can now keep the same code and at the <code class="language-plaintext highlighter-rouge">facet_wrap</code> on a chosen variable to
split out the graph and make a separate graph for each of the groups in that
variable. As an example, use <code class="language-plaintext highlighter-rouge">sex</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s">"sex"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>
<p><img src="./aio_files/06_facet_plot.png" alt="png"></p>

<p>We can apply the same concept on any of the available categorical variables:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s">"plot_id"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_facet_all_plot.png" alt="png"></p>

<p>The <code class="language-plaintext highlighter-rouge">facet_wrap</code> geometry extracts plots into an arbitrary number of dimensions
to allow them to cleanly fit on one page. On the other hand, the <code class="language-plaintext highlighter-rouge">facet_grid</code>
geometry allows you to explicitly specify how you want your plots to be
arranged via formula notation (<code class="language-plaintext highlighter-rouge">rows ~ columns</code>; a <code class="language-plaintext highlighter-rouge">.</code> can be used as a
placeholder that indicates only one row or column).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># only select the years of interest
</span><span class="n">survey_2000</span> <span class="o">=</span> <span class="n">surveys_complete</span><span class="p">[</span><span class="n">surveys_complete</span><span class="p">[</span><span class="s">"year"</span><span class="p">].</span><span class="n">isin</span><span class="p">([</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">])]</span>

<span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">survey_2000</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s">'species_id'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">facet_grid</span><span class="p">(</span><span class="s">"year ~ sex"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>
<p><img src="./aio_files/06_select_plot.png" alt="png"></p>

<blockquote class="challenge">
  <h2 id="challenge---facetting">Challenge - facetting</h2>
  <p>Create a separate plot for each of the species that depicts how the average
weight of the species changes through the years.</p>

  <blockquote class="solution">
    <h2 id="answers-3">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>
    <p style="display: none;">yearly_weight = surveys_complete.groupby([‘year’, ‘species_id’])[‘weight’].mean().reset_index()</p>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">yearly_weight</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="s">'weight'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_line</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s">"species_id"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge---facetting-1">Challenge - facetting</h2>
  <p>Based on the previous exercise, visually compare how the weights of male and
females has changed through time by creating a separate plot for each sex and
an individual color assigned to each <code class="language-plaintext highlighter-rouge">species_id</code>.</p>

  <blockquote class="solution">
    <h2 id="answers-4">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>
    <p style="display: none;">yearly_weight = surveys_complete.groupby([‘year’, ‘species_id’, ‘sex’])[‘weight’].mean().reset_index()</p>

    <p class="language-python" style="display: none;">(p9.ggplot(data=yearly_weight,
           mapping=p9.aes(x=’year’,
                          y=’weight’,
                          color=’species_id’))
    + p9.geom_line()
    + p9.facet_wrap(“sex”)
)</p>
  </blockquote>
</blockquote>

<h2 id="further-customization">Further customization</h2>

<p>As the syntax of <code class="language-plaintext highlighter-rouge">plotnine</code> follows the original R package <code class="language-plaintext highlighter-rouge">ggplot2</code>, the
documentation of <code class="language-plaintext highlighter-rouge">ggplot2</code> can provide information and inspiration to customize
graphs. Take a look at the <code class="language-plaintext highlighter-rouge">ggplot2</code> <a href="https://www.rstudio.com/wp-content/uploads/2015/08/ggplot2-cheatsheet.pdf">cheat sheet</a>, and think of ways to
improve the plot. You can write down some of your ideas as comments in the Etherpad.</p>

<p>The theming options provide a rich set of visual adaptations. Consider the
following example of a bar plot with the counts per year.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'factor(year)'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_bar</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_overlap_bars.png" alt="png"></p>

<p>Notice that we use the <code class="language-plaintext highlighter-rouge">year</code> here as a categorical variable by using the
<code class="language-plaintext highlighter-rouge">factor</code> functionality. However, by doing so, we have the individual year
labels overlapping with each other. The <code class="language-plaintext highlighter-rouge">theme</code> functionality provides a way to
rotate the text of the x-axis labels:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'factor(year)'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_bar</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">theme_bw</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">p9</span><span class="p">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_good_bars.png" alt="png"></p>

<p>When you like a specific set of theme-customizations you created, you can save
them as an object to easily apply them to other plots you may create:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_custom_theme</span> <span class="o">=</span> <span class="n">p9</span><span class="p">.</span><span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">p9</span><span class="p">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">"grey"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                                         <span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">),</span>
                           <span class="n">axis_text_y</span> <span class="o">=</span> <span class="n">p9</span><span class="p">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">"grey"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'factor(year)'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_bar</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">my_custom_theme</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/06_theme_plot.png" alt="png"></p>

<blockquote class="challenge">
  <h2 id="challenge---customization">Challenge - customization</h2>
  <p>Please take another five minutes to either improve one of the plots
generated in this exercise or create a beautiful graph of your own.</p>

  <p>Here are some ideas:</p>

  <ul>
    <li>See if you can change thickness of lines for the line plot .</li>
    <li>Can you find a way to change the name of the legend? What about its labels?</li>
    <li>Use a different color palette (see <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)">http://www.cookbook-r.com/Graphs/Colors_(ggplot2)</a>)</li>
  </ul>
</blockquote>

<p>After creating your plot, you can save it to a file in your favourite format.
You can easily change the dimension (and its resolution) of your plot by
adjusting the appropriate arguments (<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code> and <code class="language-plaintext highlighter-rouge">dpi</code>):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys_complete</span><span class="p">,</span>
           <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'weight'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">my_plot</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"scatterplot.png"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div></div>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>The <code class="language-plaintext highlighter-rouge">data</code>, <code class="language-plaintext highlighter-rouge">aes</code> variables and a <code class="language-plaintext highlighter-rouge">geometry</code> are the main elements of a plotnine graph</p>
</li>
    
    <li><p>With the <code class="language-plaintext highlighter-rouge">+</code> operator, additional <code class="language-plaintext highlighter-rouge">scale_*</code>, <code class="language-plaintext highlighter-rouge">theme_*</code>, <code class="language-plaintext highlighter-rouge">xlab/ylab</code> and <code class="language-plaintext highlighter-rouge">facet_*</code> elements are added</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="data-ingest-and-visualization-matplotlib-and-pandas" class="maintitle">Data Ingest and Visualization - Matplotlib and Pandas</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br>
      <strong>Exercises:</strong> 65 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What other tools can I use to create plots apart from ggplot?</p>
</li>
	
	<li><p>Why should I use Python to create plots?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Import the pyplot toolbox to create figures in Python.</p>
</li>
	
	<li><p>Use matplotlib to make adjustments to Pandas or plotnine objects.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Up to this point, we have walked through tasks that are often
involved in handling and processing data using the workshop-ready cleaned
files that we have provided. In this wrap-up exercise, we will perform
many of the same tasks with real data sets. This lesson also covers data
visualization.</p>

<p>As opposed to the previous ones, this lesson does not give step-by-step
directions to each of the tasks. Use the lesson materials you’ve already gone
through as well as the Python documentation to help you along.</p>

<h2 id="obtain-data">Obtain data</h2>

<p>There are many repositories online from which you can obtain data. We are
providing you with one data file to use with these exercises, but feel free to
use any data that is relevant to your research. The file
<a href="https://datacarpentry.org/python-ecology-lesson/data/bouldercreek_09_2013.txt"><code class="language-plaintext highlighter-rouge">bouldercreek_09_2013.txt</code></a>
contains stream discharge data, summarized at
15 minute intervals (in cubic feet per second) for a streamgage on Boulder
Creek at North 75th Street (USGS gage06730200) for 1-30 September 2013. If you’d
like to use this dataset, please find it in the data folder.</p>

<h2 id="clean-up-your-data-and-open-it-using-python-and-pandas">Clean up your data and open it using Python and Pandas</h2>

<p>To begin, import your data file into Python using Pandas. Did it fail? Your data
file probably has a header that Pandas does not recognize as part of the data
table. Remove this header, but do not simply delete it in a text editor! Use
either a shell script or Python to do this - you wouldn’t want to do it by hand
if you had many files to process.</p>

<p>If you are still having trouble importing the data as a table using Pandas,
check the documentation. You can open the docstring in an ipython notebook using
a question mark. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="err">?</span>
</code></pre></div></div>

<p>Look through the function arguments to see if there is a default value that is
different from what your file requires (Hint: the problem is most likely the
delimiter or separator. Common delimiters are <code class="language-plaintext highlighter-rouge">','</code> for comma, <code class="language-plaintext highlighter-rouge">' '</code> for space,
and <code class="language-plaintext highlighter-rouge">'\t'</code> for tab).</p>

<p>Create a DataFrame that includes only the values of the data that are useful to
you. In the streamgage file, those values might be the date, time, and discharge
measurements. Convert any measurements in imperial units into SI units. You can
also change the name of the columns in the DataFrame like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'1stcolumn'</span><span class="p">:[</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span> <span class="s">'2ndcolumn'</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]})</span> <span class="c1"># this just creates a DataFrame for the example!
</span><span class="k">print</span><span class="p">(</span><span class="s">'With the old column names:</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span> <span class="c1"># the \n makes a new line, so it's easier to see
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'FirstColumn'</span><span class="p">,</span> <span class="s">'SecondColumn'</span><span class="p">]</span> <span class="c1"># rename the columns!
</span><span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n</span><span class="s">With the new column names:</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With the old column names:

   1stcolumn  2ndcolumn
0        100         10
1        200         20


With the new column names:

   FirstColumn  SecondColumn
0          100            10
1          200            20
</code></pre></div></div>

<h2 id="matplotlib-package">Matplotlib package</h2>

<p><a href="https://matplotlib.org/">Matplotlib</a> is a Python package that is widely used throughout the scientific Python community to create high-quality and publication-ready graphics. It supports a wide range of raster and vector graphics formats including PNG, PostScript, EPS, PDF and SVG.</p>

<p>Moreover, matplotlib is the actual engine behind the plotting capabilities of both Pandas and plotnine packages. For example, when we call the <code class="language-plaintext highlighter-rouge">.plot</code> method on Pandas data objects, we actually use the matplotlib package.</p>

<p>First, import the pyplot toolbox:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div>

<p>Now, let’s read data and plot it!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
<span class="n">my_plot</span> <span class="o">=</span> <span class="n">surveys</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="s">"hindfoot_length"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"scatter"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># not necessary in Jupyter Notebooks
</span></code></pre></div></div>

<p><img src="./aio_files/08_scatter_surveys.png" alt="Scatter plot of survey data set"></p>

<blockquote class="callout">
  <h2 id="tip">Tip</h2>
  <p>By default, matplotlib creates a figure in a separate window. When using
Jupyter notebooks, we can make figures appear in-line within the notebook by
executing:</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>  </div>
</blockquote>

<p>The returned object is a matplotlib object (check it yourself with <code class="language-plaintext highlighter-rouge">type(my_plot)</code>),
to which we may make further adjustments and refinements using other matplotlib methods.</p>

<blockquote class="callout">
  <h2 id="tip-1">Tip</h2>
  <p>Matplotlib itself can be overwhelming, so a useful strategy is to
do as much as you easily can in a convenience layer, <em>i.e.</em> start
creating the plot in Pandas or plotnine, and then use matplotlib
for the rest.</p>
</blockquote>

<p>We will cover a few basic commands for creating and formatting plots with matplotlib in this lesson.
A great resource for help creating and styling your figures is the matplotlib gallery
(<a href="http://matplotlib.org/gallery.html">http://matplotlib.org/gallery.html</a>), which includes plots in many different
styles and the source codes that create them.</p>

<h3 id="plt-pyplot-versus-object-based-matplotlib"><code class="language-plaintext highlighter-rouge">plt</code> pyplot versus object-based matplotlib</h3>

<p>Matplotlib integrates nicely with the NumPy package and can use NumPy arrays
as input to the available plot functions. Consider the following example data,
created with NumPy by drawing 1000 samples from a normal distribution with a mean value of 0 and
a standard deviation of 0.1:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">sample_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

</code></pre></div></div>

<p>To plot a histogram of our draws from the normal distribution, we can use the <code class="language-plaintext highlighter-rouge">hist</code> function directly:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/08-normal-distribution.png" alt="Histogram of 1000 samples from normal distribution"></p>

<blockquote class="callout">
  <h2 id="tip-cross-platform-visualization-of-figures">Tip: Cross-Platform Visualization of Figures</h2>
  <p>Jupyter Notebooks make many aspects of data analysis and visualization much simpler. This includes
doing some of the labor of visualizing plots for you. But, not every one of your collaborators
will be using a Jupyter Notebook. The <code class="language-plaintext highlighter-rouge">.show()</code> command allows you to visualize plots
when working at the command line, with a script, or at the IPython interpreter. In the
previous example, adding  <code class="language-plaintext highlighter-rouge">plt.show()</code> after the creation of the plot will enable your
colleagues who aren’t using a Jupyter notebook to reproduce your work on their platform.</p>
</blockquote>

<p>or create matplotlib <code class="language-plaintext highlighter-rouge">figure</code> and <code class="language-plaintext highlighter-rouge">axis</code> objects first and subsequently add a histogram with 30
data bins:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1"># initiate an empty figure and axis matplotlib object
</span><span class="n">ax</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</code></pre></div></div>

<p>Although the latter approach requires a little bit more code to create the same plot,
the advantage is that it gives us <strong>full control</strong> over the plot and we can add new items
such as labels, grid lines, title, and other visual elements. For example, we can add
additional axes to the figure and customize their labels:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># prepare a matplotlib figure
</span><span class="n">ax1</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># Add a plot of a Beta distribution
</span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">beta_draws</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="c1"># adapt the labels
</span><span class="n">ax1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'density'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'value'</span><span class="p">)</span>

<span class="c1"># add additional axes to the figure
</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="c1">#ax2 = fig.add_axes([left, bottom, right, top])
</span><span class="n">ax2</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">beta_draws</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/08-dualdistribution.png" alt="Plot with additional axes"></p>

<blockquote class="challenge">
  <h2 id="challenge---drawing-from-distributions">Challenge - Drawing from distributions</h2>
  <p>Have a look at <a href="https://docs.scipy.org/doc/numpy/reference/random/index.html"><code class="language-plaintext highlighter-rouge">numpy.random</code> documentation</a>.
Choose a distribution you have no familiarity with, and try to sample from and visualize it.</p>
</blockquote>

<h3 id="link-matplotlib-pandas-and-plotnine">Link matplotlib, Pandas and plotnine</h3>

<p>When we create a plot using pandas or plotnine, both libraries use matplotlib
to create those plots. The plots created in pandas or plotnine are matplotlib
objects, which enables us to use some of the advanced plotting options available
in the matplotlib library. Because the objects output by pandas and plotnine
can be read by matplotlib, we have many more options than any one library can
provide, offering a consistent environment to make publication-quality visualizations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># prepare a matplotlib figure
</span>
<span class="n">surveys</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="s">"hindfoot_length"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"scatter"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

<span class="c1"># Provide further adaptations with matplotlib:
</span><span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Hindfoot length"</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'Scatter plot of weight versus hindfoot length'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="./aio_files/08_scatter_surveys_extended.png" alt="Extended version of scatter plot surveys"></p>

<p>To retrieve the matplotlib figure object from plotnine for customization, use the <code class="language-plaintext highlighter-rouge">draw()</code> function in plotnine:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">plotnine</span> <span class="k">as</span> <span class="n">p9</span>
<span class="n">myplot</span> <span class="o">=</span> <span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys</span><span class="p">,</span>
                    <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span>
              <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">())</span>

<span class="c1"># convert output plotnine to a matplotlib object
</span><span class="n">my_plt_version</span> <span class="o">=</span> <span class="n">myplot</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>

<span class="c1"># Provide further adaptations with matplotlib:
</span><span class="n">p9_ax</span> <span class="o">=</span> <span class="n">my_plt_version</span><span class="p">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># each subplot is an item in a list
</span><span class="n">p9_ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Hindfoot length"</span><span class="p">)</span>
<span class="n">p9_ax</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">p9_ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Scatter plot of weight versus hindfoot length'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># not necessary in Jupyter Notebooks
</span></code></pre></div></div>

<p><img src="./aio_files/08_scatter_surveys_plotnine.png" alt="Extended version of plotnine scatter plot"></p>

<blockquote class="challenge">
  <h2 id="challenge---pandas-and-matplotlib">Challenge - Pandas and matplotlib</h2>
  <p>Load the streamgage data set with Pandas, subset the week of the 2013 Front Range flood
(September 11 through 15) and create a hydrograph (line plot) of the discharge data using
Pandas, linking it to an empty maptlotlib <code class="language-plaintext highlighter-rouge">ax</code> object. Create a second axis that displays the
whole dataset. Adapt the title and axes’ labels using matplotlib.</p>

  <blockquote class="solution">
    <h2 id="answers">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">discharge</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/bouldercreek_09_2013.txt"</span><span class="p">,</span>
                        <span class="n">skiprows</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span>
                        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"agency"</span><span class="p">,</span> <span class="s">"site_id"</span><span class="p">,</span> <span class="s">"datetime"</span><span class="p">,</span>
                               <span class="s">"timezone"</span><span class="p">,</span> <span class="s">"discharge"</span><span class="p">,</span> <span class="s">"discharge_cd"</span><span class="p">])</span>
<span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">])</span>
<span class="n">front_range</span> <span class="o">=</span> <span class="n">discharge</span><span class="p">[(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">"2013-09-09"</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">"2013-09-15"</span><span class="p">)]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">front_range</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"discharge"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="c1"># no label
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Discharge, cubic feet per second"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">" Front Range flood event 2013"</span><span class="p">)</span>
<span class="n">discharge</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../data/bouldercreek_09_2013.txt"</span><span class="p">,</span>
                      <span class="n">skiprows</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span>
                      <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"agency"</span><span class="p">,</span> <span class="s">"site_id"</span><span class="p">,</span> <span class="s">"datetime"</span><span class="p">,</span>
                             <span class="s">"timezone"</span><span class="p">,</span> <span class="s">"flow_rate"</span><span class="p">,</span> <span class="s">"height"</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">flood</span> <span class="o">=</span> <span class="n">discharge</span><span class="p">[(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">"2013-09-11"</span><span class="p">)</span> <span class="o">&amp;</span>
                  <span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">"2013-09-15"</span><span class="p">)]</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">flood</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">discharge</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="c1"># no label
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Discharge, cubic feet per second"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">" Front Range flood event 2013"</span><span class="p">)</span>
<span class="n">discharge</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../data/bouldercreek_09_2013.txt"</span><span class="p">,</span>
                      <span class="n">skiprows</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span>
                      <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"agency"</span><span class="p">,</span> <span class="s">"site_id"</span><span class="p">,</span> <span class="s">"datetime"</span><span class="p">,</span>
                             <span class="s">"timezone"</span><span class="p">,</span> <span class="s">"flow_rate"</span><span class="p">,</span> <span class="s">"height"</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">flood</span> <span class="o">=</span> <span class="n">discharge</span><span class="p">[(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">"2013-09-11"</span><span class="p">)</span> <span class="o">&amp;</span>
                  <span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">"2013-09-15"</span><span class="p">)]</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">flood</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">discharge</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="c1"># no label
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Discharge, cubic feet per second"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">" Front Range flood event 2013"</span><span class="p">)</span>
</code></pre></div>    </div>

    <p style="display: none;"><img src="./aio_files/08_flood_event.png" alt="Flood event plot"></p>
  </blockquote>
</blockquote>

<h3 id="saving-matplotlib-figures">Saving matplotlib figures</h3>

<p>Once satisfied with the resulting plot, you can save the plot with the <code class="language-plaintext highlighter-rouge">.savefig(*args)</code> method from matplotlib:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"my_plot_name.png"</span><span class="p">)</span>
</code></pre></div></div>

<p>which will save the <code class="language-plaintext highlighter-rouge">fig</code> created using Pandas/matplotlib as a png file with the name <code class="language-plaintext highlighter-rouge">my_plot_name</code></p>

<blockquote class="callout">
  <h2 id="tip-saving-figures-in-different-formats">Tip: Saving figures in different formats</h2>
  <p>Matplotlib recognizes the extension used in the filename and
supports (on most computers) png, pdf, ps, eps and svg formats.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge---saving-figure-to-file">Challenge - Saving figure to file</h2>
  <p>Check the documentation of the <code class="language-plaintext highlighter-rouge">savefig</code> method and check how
you can comply to journals requiring figures as <code class="language-plaintext highlighter-rouge">pdf</code> file with
dpi &gt;= 300.</p>

  <blockquote class="solution">
    <h2 id="answers-1">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"my_plot_name.pdf"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="make-other-types-of-plots">Make other types of plots:</h2>

<p>Matplotlib can make many other types of plots in much the same way that it makes two-dimensional line plots. Look through the examples in
<a href="http://matplotlib.org/users/screenshots.html">http://matplotlib.org/users/screenshots.html</a> and try a few of them (click on the
“Source code” link and copy and paste into a new cell in ipython notebook or
save as a text file with a <code class="language-plaintext highlighter-rouge">.py</code> extension and run in the command line).</p>

<blockquote class="challenge">
  <h2 id="challenge---final-plot">Challenge - Final Plot</h2>
  <p>Display your data using one or more plot types from the example gallery. Which
ones to choose will depend on the content of your own data file. If you are
using the streamgage file <a href="https://datacarpentry.org/python-ecology-lesson/data/bouldercreek_09_2013.txt"><code class="language-plaintext highlighter-rouge">bouldercreek_09_2013.txt</code></a>, you could make a
histogram of the number of days with a given mean discharge, use bar plots
to display daily discharge statistics, or explore the different ways matplotlib
can handle dates and times for figures.</p>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Matplotlib is the engine behind plotnine and Pandas plots.</p>
</li>
    
    <li><p>The object-based nature of matplotlib plots enables their detailed customization after they have been created.</p>
</li>
    
    <li><p>Export plots to a file using the <code class="language-plaintext highlighter-rouge">savefig</code> method.</p>
</li>
    
  </ul>
</blockquote>

<hr>

<h1 id="accessing-sqlite-databases-using-python-and-pandas" class="maintitle">Accessing SQLite Databases Using Python and Pandas</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br>
      <strong>Exercises:</strong> 25 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What if my data are stored in an SQL database? Can I manage them with Python?</p>
</li>
	
	<li><p>How can I write data from Python to be used with SQL?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Use the sqlite3 module to interact with a SQL database.</p>
</li>
	
	<li><p>Access data stored in SQLite using Python.</p>
</li>
	
	<li><p>Describe the difference in interacting with data stored as a CSV file versus in SQLite.</p>
</li>
	
	<li><p>Describe the benefits of accessing data using a database compared to a CSV file.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="python-and-sql">Python and SQL</h2>

<p>When you open a CSV in python, and assign it to a variable name, you are using
your computers memory to save that variable. Accessing data from a database like
SQL is not only more efficient, but also it allows you to subset and import only
the parts of the data that you need.</p>

<p>In the following lesson, we’ll see some approaches that can be taken to do so.</p>

<h3 id="the-sqlite3-module">The <code class="language-plaintext highlighter-rouge">sqlite3</code> module</h3>

<p>The <a href="https://docs.python.org/3/library/sqlite3.html">sqlite3</a> module provides a straightforward interface for interacting with
SQLite databases. A connection object is created using <code class="language-plaintext highlighter-rouge">sqlite3.connect()</code>; the
connection must be closed at the end of the session with the <code class="language-plaintext highlighter-rouge">.close()</code> command.
While the connection is open, any interactions with the database require you to
make a cursor object with the <code class="language-plaintext highlighter-rouge">.cursor()</code> command. The cursor is then ready to
perform all kinds of operations with <code class="language-plaintext highlighter-rouge">.execute()</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># Create a SQL connection to our SQLite database
</span><span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"data/portal_mammals.sqlite"</span><span class="p">)</span>

<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># The result of a "cursor.execute" can be iterated over by row
</span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT * FROM species;'</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="c1"># Be sure to close the connection
</span><span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="queries">Queries</h3>

<p>One of the most common ways to interact with a database is by querying:
retrieving data based on some search parameters. Use a SELECT statement string.
The query is returned as a single tuple or a tuple of tuples. Add a WHERE
statement to filter your results based on some parameter.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># Create a SQL connection to our SQLite database
</span><span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"data/portal_mammals.sqlite"</span><span class="p">)</span>

<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Return all results of query
</span><span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT plot_id FROM plots WHERE plot_type="Control"'</span><span class="p">)</span>
<span class="n">cur</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="c1"># Return first result of query
</span><span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT species FROM species WHERE taxa="Bird"'</span><span class="p">)</span>
<span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="c1"># Be sure to close the connection
</span><span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="accessing-data-stored-in-sqlite-using-python-and-pandas">Accessing data stored in SQLite using Python and Pandas</h2>

<p>Using pandas, we can import results of a SQLite query into a dataframe. Note
that you can use the same SQL commands / syntax that we used in the SQLite
lesson. An example of using pandas together with sqlite is below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># Read sqlite query results into a pandas DataFrame
</span><span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"data/portal_mammals.sqlite"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"SELECT * from surveys"</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>

<span class="c1"># Verify that result of SQL query is stored in the dataframe
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="storing-data-csv-vs-sqlite">Storing data: CSV vs SQLite</h2>

<p>Storing your data in an SQLite database can provide substantial performance
improvements when reading/writing compared to CSV. The difference in performance
becomes more noticeable as the size of the dataset grows (see for example <a href="http://sebastianraschka.com/Articles/2013_sqlite_database.html#results-and-conclusions">these
benchmarks</a>).</p>

<blockquote class="challenge">
  <h2 id="challenge---sql">Challenge - SQL</h2>

  <ol>
    <li>
      <p>Create a query that contains survey data collected between 1998 - 2001 for
  observations of sex “male” or “female” that includes observation’s genus and
  species and site type for the sample. How many records are returned?</p>
    </li>
    <li>
      <p>Create a dataframe that contains the total number of observations (count)
  made for all years, and sum of observation weights for each site, ordered by
  site ID.</p>
    </li>
  </ol>
</blockquote>

<h2 id="storing-data-create-new-tables-using-pandas">Storing data: Create new tables using Pandas</h2>

<p>We can also us pandas to create new tables within an SQLite database. Here, we run we re-do an
exercise we did before with CSV files using our SQLite database. We first read in our survey data,
then select only those survey results for 2002, and then save it out to its own table so we can work
with it on its own later.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"data/portal_mammals.sqlite"</span><span class="p">)</span>

<span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"SELECT * from surveys"</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>

<span class="c1"># Select only data for 2002
</span><span class="n">surveys2002</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2002</span><span class="p">]</span>

<span class="c1"># Write the new DataFrame to a new SQLite table
</span><span class="n">surveys2002</span><span class="p">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s">"surveys2002"</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s">"replace"</span><span class="p">)</span>

<span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---saving-your-work">Challenge - Saving your work</h2>

  <ol>
    <li>
      <p>For each of the challenges in the previous challenge block, modify your code to save the
  results to their own tables in the portal database.</p>
    </li>
    <li>
      <p>What are some of the reasons you might want to save the results of your queries back into the
  database? What are some of the reasons you might avoid doing this.</p>
    </li>
  </ol>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>sqlite3 provides a SQL-like interface to read, query, and write SQL databases from Python.</p>
</li>
    
    <li><p>sqlite3 can be used with Pandas to read SQL data to the familiar Pandas DataFrame.</p>
</li>
    
    <li><p>Pandas and sqlite3 can also be used to transfer between the CSV and SQL formats.</p>
</li>
    
  </ul>
</blockquote>

<hr>


</article>

      
      






<footer>
  <div class="row">
  </div>
</footer>

      
    </div>
    
<script async="" src="../js/analytics.js.download"></script><script src="../js/jquery.min.js.download"></script>
<script src="../js/bootstrap.min.js.download"></script>
<script src="../js/lesson.js.download"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
  

</body></html>