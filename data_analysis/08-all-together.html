<!DOCTYPE html>
<!-- saved from url=(0085)https://datacarpentry.org/python-ecology-lesson/08-putting-it-all-together/index.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-06-23 13:47:10 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="http://pzindel.github.io/LanternPython">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.css">
    <link rel="stylesheet" type="text/css" href="../css/lesson.css">
    <link rel="stylesheet" type="text/css" href="../css/syntax.css">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Data Ingest and Visualization - Matplotlib and Pandas – Data Analysis and Visualization in Python for Ecologists
  </title>  

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="navbar-collapse collapse in" id="bs-example-navbar-collapse-1" aria-expanded="true" style="">
      <ul class="nav navbar-nav">

        
        <li class="dropdown">
          <a href="../unix/01-intro.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">The Unix Shell <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../unix/01-intro.html">Introducing the Shell</a></li>
            
            
            <li><a href="../unix/02-filedir.html">Navigating Files and Directories</a></li>
            
            
            <li><a href="../unix/03-create.html">Working With Files and Directories</a></li>
            
            
            <li><a href="../unix/04-pipefilter.html">Pipes and Filters</a></li>
            
            
            <li><a href="../unix/05-loop.html">Loops</a></li>
            
            
            <li><a href="../unix/06-script.html">Shell Scripts</a></li>
            
            
            <li><a href="../unix/07-find.html">Finding Things</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../unix/aio.html">All in one page</a></li>
          </ul>
        </li>
	        
		
		<li class="dropdown">
          <a href="../python/01-intro.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Programming with Python <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../python/01-intro.html">Python Fundamentals</a></li>
            
            
            <li><a href="../python/02-numpy.html">Analyzing Patient Data</a></li>
            
            
            <li><a href="../python/03-matplotlib.html">Visualizing Tabular Data</a></li>
            
            
            <li><a href="../python/04-loop.html">Repeating Actions with Loops</a></li>
            
            
            <li><a href="../python/05-lists.html">Storing Multiple Values in Lists</a></li>
            
            
            <li><a href="../python/06-files.html">Analyzing Data from Multiple Files</a></li>
            
            
            <li><a href="../python/07-cond.html">Making Choices</a></li>
            
            
            <li><a href="../python/08-func.html">Creating Functions</a></li>
            
            
            <li><a href="../python/09-errors.html">Errors and Exceptions</a></li>
            
            
            <li><a href="../python/10-defensive.html">Defensive Programming</a></li>
            
            
            <li><a href="../python/11-debugging.html">Debugging</a></li>
            
            
            <li><a href="../python/12-cmdline.html">Command-Line Programs</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../python/aio.html">All in one page</a></li>
          </ul>
        </li>
	

		<li class="dropdown">
          <a href="._analysis/01-intro-to-python.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Data Analysis <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="./00-before-we-start.html">Before we start</a></li>
            
            
            <li><a href="./01-intro-to-python.html">Short Introduction to Programming in Python</a></li>
            
            
            <li><a href="./02-starting-with-data.html">Starting With Data</a></li>
            
            
            <li><a href="./03-index-slice-subset.html">Indexing, Slicing and Subsetting DataFrames in Python</a></li>
            
            
            <li><a href="./04-data-types.html">Data Types and Formats</a></li>
            
            
            <li><a href="./05-merging-data.html">Combining DataFrames with Pandas</a></li>
            
            
            <li><a href="./06-loops-and-functions.html">Data Workflows and Automation</a></li>
            
            
            <li><a href="./07-visualization.html">Making Plots With plotnine</a></li>
            
            
            <li><a href="./08-all-together.html">Data Ingest and Visualization - Matplotlib and Pandas</a></li>
            
            
            <li><a href="./09-working-with-sql.html">Accessing SQLite Databases Using Python and Pandas</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="./aio.html">All in one page</a></li>
          </ul>
        </li>

        <li><a href="../licenses.html">License</a></li>
	
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="./07-visualization.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../index.html#data">Data Analysis and Visualization in Python for Ecologists</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="./09-working-with-sql.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Data Ingest and Visualization - Matplotlib and Pandas</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br>
      <strong>Exercises:</strong> 65 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What other tools can I use to create plots apart from ggplot?</p>
</li>
	
	<li><p>Why should I use Python to create plots?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Import the pyplot toolbox to create figures in Python.</p>
</li>
	
	<li><p>Use matplotlib to make adjustments to Pandas or plotnine objects.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Up to this point, we have walked through tasks that are often
involved in handling and processing data using the workshop-ready cleaned
files that we have provided. In this wrap-up exercise, we will perform
many of the same tasks with real data sets. This lesson also covers data
visualization.</p>

<p>As opposed to the previous ones, this lesson does not give step-by-step
directions to each of the tasks. Use the lesson materials you’ve already gone
through as well as the Python documentation to help you along.</p>

<h2 id="obtain-data">Obtain data</h2>

<p>There are many repositories online from which you can obtain data. We are
providing you with one data file to use with these exercises, but feel free to
use any data that is relevant to your research. The file
<a href="https://datacarpentry.org/python-ecology-lesson/data/bouldercreek_09_2013.txt"><code class="language-plaintext highlighter-rouge">bouldercreek_09_2013.txt</code></a>
contains stream discharge data, summarized at
15 minute intervals (in cubic feet per second) for a streamgage on Boulder
Creek at North 75th Street (USGS gage06730200) for 1-30 September 2013. If you’d
like to use this dataset, please find it in the data folder.</p>

<h2 id="clean-up-your-data-and-open-it-using-python-and-pandas">Clean up your data and open it using Python and Pandas</h2>

<p>To begin, import your data file into Python using Pandas. Did it fail? Your data
file probably has a header that Pandas does not recognize as part of the data
table. Remove this header, but do not simply delete it in a text editor! Use
either a shell script or Python to do this - you wouldn’t want to do it by hand
if you had many files to process.</p>

<p>If you are still having trouble importing the data as a table using Pandas,
check the documentation. You can open the docstring in an ipython notebook using
a question mark. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="err">?</span>
</code></pre></div></div>

<p>Look through the function arguments to see if there is a default value that is
different from what your file requires (Hint: the problem is most likely the
delimiter or separator. Common delimiters are <code class="language-plaintext highlighter-rouge">','</code> for comma, <code class="language-plaintext highlighter-rouge">' '</code> for space,
and <code class="language-plaintext highlighter-rouge">'\t'</code> for tab).</p>

<p>Create a DataFrame that includes only the values of the data that are useful to
you. In the streamgage file, those values might be the date, time, and discharge
measurements. Convert any measurements in imperial units into SI units. You can
also change the name of the columns in the DataFrame like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'1stcolumn'</span><span class="p">:[</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span> <span class="s">'2ndcolumn'</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]})</span> <span class="c1"># this just creates a DataFrame for the example!
</span><span class="k">print</span><span class="p">(</span><span class="s">'With the old column names:</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span> <span class="c1"># the \n makes a new line, so it's easier to see
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'FirstColumn'</span><span class="p">,</span> <span class="s">'SecondColumn'</span><span class="p">]</span> <span class="c1"># rename the columns!
</span><span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n</span><span class="s">With the new column names:</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With the old column names:

   1stcolumn  2ndcolumn
0        100         10
1        200         20


With the new column names:

   FirstColumn  SecondColumn
0          100            10
1          200            20
</code></pre></div></div>

<h2 id="matplotlib-package">Matplotlib package</h2>

<p><a href="https://matplotlib.org/">Matplotlib</a> is a Python package that is widely used throughout the scientific Python community to create high-quality and publication-ready graphics. It supports a wide range of raster and vector graphics formats including PNG, PostScript, EPS, PDF and SVG.</p>

<p>Moreover, matplotlib is the actual engine behind the plotting capabilities of both Pandas and plotnine packages. For example, when we call the <code class="language-plaintext highlighter-rouge">.plot</code> method on Pandas data objects, we actually use the matplotlib package.</p>

<p>First, import the pyplot toolbox:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div>

<p>Now, let’s read data and plot it!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/surveys.csv"</span><span class="p">)</span>
<span class="n">my_plot</span> <span class="o">=</span> <span class="n">surveys</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="s">"hindfoot_length"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"scatter"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># not necessary in Jupyter Notebooks
</span></code></pre></div></div>

<p><img src="./08-all-together_files/08_scatter_surveys.png" alt="Scatter plot of survey data set"></p>

<blockquote class="callout">
  <h2 id="tip">Tip</h2>
  <p>By default, matplotlib creates a figure in a separate window. When using
Jupyter notebooks, we can make figures appear in-line within the notebook by
executing:</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>  </div>
</blockquote>

<p>The returned object is a matplotlib object (check it yourself with <code class="language-plaintext highlighter-rouge">type(my_plot)</code>),
to which we may make further adjustments and refinements using other matplotlib methods.</p>

<blockquote class="callout">
  <h2 id="tip-1">Tip</h2>
  <p>Matplotlib itself can be overwhelming, so a useful strategy is to
do as much as you easily can in a convenience layer, <em>i.e.</em> start
creating the plot in Pandas or plotnine, and then use matplotlib
for the rest.</p>
</blockquote>

<p>We will cover a few basic commands for creating and formatting plots with matplotlib in this lesson.
A great resource for help creating and styling your figures is the matplotlib gallery
(<a href="http://matplotlib.org/gallery.html">http://matplotlib.org/gallery.html</a>), which includes plots in many different
styles and the source codes that create them.</p>

<h3 id="plt-pyplot-versus-object-based-matplotlib"><code class="language-plaintext highlighter-rouge">plt</code> pyplot versus object-based matplotlib</h3>

<p>Matplotlib integrates nicely with the NumPy package and can use NumPy arrays
as input to the available plot functions. Consider the following example data,
created with NumPy by drawing 1000 samples from a normal distribution with a mean value of 0 and
a standard deviation of 0.1:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">sample_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

</code></pre></div></div>

<p>To plot a histogram of our draws from the normal distribution, we can use the <code class="language-plaintext highlighter-rouge">hist</code> function directly:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="./08-all-together_files/08-normal-distribution.png" alt="Histogram of 1000 samples from normal distribution"></p>

<blockquote class="callout">
  <h2 id="tip-cross-platform-visualization-of-figures">Tip: Cross-Platform Visualization of Figures</h2>
  <p>Jupyter Notebooks make many aspects of data analysis and visualization much simpler. This includes
doing some of the labor of visualizing plots for you. But, not every one of your collaborators
will be using a Jupyter Notebook. The <code class="language-plaintext highlighter-rouge">.show()</code> command allows you to visualize plots
when working at the command line, with a script, or at the IPython interpreter. In the
previous example, adding  <code class="language-plaintext highlighter-rouge">plt.show()</code> after the creation of the plot will enable your
colleagues who aren’t using a Jupyter notebook to reproduce your work on their platform.</p>
</blockquote>

<p>or create matplotlib <code class="language-plaintext highlighter-rouge">figure</code> and <code class="language-plaintext highlighter-rouge">axis</code> objects first and subsequently add a histogram with 30
data bins:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1"># initiate an empty figure and axis matplotlib object
</span><span class="n">ax</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</code></pre></div></div>

<p>Although the latter approach requires a little bit more code to create the same plot,
the advantage is that it gives us <strong>full control</strong> over the plot and we can add new items
such as labels, grid lines, title, and other visual elements. For example, we can add
additional axes to the figure and customize their labels:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># prepare a matplotlib figure
</span><span class="n">ax1</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># Add a plot of a Beta distribution
</span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">beta_draws</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="c1"># adapt the labels
</span><span class="n">ax1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'density'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'value'</span><span class="p">)</span>

<span class="c1"># add additional axes to the figure
</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="c1">#ax2 = fig.add_axes([left, bottom, right, top])
</span><span class="n">ax2</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">beta_draws</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="./08-all-together_files/08-dualdistribution.png" alt="Plot with additional axes"></p>

<blockquote class="challenge">
  <h2 id="challenge---drawing-from-distributions">Challenge - Drawing from distributions</h2>
  <p>Have a look at <a href="https://docs.scipy.org/doc/numpy/reference/random/index.html"><code class="language-plaintext highlighter-rouge">numpy.random</code> documentation</a>.
Choose a distribution you have no familiarity with, and try to sample from and visualize it.</p>
</blockquote>

<h3 id="link-matplotlib-pandas-and-plotnine">Link matplotlib, Pandas and plotnine</h3>

<p>When we create a plot using pandas or plotnine, both libraries use matplotlib
to create those plots. The plots created in pandas or plotnine are matplotlib
objects, which enables us to use some of the advanced plotting options available
in the matplotlib library. Because the objects output by pandas and plotnine
can be read by matplotlib, we have many more options than any one library can
provide, offering a consistent environment to make publication-quality visualizations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># prepare a matplotlib figure
</span>
<span class="n">surveys</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="s">"hindfoot_length"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"scatter"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

<span class="c1"># Provide further adaptations with matplotlib:
</span><span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Hindfoot length"</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'Scatter plot of weight versus hindfoot length'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="./08-all-together_files/08_scatter_surveys_extended.png" alt="Extended version of scatter plot surveys"></p>

<p>To retrieve the matplotlib figure object from plotnine for customization, use the <code class="language-plaintext highlighter-rouge">draw()</code> function in plotnine:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">plotnine</span> <span class="k">as</span> <span class="n">p9</span>
<span class="n">myplot</span> <span class="o">=</span> <span class="p">(</span><span class="n">p9</span><span class="p">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">surveys</span><span class="p">,</span>
                    <span class="n">mapping</span><span class="o">=</span><span class="n">p9</span><span class="p">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span>
              <span class="n">p9</span><span class="p">.</span><span class="n">geom_point</span><span class="p">())</span>

<span class="c1"># convert output plotnine to a matplotlib object
</span><span class="n">my_plt_version</span> <span class="o">=</span> <span class="n">myplot</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>

<span class="c1"># Provide further adaptations with matplotlib:
</span><span class="n">p9_ax</span> <span class="o">=</span> <span class="n">my_plt_version</span><span class="p">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># each subplot is an item in a list
</span><span class="n">p9_ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Hindfoot length"</span><span class="p">)</span>
<span class="n">p9_ax</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">p9_ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Scatter plot of weight versus hindfoot length'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># not necessary in Jupyter Notebooks
</span></code></pre></div></div>

<p><img src="./08-all-together_files/08_scatter_surveys_plotnine.png" alt="Extended version of plotnine scatter plot"></p>

<blockquote class="challenge">
  <h2 id="challenge---pandas-and-matplotlib">Challenge - Pandas and matplotlib</h2>
  <p>Load the streamgage data set with Pandas, subset the week of the 2013 Front Range flood
(September 11 through 15) and create a hydrograph (line plot) of the discharge data using
Pandas, linking it to an empty maptlotlib <code class="language-plaintext highlighter-rouge">ax</code> object. Create a second axis that displays the
whole dataset. Adapt the title and axes’ labels using matplotlib.</p>

  <blockquote class="solution">
    <h2 id="answers">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">discharge</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/bouldercreek_09_2013.txt"</span><span class="p">,</span>
                        <span class="n">skiprows</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span>
                        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"agency"</span><span class="p">,</span> <span class="s">"site_id"</span><span class="p">,</span> <span class="s">"datetime"</span><span class="p">,</span>
                               <span class="s">"timezone"</span><span class="p">,</span> <span class="s">"discharge"</span><span class="p">,</span> <span class="s">"discharge_cd"</span><span class="p">])</span>
<span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">])</span>
<span class="n">front_range</span> <span class="o">=</span> <span class="n">discharge</span><span class="p">[(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">"2013-09-09"</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">"2013-09-15"</span><span class="p">)]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">front_range</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"discharge"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="c1"># no label
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Discharge, cubic feet per second"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">" Front Range flood event 2013"</span><span class="p">)</span>
<span class="n">discharge</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../data/bouldercreek_09_2013.txt"</span><span class="p">,</span>
                      <span class="n">skiprows</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span>
                      <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"agency"</span><span class="p">,</span> <span class="s">"site_id"</span><span class="p">,</span> <span class="s">"datetime"</span><span class="p">,</span>
                             <span class="s">"timezone"</span><span class="p">,</span> <span class="s">"flow_rate"</span><span class="p">,</span> <span class="s">"height"</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">flood</span> <span class="o">=</span> <span class="n">discharge</span><span class="p">[(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">"2013-09-11"</span><span class="p">)</span> <span class="o">&amp;</span>
                  <span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">"2013-09-15"</span><span class="p">)]</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">flood</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">discharge</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="c1"># no label
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Discharge, cubic feet per second"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">" Front Range flood event 2013"</span><span class="p">)</span>
<span class="n">discharge</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../data/bouldercreek_09_2013.txt"</span><span class="p">,</span>
                      <span class="n">skiprows</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span>
                      <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"agency"</span><span class="p">,</span> <span class="s">"site_id"</span><span class="p">,</span> <span class="s">"datetime"</span><span class="p">,</span>
                             <span class="s">"timezone"</span><span class="p">,</span> <span class="s">"flow_rate"</span><span class="p">,</span> <span class="s">"height"</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">flood</span> <span class="o">=</span> <span class="n">discharge</span><span class="p">[(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">"2013-09-11"</span><span class="p">)</span> <span class="o">&amp;</span>
                  <span class="p">(</span><span class="n">discharge</span><span class="p">[</span><span class="s">"datetime"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">"2013-09-15"</span><span class="p">)]</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">flood</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">discharge</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s">"datetime"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"flow_rate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="c1"># no label
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Discharge, cubic feet per second"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">().</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">" Front Range flood event 2013"</span><span class="p">)</span>
</code></pre></div>    </div>

    <p style="display: none;"><img src="./08-all-together_files/08_flood_event.png" alt="Flood event plot"></p>
  </blockquote>
</blockquote>

<h3 id="saving-matplotlib-figures">Saving matplotlib figures</h3>

<p>Once satisfied with the resulting plot, you can save the plot with the <code class="language-plaintext highlighter-rouge">.savefig(*args)</code> method from matplotlib:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"my_plot_name.png"</span><span class="p">)</span>
</code></pre></div></div>

<p>which will save the <code class="language-plaintext highlighter-rouge">fig</code> created using Pandas/matplotlib as a png file with the name <code class="language-plaintext highlighter-rouge">my_plot_name</code></p>

<blockquote class="callout">
  <h2 id="tip-saving-figures-in-different-formats">Tip: Saving figures in different formats</h2>
  <p>Matplotlib recognizes the extension used in the filename and
supports (on most computers) png, pdf, ps, eps and svg formats.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge---saving-figure-to-file">Challenge - Saving figure to file</h2>
  <p>Check the documentation of the <code class="language-plaintext highlighter-rouge">savefig</code> method and check how
you can comply to journals requiring figures as <code class="language-plaintext highlighter-rouge">pdf</code> file with
dpi &gt;= 300.</p>

  <blockquote class="solution">
    <h2 id="answers-1">Answers<span class="fold-unfold glyphicon glyphicon-collapse-down"></span></h2>

    <div class="language-python highlighter-rouge" style="display: none;"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"my_plot_name.pdf"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="make-other-types-of-plots">Make other types of plots:</h2>

<p>Matplotlib can make many other types of plots in much the same way that it makes two-dimensional line plots. Look through the examples in
<a href="http://matplotlib.org/users/screenshots.html">http://matplotlib.org/users/screenshots.html</a> and try a few of them (click on the
“Source code” link and copy and paste into a new cell in ipython notebook or
save as a text file with a <code class="language-plaintext highlighter-rouge">.py</code> extension and run in the command line).</p>

<blockquote class="challenge">
  <h2 id="challenge---final-plot">Challenge - Final Plot</h2>
  <p>Display your data using one or more plot types from the example gallery. Which
ones to choose will depend on the content of your own data file. If you are
using the streamgage file <a href="https://datacarpentry.org/python-ecology-lesson/data/bouldercreek_09_2013.txt"><code class="language-plaintext highlighter-rouge">bouldercreek_09_2013.txt</code></a>, you could make a
histogram of the number of days with a given mean discharge, use bar plots
to display daily discharge statistics, or explore the different ways matplotlib
can handle dates and times for figures.</p>
</blockquote>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Matplotlib is the engine behind plotnine and Pandas plots.</p>
</li>
    
    <li><p>The object-based nature of matplotlib plots enables their detailed customization after they have been created.</p>
</li>
    
    <li><p>Export plots to a file using the <code class="language-plaintext highlighter-rouge">savefig</code> method.</p>
</li>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="./07-visualization.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="./09-working-with-sql.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
  </div>
</footer>

      
    </div>
    
<script async="" src="../js/analytics.js.download"></script><script src="../js/jquery.min.js.download"></script>
<script src="../js/bootstrap.min.js.download"></script>
<script src="../js/lesson.js.download"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
  

</body></html>